{
  "name": "Celonis abgabe 20.01",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -8736,
        2192
      ],
      "id": "06ea0270-83fd-464e-9273-8b64b62c0547",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "url": "https://finnhub.io/api/v1/quote",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "symbol",
              "value": "={{ $json.symbol }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8192,
        128
      ],
      "id": "d5ecea45-d54a-45e8-b9fa-8532217a94f0",
      "name": "HTTP Request",
      "alwaysOutputData": false,
      "executeOnce": false,
      "retryOnFail": false,
      "credentials": {
        "httpHeaderAuth": {
          "id": "oNbZkPSClDxcV7sx",
          "name": "X-Finnhub-Token"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Company seed list (lean but future-proof)\nconst companies = [\n  {\n    company_id: \"cmp_sap\",\n    company:    \"SAP\",\n    symbol:     \"SAP\",                 // ggf. \"SAP.DE\", aber konsistent bleiben\n    isin:       \"DE0007164600\",\n    domains:    [\"sap.com\"],\n    newsroom:   \"https://news.sap.com/\"\n  },\n  {\n    company_id: \"cmp_pltr\",\n    company:    \"Palantir\",\n    symbol:     \"PLTR\",\n    isin:       \"US69608A1088\",\n    domains:    [\"palantir.com\"],\n    newsroom:   \"https://www.palantir.com/news/\"\n  },\n  {\n    company_id: \"cmp_ibm\",\n    company:    \"IBM\",\n    symbol:     \"IBM\",\n    isin:       \"US4592001014\",\n    domains:    [\"ibm.com\"],\n    newsroom:   \"https://newsroom.ibm.com/\"\n  }\n];\n\n// Gib jedes Unternehmen als eigenes n8n-Item zurück\nreturn companies.map(c => ({\n  json: {\n    company_id: c.company_id,   // ← Upsert-Key in Google Sheets\n    company:    c.company,\n    symbol:     c.symbol,       // ← in HTTP Request: ?symbol={{$json.symbol}}\n    isin:       c.isin ?? null,\n    domains:    c.domains ?? [],\n    newsroom:   c.newsroom ?? null\n  }\n}));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8688,
        320
      ],
      "id": "e0b894a0-2bec-4926-b6ee-c903c567b41a",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "url": "https://finnhub.io/api/v1/stock/profile2",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "symbol",
              "value": "={{ $json.symbol }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8192,
        368
      ],
      "id": "4bfef5f1-a574-474a-bb4a-ac24bc38d236",
      "name": "HTTP Request1",
      "alwaysOutputData": false,
      "executeOnce": false,
      "retryOnFail": false,
      "credentials": {
        "httpHeaderAuth": {
          "id": "oNbZkPSClDxcV7sx",
          "name": "X-Finnhub-Token"
        }
      }
    },
    {
      "parameters": {
        "url": "https://finnhub.io/api/v1/stock/recommendation",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "symbol",
              "value": "={{ $json.symbol }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8192,
        672
      ],
      "id": "02217f56-c3a1-4408-8540-d62ea0d8e37c",
      "name": "HTTP Request2",
      "alwaysOutputData": false,
      "executeOnce": false,
      "retryOnFail": false,
      "credentials": {
        "httpHeaderAuth": {
          "id": "oNbZkPSClDxcV7sx",
          "name": "X-Finnhub-Token"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Map Quote + Identity (reads fields from Set/Edit Fields; falls fehlend: fallback auf Firmenliste)\nfunction num(v){ const n = Number(v); return Number.isFinite(n) ? n : null; }\n\n// 1) Quote liegt im aktuellen Item (HTTP-Output)\nconst q = $json || {};\n\n// 2) Identity bevorzugt aus Set-Node, sonst aus Firmenliste (gleicher Index)\nconst base = {\n  company_id: $json.company_id ?? $items(\"Code in JavaScript2\", 0, $itemIndex).json.company_id ?? null,\n  company:    $json.company    ?? $items(\"Code in JavaScript2\", 0, $itemIndex).json.company    ?? null,\n  symbol:     $json.symbol     ?? $items(\"Code in JavaScript2\", 0, $itemIndex).json.symbol     ?? null,\n};\n\n// optionaler Key aus Symbol (falls du zusätzlich einen brauchst)\nconst key = $json.key ?? (base.symbol ? String(base.symbol).toLowerCase() : null);\n\n// 3) Quote-Berechnungen\nconst c  = num(q.c);\nconst pc = num(q.pc);\nconst d  = (q.d  != null) ? num(q.d)  : (c!=null && pc!=null ? +(c - pc).toFixed(2) : null);\nconst dp = (q.dp != null) ? num(q.dp) : (c!=null && pc!=null ? +(((c - pc) / pc) * 100).toFixed(2) : null);\n\n// 4) Ergebnis\nreturn {\n  json: {\n    company_id: base.company_id,\n    company:    base.company,\n    symbol:     base.symbol,\n    key,                               // optional; kannst du auch weglassen\n\n    price_last:       c,\n    price_prev_close: pc,\n    change_abs:       d,\n    change_pct:       dp,\n\n    quote_time_unix: q.t ?? null,\n    quote_time_iso:  q.t ? new Date(q.t * 1000).toISOString() : null,\n\n    source_quote: \"finnhub:quote\",\n    updated_at:   new Date().toISOString()\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7520,
        128
      ],
      "id": "5fb5747b-d9e5-4501-a171-8f37d203c67b",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "aeb1dd31-58ea-4b25-b3d3-6653538b1259",
              "name": "company_id",
              "value": "={{ $('Code in JavaScript2').item.json.company_id }}",
              "type": "string"
            },
            {
              "id": "0083bd10-93d1-41f9-8135-30b8e2a03c7a",
              "name": "company",
              "value": "={{ $('Code in JavaScript2').item.json.company }}",
              "type": "string"
            },
            {
              "id": "ab0caeb0-37aa-4888-a54e-dba137d3e2fc",
              "name": "symbol",
              "value": "={{ $('Code in JavaScript2').item.json.symbol }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -7888,
        128
      ],
      "id": "c0b63339-d82f-4792-9c36-6f4413aa2c6d",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1i1sQ1SFxLjceR7di4Ji-U4JI4nBszTkC4fEfIF4BVoo",
          "mode": "list",
          "cachedResultName": "Celonis Scraping data DEMO",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i1sQ1SFxLjceR7di4Ji-U4JI4nBszTkC4fEfIF4BVoo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Tabellenblatt1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i1sQ1SFxLjceR7di4Ji-U4JI4nBszTkC4fEfIF4BVoo/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "symbol": "={{ $json.symbol }}",
            "company_id": "={{ $json.company_id }}",
            "company": "={{ $json.company }}",
            "price_last": "={{ $json.price_last }}",
            "price_prev_close": "={{ $json.price_prev_close }}",
            "change_abs": "={{ $json.change_abs }}",
            "change_pct": "={{ $json.change_pct }}",
            "market_cap_b": "={{ $json.market_cap_b }}",
            "market_cap_usd": "={{ $json.market_cap_usd_m }}",
            "analyst_buy": "={{ $json.rec_buy }}",
            "analyst_hold": "={{ $json.rec_hold }}",
            "analyst_sell": "={{ $json.rec_sell }}",
            "analyst_strongSell": "={{ $json.rec_strongSell }}",
            "source_reco": "={{ $json.source_reco }}"
          },
          "matchingColumns": [
            "symbol"
          ],
          "schema": [
            {
              "id": "company_id",
              "displayName": "company_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "company",
              "displayName": "company",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "symbol",
              "displayName": "symbol",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "isin",
              "displayName": "isin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "price_last",
              "displayName": "price_last",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "price_prev_close",
              "displayName": "price_prev_close",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "change_abs",
              "displayName": "change_abs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "change_pct",
              "displayName": "change_pct",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "market_cap_usd",
              "displayName": "market_cap_usd",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "market_cap_b",
              "displayName": "market_cap_b",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "analyst_buy",
              "displayName": "analyst_buy",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "analyst_hold",
              "displayName": "analyst_hold",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "analyst_sell",
              "displayName": "analyst_sell",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "analyst_strongBuy",
              "displayName": "analyst_strongBuy",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "analyst_strongSell",
              "displayName": "analyst_strongSell",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "analyst_period",
              "displayName": "analyst_period",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "quote_time_unix",
              "displayName": "quote_time_unix",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "quote_time_iso",
              "displayName": "quote_time_iso",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "source_quote",
              "displayName": "source_quote",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "source_profile",
              "displayName": "source_profile",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "source_reco",
              "displayName": "source_reco",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -6608,
        464
      ],
      "id": "16076443-6fec-403f-933c-02c117ac22a5",
      "name": "Append or update row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "IudK5EU2GzoeEgQX",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "function num(v){ const n = Number(v); return Number.isFinite(n) ? n : null; }\n\nconst company_id = $json.company_id;   // per Edit Fields in den Zweig kopiert\nconst company    = $json.company;\nconst symbol     = $json.symbol;\n\nconst p = $json;\nconst mcUsdM = num(p.marketCapitalization);                // USD **Millionen**\nconst market_cap_b = mcUsdM != null ? +(mcUsdM / 1000).toFixed(2) : null;\n\nreturn {\n  json: {\n    company_id, company, symbol,\n    market_cap_usd_m: mcUsdM,           // optional: Rohwert in Mio. lassen\n    market_cap_b,                        // korrigiert: Milliarden\n    currency: p.currency ?? null,\n    exchange: p.exchange ?? null,\n    name_official: p.name ?? null,\n    ticker_reported: p.ticker ?? null,\n    country: p.country ?? null,\n    ipo_date: p.ipo ?? null,\n    industry: p.finnhubIndustry ?? null,\n    share_outstanding_m: num(p.shareOutstanding),\n    weburl: p.weburl ?? null,\n    logo: p.logo ?? null,\n    source_profile: \"finnhub:profile2\",\n    updated_at: new Date().toISOString(),\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7520,
        368
      ],
      "id": "35a320f8-1570-4770-998c-d852dc0c3fa1",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "aeb1dd31-58ea-4b25-b3d3-6653538b1259",
              "name": "company_id",
              "value": "={{ $('Code in JavaScript2').item.json.company_id }}",
              "type": "string"
            },
            {
              "id": "0083bd10-93d1-41f9-8135-30b8e2a03c7a",
              "name": "company",
              "value": "={{ $('Code in JavaScript2').item.json.company }}",
              "type": "string"
            },
            {
              "id": "ab0caeb0-37aa-4888-a54e-dba137d3e2fc",
              "name": "symbol",
              "value": "={{ $('Code in JavaScript2').item.json.symbol }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -7888,
        368
      ],
      "id": "3a109933-17a9-46dd-8170-43e6af655f47",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "mode": "combine",
        "fieldsToMatchString": "company_id",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -7216,
        240
      ],
      "id": "3c61f4d9-39c8-4490-b26e-003ed0da28dc",
      "name": "Merge"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b1c69f96-76c8-4031-b120-5d32da4e001d",
              "name": "company_id",
              "value": "={{ $('Code in JavaScript2').item.json.company_id }}",
              "type": "string"
            },
            {
              "id": "37f90ad2-5d00-4ca4-b75b-233e24bb1a6b",
              "name": "company",
              "value": "={{ $('Code in JavaScript2').item.json.company }}",
              "type": "string"
            },
            {
              "id": "4a26a665-6e61-4f94-9529-60b4316832bb",
              "name": "symbol",
              "value": "={{ $('Code in JavaScript2').item.json.symbol }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -7888,
        672
      ],
      "id": "b22c7304-081a-400b-a16d-ca40701d2b1e",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "function num(v){ const n = Number(v); return Number.isFinite(n) ? n : 0; }\nconst r = $json;\n\nconst strongBuy  = num(r.strongBuy);\nconst buy        = num(r.buy);\nconst hold       = num(r.hold);\nconst sell       = num(r.sell);\nconst strongSell = num(r.strongSell);\nconst total      = strongBuy + buy + hold + sell + strongSell;\nconst index      = total ? ((2*strongBuy + 1*buy - 1*sell - 2*strongSell) / (2*total)) : null;\n\nlet label = null;\nif (index !== null) {\n  label = index >=  0.5 ? \"Strong Buy\" :\n          index >=  0.1 ? \"Buy\" :\n          index <= -0.5 ? \"Strong Sell\" :\n          index <= -0.1 ? \"Sell\" : \"Hold\";\n}\n\nreturn {\n  json: {\n    company_id: $json.company_id ?? null, // aus Edit Fields\n    company:    $json.company ?? null,\n    symbol:     $json.symbol,\n\n    rec_period:      r.period,\n    rec_strongBuy:   strongBuy,\n    rec_buy:         buy,\n    rec_hold:        hold,\n    rec_sell:        sell,\n    rec_strongSell:  strongSell,\n    rec_total:       total,\n    rec_index:       index !== null ? +index.toFixed(3) : null,\n    rec_label:       label,\n\n    source_reco:     \"finnhub:recommendation-trends\",\n    reco_updated_at: new Date().toISOString(),\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7520,
        672
      ],
      "id": "0da09f72-b99d-4382-a01e-88ad45b04ed2",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "jsCode": "// Gruppiere alle Recos nach company_id, wähle pro Firma den jüngsten Monat\nfunction num(v){ const n = Number(v); return Number.isFinite(n) ? n : 0; }\n\nconst all = $input.all().map(it => it.json);\nconst byCompany = new Map();\nfor (const r of all) {\n  const k = r.company_id || r.symbol;\n  if (!k) continue;\n  if (!byCompany.has(k)) byCompany.set(k, []);\n  byCompany.get(k).push(r);\n}\n\nconst out = [];\nfor (const [k, arr] of byCompany) {\n  // neueste zuerst\n  arr.sort((a,b) => a.rec_period < b.rec_period ? 1 : a.rec_period > b.rec_period ? -1 : 0);\n  const cur = arr[0];\n  const prev = arr[1] || null;\n\n  // Index & Label sind schon im Mapping – hier nur MoM-Delta berechnen\n  const curIdx  = cur.rec_index ?? null;\n  const prevIdx = prev ? prev.rec_index ?? null : null;\n  const mom     = (curIdx != null && prevIdx != null) ? +(curIdx - prevIdx).toFixed(3) : null;\n\n  out.push({\n    json: {\n      company_id: cur.company_id,\n      company:    cur.company,\n      symbol:     cur.symbol,\n\n      rec_period:      cur.rec_period,\n      rec_strongBuy:   cur.rec_strongBuy,\n      rec_buy:         cur.rec_buy,\n      rec_hold:        cur.rec_hold,\n      rec_sell:        cur.rec_sell,\n      rec_strongSell:  cur.rec_strongSell,\n      rec_total:       cur.rec_total,\n      rec_index:       cur.rec_index,\n      rec_label:       cur.rec_label,\n      rec_index_mom:   mom,                 // Veränderung ggü. Vormonat\n\n      source_reco:     cur.source_reco,\n      reco_updated_at: new Date().toISOString(),\n    }\n  });\n}\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7216,
        672
      ],
      "id": "b6f57931-2410-4dca-bce2-af444b98ff05",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "mode": "combine",
        "fieldsToMatchString": "company_id",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -6944,
        464
      ],
      "id": "19d0868b-1f2f-4f56-ae92-cdfee71b5847",
      "name": "Merge1"
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.content || $json.data || $json.text || $json.concatenated_data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "=file_id",
                "value": "={{ $('Set File ID').first().json.file_id }}"
              },
              {
                "name": "file_title",
                "value": "={{ $('Set File ID').first().json.file_title }}"
              }
            ]
          }
        }
      },
      "id": "ce1a0cbe-cc38-4295-93f2-2c25f916a238",
      "name": "Default Data Loader",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        560,
        5840
      ]
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "10cedee4-e1fc-4971-9c8f-61cc1ffb0415",
      "name": "Embeddings OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        352,
        5840
      ],
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Agent Tools for RAG",
        "height": 528.85546469693,
        "width": 583.4552380860637,
        "color": 4
      },
      "id": "e378904b-e7f9-498e-84dd-a75c8e64347a",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -448,
        4736
      ]
    },
    {
      "parameters": {
        "content": "## Tool to Add a Google Drive File to Vector DB",
        "height": 867,
        "width": 3073,
        "color": 5
      },
      "id": "62270597-9d84-4fe4-9069-698b1bdee52d",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2192,
        5280
      ]
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Set File ID').item.json.file_id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "id": "0070b674-ab76-444f-8328-ac1a00e801e2",
      "name": "Download File",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -1104,
        5568
      ],
      "executeOnce": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "EtoD5M5VkxmgKqlr",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1CqgeO9Wd9WrDE0oOJQpohe8VMp43AptQ",
          "mode": "list",
          "cachedResultName": "Celonis_All_Data",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1CqgeO9Wd9WrDE0oOJQpohe8VMp43AptQ"
        },
        "event": "fileCreated",
        "options": {}
      },
      "id": "cb29c7d1-a1f0-432d-a2b9-60ace029ca3d",
      "name": "File Created",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -2128,
        5408
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "EtoD5M5VkxmgKqlr",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1CqgeO9Wd9WrDE0oOJQpohe8VMp43AptQ",
          "mode": "list",
          "cachedResultName": "Celonis_All_Data",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1CqgeO9Wd9WrDE0oOJQpohe8VMp43AptQ"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "id": "7a30e0ff-70c5-4ffb-9703-1ce46e7a920d",
      "name": "File Updated",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -2128,
        5568
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "EtoD5M5VkxmgKqlr",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "id": "a2e26d39-5352-4e3f-adee-bbfe9ad71214",
      "name": "Extract Document Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -400,
        5984
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {},
      "id": "0ea99535-70d5-4128-a5a0-aa0492955eb9",
      "name": "Postgres Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1,
      "position": [
        -1056,
        5104
      ],
      "notesInFlow": false,
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "10646eae-ae46-4327-a4dc-9987c2d76173",
              "name": "file_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "f4536df5-d0b1-4392-bf17-b8137fb31a44",
              "name": "file_type",
              "value": "={{ $json.mimeType }}",
              "type": "string"
            },
            {
              "id": "77d782de-169d-4a46-8a8e-a3831c04d90f",
              "name": "file_title",
              "value": "={{ $json.name }}",
              "type": "string"
            },
            {
              "id": "9bde4d7f-e4f3-4ebd-9338-dce1350f9eab",
              "name": "file_url",
              "value": "={{ $json.webViewLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "d53a35ec-0158-4f54-8b8d-67ad700a9222",
      "name": "Set File ID",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1776,
        5568
      ]
    },
    {
      "parameters": {
        "content": "## RAG AI Agent with Chat Interface",
        "height": 464.8027193303974,
        "width": 1035.6381264595484
      },
      "id": "8ec807b9-9602-4a51-bf6c-61ea9aae94af",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1488,
        4800
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "752418be-a1da-46e7-a146-e6cd37eba2c4",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -624,
        4880
      ]
    },
    {
      "parameters": {
        "public": true,
        "mode": "webhook",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "id": "edd1f2fe-e93e-497b-bd06-63004beac5cb",
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -1456,
        4880
      ],
      "webhookId": "272b6878-11c1-49e3-91b8-3e403b89b3cc"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "1bde2cf3-d62c-475a-90b4-8846305c3ee9",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "id": "f4227b2e-1177-4faf-9fd7-e274e8926200",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1456,
        5088
      ],
      "webhookId": "1bde2cf3-d62c-475a-90b4-8846305c3ee9"
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "800cf11c-0ad3-4b1a-bbf2-2c694ad0c0e6",
      "name": "Extract PDF Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -400,
        5808
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "977cb7b8-45db-4c1b-a6a2-2be9268df5ca",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -192,
        5376
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "6593b2a6-2587-4cec-acfb-cc9a5802c11e",
      "name": "Summarize",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        16,
        5456
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "You are a personal assistant who helps answer questions from a corpus of documents. The documents are either text based (Txt, docs, extracted PDFs, etc.) or tabular data (CSVs or Excel documents).\n\nYou are given tools to perform RAG in the 'documents' table, look up the documents available in your knowledge base in the 'document_metadata' table, extract all the text from a given document, and query the tabular files with SQL in the 'document_rows' table.\n\nAlways start by performing RAG unless the question requires a SQL query for tabular data (fetching a sum, finding a max, something a RAG lookup would be unreliable for). If RAG doesn't help, then look at the documents that are available to you, find a few that you think would contain the answer, and then analyze those.\n\nAlways tell the user if you didn't find the answer. Don't make something up just to please them."
        }
      },
      "id": "cd84ea95-0f96-4fad-8ef4-d7f36843d9bc",
      "name": "RAG AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -976,
        4880
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "2ae7faa7-a936-4621-a680-60c512163034",
                    "leftValue": "=FixedExpression{{ $('Set File ID').item.json.file_type }}FixedExpressionRename Output FixedExpression{{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "fc193b06-363b-4699-a97d-e5a850138b0e",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "=application/vnd.google-apps.spreadsheet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "5fe78f9b-2ff3-4adc-954e-53bfce35c142"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "b69f5605-0179-4b02-9a32-e34bb085f82d",
                    "leftValue": "={{ $('Set File ID').item.json.file_type }}",
                    "rightValue": "application/vnd.google-apps.document",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "f7001ec4-95ee-498e-a956-18f6d73dca8f",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -912,
        5536
      ]
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {}
      },
      "id": "170c7620-8a6e-4a26-854e-ec0e3bda4826",
      "name": "Extract from Excel",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -400,
        5376
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f422e2e0-381c-46ea-8f38-3f58c501d8b9",
              "name": "schema",
              "value": "={{ $('Extract from Excel').isExecuted ? $('Extract from Excel').first().json.keys().toJsonString() : $('Extract from CSV').first().json.keys().toJsonString() }}",
              "type": "string"
            },
            {
              "id": "bb07c71e-5b60-4795-864c-cc3845b6bc46",
              "name": "data",
              "value": "={{ $json.concatenated_data }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        432,
        5392
      ],
      "id": "da0a93fb-ecc0-453e-95e3-2bc0acb0fd7d",
      "name": "Set Schema"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -400,
        5552
      ],
      "id": "7d75ad35-70e4-4fb7-9865-7e836e54c293",
      "name": "Extract from CSV"
    },
    {
      "parameters": {
        "content": "## Run Each Node Once to Set Up Database Tables",
        "height": 300,
        "width": 680,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2192,
        4960
      ],
      "typeVersion": 1,
      "id": "d7893859-241a-4c97-9088-8e8b568df454",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE document_metadata (\n    id TEXT PRIMARY KEY,\n    title TEXT,\n    url TEXT,\n    created_at TIMESTAMP DEFAULT NOW(),\n    schema TEXT\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -2080,
        5056
      ],
      "id": "d2923fde-8946-404f-b627-32e75b981fa6",
      "name": "Create Document Metadata Table",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE document_rows (\n    id SERIAL PRIMARY KEY,\n    dataset_id TEXT REFERENCES document_metadata(id),\n    row_data JSONB  -- Store the actual row data\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -1776,
        5056
      ],
      "id": "7256580f-9375-48fa-a437-1ef3df20e69f",
      "name": "Create Document Rows Table (for Tabular Data)",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Use this tool to fetch all available documents, including the table schema if the file is a CSV or Excel file.",
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -912,
        5104
      ],
      "id": "9efcabe2-01cb-4295-afd1-4d8b4c45b239",
      "name": "List Documents",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Given a file ID, fetches the text from the document.",
        "operation": "executeQuery",
        "query": "SELECT string_agg(text, ' ' ORDER BY (metadata->>'chunk')::int) AS document_text\nFROM content\nWHERE metadata->>'file_id' = $1\nGROUP BY metadata->>'file_id';\n",
        "options": {
          "queryReplacement": "={{ $fromAI('file_id') }}"
        }
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -768,
        5104
      ],
      "id": "6535274c-e75a-4ca8-ab4f-5671a015ca94",
      "name": "Get File Contents",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Run a SQL query - use this to query from the document_rows table once you know the file ID you are querying. dataset_id is the file_id and you are always using the row_data for filtering, which is a jsonb field that has all the keys from the file schema given in the document_metadata table.\n\nExample query:\n\nSELECT AVG((row_data->>'revenue')::numeric)\nFROM document_rows\nWHERE dataset_id = '123';\n\nExample query 2:\n\nSELECT \n    row_data->>'category' as category,\n    SUM((row_data->>'sales')::numeric) as total_sales\nFROM dataset_rows\nWHERE dataset_id = '123'\nGROUP BY row_data->>'category';",
        "operation": "executeQuery",
        "query": "{{ $fromAI('sql_query') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -608,
        5104
      ],
      "id": "72851916-5f45-433d-9997-7a530166d977",
      "name": "Query Document Rows",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -320,
        5088
      ],
      "id": "e26dfd50-f709-4eeb-b6c0-d5a8e486ce2a",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1952,
        5408
      ],
      "id": "bab8101d-54b2-4440-a3dd-5c5a628eaa7e",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Set File ID').item.json.file_id }}",
            "title": "={{ $('Set File ID').item.json.file_title }}",
            "url": "={{ $('Set File ID').item.json.file_url }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": false
            },
            {
              "id": "schema",
              "displayName": "schema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -1264,
        5424
      ],
      "id": "a4222b69-e74b-4b73-a56f-05219e924378",
      "name": "Insert Document Metadata",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_rows",
          "mode": "list",
          "cachedResultName": "document_rows"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "dataset_id": "={{ $('Set File ID').item.json.file_id }}",
            "row_data": "={{ $json.toJsonString().replaceAll(/'/g, \"''\") }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "dataset_id",
              "displayName": "dataset_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_data",
              "displayName": "row_data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -192,
        5552
      ],
      "id": "ae5fe373-535f-4c4a-9d3f-7f04111255d3",
      "name": "Insert Table Rows",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Set File ID').item.json.file_id }}",
            "schema": "={{ $json.schema }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": false
            },
            {
              "id": "schema",
              "displayName": "schema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        656,
        5392
      ],
      "id": "ade8a6d0-fca2-46ae-9028-884475eeee09",
      "name": "Update Schema for Document Metadata",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "topN": 4
      },
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        -112,
        5088
      ],
      "id": "ce083efa-d921-439a-9571-d75c84cd3d5a",
      "name": "Reranker Cohere",
      "disabled": true
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use RAG to look up information in the knowledgebase.",
        "tableName": "content",
        "topK": 25,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        -256,
        4960
      ],
      "id": "207b8ef7-9438-4c03-a39c-1695cbea3662",
      "name": "Postgres PGVector Store",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": "content",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        432,
        5584
      ],
      "id": "13a06b1e-67ff-4d5c-b45f-7cd7f334ca76",
      "name": "Postgres PGVector Store1",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DO $$\nBEGIN\n    IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'documents_pg') THEN\n        EXECUTE 'DELETE FROM documents_pg WHERE metadata->>''file_id'' LIKE ''%' || $1 || '%''';\n    END IF;\nEND\n$$;",
        "options": {
          "queryReplacement": "={{ $json.file_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1600,
        5424
      ],
      "id": "b1093e41-337d-4fa1-a972-dae2dbfbc7e3",
      "name": "Delete Old Data Rows",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DELETE FROM document_rows\nWHERE dataset_id LIKE '%' || $1 || '%';",
        "options": {
          "queryReplacement": "={{ $('Set File ID').item.json.file_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1424,
        5584
      ],
      "id": "b202698b-0cc6-4f6f-9339-fbb84c761c10",
      "name": "Delete Old Doc Rows",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://www.googleapis.com/drive/v3/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "'1g7rnJHz14qbKel3CchFM6S0osMgXXblT' in parents and trashed = true"
            },
            {
              "name": "fields",
              "value": "files(id,name,mimeType,webViewLink,trashed,trashedTime)"
            },
            {
              "name": "pageSize",
              "value": "1000"
            }
          ]
        },
        "options": {}
      },
      "id": "ec627d05-571e-4c0d-a04b-4b018c531c03",
      "name": "Get Trashed Files via API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -1888,
        6288
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "EtoD5M5VkxmgKqlr",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse the response from Google Drive API\nconst response = $input.first().json;\nconst trashedFiles = response.files || [];\n\nif (trashedFiles.length === 0) {\n  return [{ message: 'No trashed files found', count: 0 }];\n}\n\n// Return each file as a separate item for processing\nreturn trashedFiles.map(file => ({\n  file_id: file.id,\n  file_name: file.name,\n  file_type: file.mimeType,\n  file_url: file.webViewLink,\n  trashed_time: file.trashedTime\n}));"
      },
      "id": "4d863700-f955-4fb8-a576-195ab6b78282",
      "name": "Parse Trashed Files",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1696,
        6288
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "conditions": [
              {
                "value1": "={{ $json.file_id }}",
                "operation": "isNotEmpty"
              }
            ]
          }
        },
        "options": {}
      },
      "id": "9191cab5-baff-4a69-89ab-a8d24ce0bd57",
      "name": "Has Files to Delete?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1488,
        6288
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT id FROM document_metadata WHERE id = '{{ $json.file_id }}'",
        "options": {}
      },
      "id": "1f973faa-ec5b-49c2-8978-bc69f7e14ee2",
      "name": "Check If Exists in DB",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -1296,
        6288
      ],
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "992a20a8-5b6a-4ea4-b021-7458435e131a",
              "leftValue": "",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "98da886f-3c7b-41c2-a586-ef29366fa084",
      "name": "Exists in DB?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1088,
        6288
      ]
    },
    {
      "parameters": {
        "content": "## Vector Store Cleanup (Periodically)\nScan the Google Drive Folder regularely and deletes non existent documents from the vector store as well.",
        "height": 305,
        "width": 1976,
        "color": 6
      },
      "id": "93e24366-dec3-4f6f-8c7b-94d31b0ea165",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2192,
        6176
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DELETE FROM document_metadata WHERE id = '{{ $('Parse Trashed Files').first().json.file_id }}'",
        "options": {}
      },
      "id": "b9422381-b308-4208-815f-1a6101197324",
      "name": "Delete Metadata",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -480,
        6288
      ],
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 15
            }
          ]
        }
      },
      "id": "ebf8df37-dd08-495b-87a1-017cd68f9dd5",
      "name": "Check Every 15 Minutes",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -2096,
        6288
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DO $$\nBEGIN\n    IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'documents_pg') THEN\n        EXECUTE 'DELETE FROM documents_pg WHERE metadata->>''file_id'' LIKE ''%' || $1 || '%''';\n    END IF;\nEND\n$$;",
        "options": {
          "queryReplacement": "={{ $('Parse Trashed Files').item.json.file_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -864,
        6288
      ],
      "id": "4c2f95fa-0dd7-43b9-b1a7-2bd03641d014",
      "name": "Delete Old Data Rows1",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DELETE FROM document_rows\nWHERE dataset_id LIKE '%' || $1 || '%';",
        "options": {
          "queryReplacement": "={{ $('Parse Trashed Files').first().json.file_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -672,
        6288
      ],
      "id": "8577142c-6ec9-43e7-a330-fa3f2b035ba7",
      "name": "Delete Old Doc Rows1",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        640,
        5984
      ],
      "id": "775da639-b80c-4ddd-946b-aee574896d0c",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "code": {
          "execute": {
            "code": "const { PromptTemplate } = require('@langchain/core/prompts');\n\nconst documentContent = $input.item.json?.data || $input.item.json?.text;\nconst maxChunkSize = 1000;\nconst minChunkSize = 400;\n\nif (!documentContent) {\n    throw new Error('No document found in input');\n}\n\nconst llm = await this.getInputConnectionData('ai_languageModel', 0);\n\nfunction cleanText(text) {\n    return text.replace(/\\s+/g, ' ').trim();\n}\n\nconst chunks = [];\nlet remainingText = cleanText(documentContent);\nlet chunkNumber = 1;\n\nif (remainingText.length <= maxChunkSize) {\n    chunks.push({\n        content: remainingText,\n        chunk: chunkNumber,\n        chunk_size: remainingText.length\n    });\n} else {\n    while (remainingText) {\n        const textToAnalyze = remainingText.substring(0, maxChunkSize);\n        \n        const promptText = `You are analyzing a document to find the best transition point to split it into meaningful sections.\n\nYour goal: Keep related content together and split where topics naturally transition.\n\nRead this text carefully and identify where one topic/section ends and another begins:\n\n${textToAnalyze}\n\nFind the best transition point that occurs BEFORE character position ${maxChunkSize}.\n\nLook for:\n- Section headings or topic changes\n- Paragraph boundaries where the subject shifts\n- Complete conclusions before new ideas start\n- Natural breaks between different aspects of the content\n\nOutput the LAST WORD that appears right before your chosen split point.\nJust the single word itself, nothing else.\nExample: If you want to split after \"The company was founded in 2022.\" then output: \"2022\"`;\n        \n        const prompt = PromptTemplate.fromTemplate(promptText);\n        const chain = prompt.pipe(llm);\n        \n        let breakPoint = maxChunkSize;\n        \n        try {\n            const response = await chain.invoke();\n            const responseText = response.content || response.text || response.toString();\n            const breakWord = responseText.trim();\n            \n            if (breakWord) {\n                // Find the last occurrence of this word in the text to analyze\n                const wordIndex = textToAnalyze.lastIndexOf(breakWord);\n                if (wordIndex !== -1) {\n                    // Split after the word (including any punctuation that follows)\n                    breakPoint = wordIndex + breakWord.length;\n                    // Move past any punctuation or single space after the word\n                    while (breakPoint < textToAnalyze.length && \n                           (textToAnalyze[breakPoint] === '.' || \n                            textToAnalyze[breakPoint] === '!' || \n                            textToAnalyze[breakPoint] === '?' || \n                            textToAnalyze[breakPoint] === ',' || \n                            textToAnalyze[breakPoint] === ';' || \n                            textToAnalyze[breakPoint] === ':' || \n                            textToAnalyze[breakPoint] === ' ')) {\n                        breakPoint++;\n                        // Stop after moving past one space\n                        if (textToAnalyze[breakPoint - 1] === ' ') break;\n                    }\n                    breakPoint = Math.min(breakPoint, maxChunkSize);\n                }\n            }\n        } catch (error) {\n            console.log('LLM failed to determine breakpoint, using max size:', error.message);\n            breakPoint = maxChunkSize;\n        }\n        \n        const chunk = remainingText.substring(0, breakPoint).trim();\n        \n        if (chunk) {\n            chunks.push({\n                content: chunk,\n                chunk: chunkNumber,\n                chunk_size: chunk.length\n            });\n            chunkNumber++;\n        }\n        \n        remainingText = remainingText.substring(breakPoint).trim();\n        \n        if (!remainingText) {\n            break;\n        }\n    }\n}\n\n// Merge chunks that are below minimum size with adjacent chunks if possible\nlet i = 0;\nwhile (i < chunks.length) {\n    if (chunks[i].chunk_size < minChunkSize) {\n        // Try to merge with next chunk first if it exists and won't exceed max\n        if (i + 1 < chunks.length && \n            chunks[i].chunk_size + chunks[i + 1].chunk_size <= maxChunkSize) {\n            // Merge current with next\n            chunks[i].content += ' ' + chunks[i + 1].content;\n            chunks[i].chunk_size = chunks[i].content.length;\n            chunks.splice(i + 1, 1);\n            // Don't increment i, check this chunk again in case it's still small\n        } \n        // Otherwise try to merge with previous chunk if it exists and won't exceed max\n        else if (i > 0 && \n                 chunks[i - 1].chunk_size + chunks[i].chunk_size <= maxChunkSize) {\n            // Merge current into previous\n            chunks[i - 1].content += ' ' + chunks[i].content;\n            chunks[i - 1].chunk_size = chunks[i - 1].content.length;\n            chunks.splice(i, 1);\n            // Don't increment i, we removed current chunk\n        } else {\n            // Can't merge without exceeding max, move on\n            i++;\n        }\n    } else {\n        i++;\n    }\n}\n\nconst returnData = chunks.map(chunk => ({\n    json: chunk\n}));\n\nreturn returnData;"
          }
        },
        "inputs": {
          "input": [
            {
              "type": "ai_languageModel",
              "maxConnections": 1,
              "required": true
            },
            {
              "type": "main",
              "required": true
            }
          ]
        },
        "outputs": {
          "output": [
            {
              "type": "main"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.code",
      "typeVersion": 1,
      "position": [
        -128,
        5808
      ],
      "id": "5923fc77-9b15-4661-9e58-7cfc6f9c1579",
      "name": "LangChain Code"
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "a74fb092-5ae4-4d16-8fd7-830aac876629",
      "name": "OpenAI Chat Model2",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -1184,
        5104
      ],
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9a9a245e-f1a1-4282-bb02-a81ffe629f0f",
              "name": "chatInput",
              "value": "={{ $json?.chatInput || $json.body.chatInput }}",
              "type": "string"
            },
            {
              "id": "b80831d8-c653-4203-8706-adedfdb98f77",
              "name": "sessionId",
              "value": "={{ $json?.sessionId || $json.body.sessionId}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "51901365-aebf-4f7f-8936-dc70463d6962",
      "name": "Edit Fields3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1184,
        4880
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -48,
        6000
      ],
      "id": "98a22c93-14f4-45b2-93d4-352ea20a560b",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// === KONFIGURATION ===\nconst MAX_EXECUTION_TIME_MS = 40000; \nconst MAX_INPUT_LENGTH = 300000;\nconst MAX_OUTPUT_ITEMS = 50;\n\nconst startTime = Date.now();\nconst out = [];\n\nfunction checkLimits() {\n  if (Date.now() - startTime > MAX_EXECUTION_TIME_MS) return true;\n  if (out.length >= MAX_OUTPUT_ITEMS) return true;\n  return false;\n}\n\n// Sicheres Chunking\nfunction chunkStringSafe(str, size = 1500) {\n  if (!str) return [];\n  const chunks = [];\n  let i = 0;\n  let safety = 0;\n  while (i < str.length) {\n    if (safety++ > 1000) break;\n    let end = Math.min(i + size, str.length);\n    // Versuchen, an einem Satzende zu schneiden (Punkt), wenn möglich\n    const lastDot = str.lastIndexOf('.', end);\n    if (lastDot > i && lastDot > end - 200) end = lastDot + 1;\n    \n    chunks.push(str.slice(i, end).trim());\n    i = end; // Kein Overlap nötig, wenn wir sauber schneiden, sonst: i += (size - 200);\n  }\n  return chunks;\n}\n\n// === HAUPT-LOGIK ===\nconst item = items[0]; \n\nif (item) {\n  try {\n    const firecrawlData = item.json.data || {};\n    let rawText = (firecrawlData.markdown || \"\").toString();\n    delete item.json.data; // RAM sparen\n\n    // Metadaten holen (vom Loop Node)\n    let sheetData = {};\n    try { sheetData = $('Loop Over Items1').first().json; } catch(e) { sheetData = item.json; }\n\n    const brand = sheetData.brand || \"Unknown\"; \n    const category = sheetData.category || \"general\";\n    const sourceUrl = sheetData.url || \"unknown_url\";\n    const pageTitle = firecrawlData.metadata?.title || \"Webpage\";\n    const scrapedAt = new Date().toISOString();\n\n    // Cleaning\n    if (rawText.length > MAX_INPUT_LENGTH) rawText = rawText.substring(0, MAX_INPUT_LENGTH);\n\n    if (rawText.length > 50 && !checkLimits()) {\n       let text = rawText\n         // Link-Müll entfernen (Feedack: \"[]() | []()\")\n         .replace(/\\[\\s*\\]\\([^)]+\\)\\s*(\\\\|\\s*\\|\\s*)?/g, \"\") \n         .replace(/!\\[.*?\\]\\(.*?\\)/g, \"\") \n         .replace(/(This site uses|We use) cookies.*?(manage|accept|settings).*?$/gim, \"\")\n         .replace(/UnderstoodManage Settings|Contact us/gi, \"\")\n         .replace(/Skip to content|Toggle navigation|Log in|Sign up/gi, \"\")\n         .replace(/\\n{3,}/g, \"\\n\\n\");\n         \n       rawText = null;\n\n       // Splitting\n       const parts = text.split(/(?=^#{1,3}\\s)/gm);\n       \n       let globalChunkCounter = 0; // Zähler für die Unique ID\n\n       for (const part of parts) {\n         if (checkLimits()) break; \n         if (part.length < 50) continue; // Zu kurz -> Weg damit (Quality Gate)\n\n         const headerMatch = part.match(/^(#{1,3})\\s+(.*)/);\n         const sectionTitle = headerMatch ? headerMatch[2].trim() : \"General\";\n         const body = part.replace(/^(#{1,3})\\s+(.*)/, \"\").trim();\n\n         // Quality Gate: Wenn Body fast leer oder nur Links -> Skip\n         if (body.length < 50) continue; \n\n         const fullContent = `Brand: ${brand}\\nCategory: ${category}\\nTitle: ${pageTitle}\\nSection: ${sectionTitle}\\n\\n${body}`;\n         const chunks = chunkStringSafe(fullContent);\n         \n         for (const chunk of chunks) {\n            if (checkLimits()) break;\n            \n            // UNIQUE ID GENERIEREN (Das ist der Fix für das Feedback!)\n            // Wir nutzen die URL + einen Zähler, damit jeder Schnipsel eindeutig ist.\n            // .replace entfernt Sonderzeichen aus der URL für saubere IDs\n            const safeUrlId = sourceUrl.replace(/[^a-zA-Z0-9]/g, \"\").substring(0, 50);\n            const uniqueId = `${safeUrlId}_${globalChunkCounter}`;\n\n            out.push({\n              json: {\n                // ID für die Datenbank (Upsert Key)\n                id: uniqueId, \n                \n                // Inhalt\n                pageContent: chunk,\n                \n                // Metadaten\n                metadata: {\n                  brand: brand,\n                  category: category,\n                  url: sourceUrl,\n                  title: pageTitle,\n                  section: sectionTitle,\n                  date: scrapedAt,\n                  type: \"web_scrape\"\n                }\n              }\n            });\n            globalChunkCounter++;\n         }\n       }\n    }\n  } catch (error) {\n    console.log(\"Error:\", error.message);\n  }\n}\n\nreturn out;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7424,
        2208
      ],
      "id": "ac9de47c-ce55-4253-8af0-27fc18e57f71",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "operation": "scrape",
        "url": "={{ $('Get row(s) in sheet').item.json.url }}",
        "scrapeOptions": {
          "options": {
            "formats": {
              "format": [
                {}
              ]
            },
            "headers": {}
          }
        },
        "requestOptions": {}
      },
      "type": "@mendable/n8n-nodes-firecrawl.firecrawl",
      "typeVersion": 1,
      "position": [
        -7680,
        2208
      ],
      "id": "5d446194-4c9c-49d5-bab3-941220b9c144",
      "name": "Scrape a url and get its content1",
      "credentials": {
        "firecrawlApi": {
          "id": "pi6BaLTfYabVXhAb",
          "name": "Firecrawl account"
        }
      }
    },
    {
      "parameters": {
        "content": "KPIS",
        "height": 1683,
        "width": 2961,
        "color": 5
      },
      "id": "e8b622d5-0282-4020-94b7-86f59f302473",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -9072,
        -352
      ]
    },
    {
      "parameters": {
        "content": "Mission/Values\n",
        "height": 1491,
        "width": 3089,
        "color": 5
      },
      "id": "54030b82-5974-4c9b-8ee2-43e88ecacf62",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -9008,
        1872
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1i1sQ1SFxLjceR7di4Ji-U4JI4nBszTkC4fEfIF4BVoo",
          "mode": "list",
          "cachedResultName": "Celonis Scraping data DEMO",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i1sQ1SFxLjceR7di4Ji-U4JI4nBszTkC4fEfIF4BVoo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 626875558,
          "mode": "list",
          "cachedResultName": "Values/Mission",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i1sQ1SFxLjceR7di4Ji-U4JI4nBszTkC4fEfIF4BVoo/edit#gid=626875558"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -8480,
        2192
      ],
      "id": "551a296c-712b-4c4e-bd9d-22a34eb1b5b5",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "IudK5EU2GzoeEgQX",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "712f7085-b692-4e3b-948a-9a90a50e3ddb",
              "leftValue": "={{ $json.status }}",
              "rightValue": "Done",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -8272,
        2192
      ],
      "id": "8c14cd12-b904-4533-89d4-9ba7f2cd6f24",
      "name": "Filter"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -8064,
        2192
      ],
      "id": "c9fed58a-f8b7-4669-842f-e06659354315",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fb45b7c8-a768-42f9-98db-ce386e416c5f",
              "name": "brand",
              "value": "={{ $('Get row(s) in sheet').item.json.brand }}",
              "type": "string"
            },
            {
              "id": "372edf41-ffaf-4611-bd9b-23ff82907f9b",
              "name": "category",
              "value": "={{ $('Get row(s) in sheet').item.json.category }}",
              "type": "string"
            },
            {
              "id": "6c686532-d253-443a-bf60-b07ac01f06c7",
              "name": "url",
              "value": "={{ $('Get row(s) in sheet').item.json.url }}",
              "type": "string"
            },
            {
              "id": "c14bf755-1218-4a87-ac49-ef3337e2a581",
              "name": "section",
              "value": "={{ $json.metadata.section }}",
              "type": "string"
            },
            {
              "id": "5417a02a-a3e1-4687-88b6-8b7310d3e787",
              "name": "date",
              "value": "={{ $json.metadata.date }}",
              "type": "string"
            },
            {
              "id": "7c30d254-b726-4c1e-adf8-647c70b21316",
              "name": "type",
              "value": "web_scrape",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -7088,
        2208
      ],
      "id": "1ecf55f0-fc68-4a69-b591-d797ad706c6d",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "bbc32ad3-7684-4a7d-b38e-31cc1102abd9",
      "name": "Embeddings OpenAI",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        -6864,
        2448
      ],
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": "content",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        -6784,
        2208
      ],
      "id": "c6ebd71e-0047-473c-a9fb-fb12b90004d5",
      "name": "Postgres PGVector Store2",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.pageContent }}",
        "textSplittingMode": "custom",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "id",
                "value": "={{ $json.id }}"
              },
              {
                "name": "brand",
                "value": "={{ $json.metadata.brand }}"
              },
              {
                "name": "category",
                "value": "={{ $json.metadata.category }}"
              },
              {
                "name": "url",
                "value": "={{ $json.metadata.url }}"
              },
              {
                "name": "title",
                "value": "={{ $json.metadata.title }}"
              },
              {
                "name": "section",
                "value": "={{ $json.metadata.section }}"
              },
              {
                "name": "date",
                "value": "={{ $json.metadata.date }}"
              },
              {
                "name": "type",
                "value": "={{ $json.type }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        -6656,
        2416
      ],
      "id": "6e0308ea-9468-4049-bd07-56d7a39b47b2",
      "name": "Default Data Loader1"
    },
    {
      "parameters": {
        "chunkSize": 20000
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        -6576,
        2624
      ],
      "id": "1d9f6462-1f02-484c-a9ec-28d1f16839bd",
      "name": "Character Text Splitter"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1i1sQ1SFxLjceR7di4Ji-U4JI4nBszTkC4fEfIF4BVoo",
          "mode": "list",
          "cachedResultName": "Celonis Scraping data DEMO",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i1sQ1SFxLjceR7di4Ji-U4JI4nBszTkC4fEfIF4BVoo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 626875558,
          "mode": "list",
          "cachedResultName": "Values/Mission",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1i1sQ1SFxLjceR7di4Ji-U4JI4nBszTkC4fEfIF4BVoo/edit#gid=626875558"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $('Get row(s) in sheet').item.json.row_number }}",
            "status": "Done"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "brand",
              "displayName": "brand",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "category",
              "displayName": "category",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -6432,
        2208
      ],
      "id": "929bb8ef-9c84-4059-a15d-81764d0820f4",
      "name": "Update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "IudK5EU2GzoeEgQX",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "692acff6c13ef94c17f67146",
        "returnAll": true
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -8080,
        848
      ],
      "id": "ad1f8f20-2c4b-4e38-9225-34d247046a30",
      "name": "Get many items",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "14fa539d-614a-41b5-9883-223ef5d1f549",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "7351113e-15f4-4f85-901e-9b09f5230468",
              "name": "company",
              "value": "={{ $json.fieldData.company }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -7840,
        848
      ],
      "id": "ce6d32c7-3fce-499c-bd49-e5e417935602",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "type": "code",
        "code": "// 1. Deine Wunsch-Reihenfolge\nconst order = ['SAP', 'Palantir', 'IBM'];\n\n// 2. Werte sicher abrufen (Fallback auf leeren String, falls Feld fehlt)\nconst valA = a.json.company ? a.json.company : '';\nconst valB = b.json.company ? b.json.company : '';\n\n// 3. Position in der Liste finden\nlet indexA = order.indexOf(valA);\nlet indexB = order.indexOf(valB);\n\n// 4. Wenn Firma nicht in der Liste, ab ans Ende (999)\nif (indexA === -1) {\n  indexA = 999;\n}\nif (indexB === -1) {\n  indexB = 999;\n}\n\n// 5. Vergleich mit garantiertem Return\nif (indexA < indexB) {\n  return -1;\n} else if (indexA > indexB) {\n  return 1;\n} else {\n  return 0;\n}"
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        -7600,
        928
      ],
      "id": "5d49b61c-d9b8-46fe-8db3-3cae2b877fd6",
      "name": "Sort"
    },
    {
      "parameters": {
        "jsCode": "// 1. Webflow-Daten (IDs) vom Node \"Sort\" holen\nconst webflowItems = $('Sort').all();\n\n// 2. Finnhub-Daten vom Node \"Merge1\" holen (WICHTIG: Dein korrekter Node!)\nconst finnhubItems = $('Merge1').all();\n\n// --- Logik ---\n\n// A. Telefonbuch bauen aus Webflow-Daten\nconst idMap = {};\n\nfor (const item of webflowItems) {\n    const name = item.json.company || item.json.name;\n    const id = item.json.id || item.json._id; // Webflow ID\n\n    if (name && id) {\n        idMap[name.trim().toLowerCase()] = id;\n    }\n}\n\n// B. Finnhub-Daten nehmen und ID als \"id\" anfügen\nreturn finnhubItems.map(item => {\n    const companyName = item.json.company;\n    const searchKey = companyName ? companyName.trim().toLowerCase() : \"\";\n    \n    // Nachschlagen\n    const foundId = idMap[searchKey];\n\n    return {\n        json: {\n            ...item.json, // Alle Finnhub Daten (c, dp, company...) behalten\n            \n            // HIER IST DIE ÄNDERUNG:\n            // Wir nennen es einfach \"id\" (statt _id oder webflow_item_id)\n            id: foundId || \"ID_NOT_FOUND\" \n        }\n    };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6880,
        784
      ],
      "id": "5932ecdf-923e-4266-9090-e84f09f06e47",
      "name": "Code in JavaScript10"
    },
    {
      "parameters": {
        "operation": "update",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "692acff6c13ef94c17f67146",
        "itemId": "={{ $json.id }}",
        "live": true,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "company-id",
              "fieldValue": "={{ $json.company_id }}"
            },
            {
              "fieldId": "company",
              "fieldValue": "={{ $json.company }}"
            },
            {
              "fieldId": "price-last",
              "fieldValue": "={{ $json.price_last }}"
            },
            {
              "fieldId": "price-prev-close",
              "fieldValue": "={{ $json.price_prev_close }}"
            },
            {
              "fieldId": "change-abs",
              "fieldValue": "={{ $json.change_abs }}"
            },
            {
              "fieldId": "change-pct",
              "fieldValue": "={{ $json.change_pct }}"
            },
            {
              "fieldId": "market-cap-usd",
              "fieldValue": "={{ $json.market_cap_usd_m }}"
            },
            {
              "fieldId": "market-cap-b",
              "fieldValue": "={{ $json.market_cap_b }}"
            },
            {
              "fieldId": "name",
              "fieldValue": "={{ $json.company }}"
            },
            {
              "fieldId": "slug",
              "fieldValue": "={{ $json.company_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -6608,
        736
      ],
      "id": "ed3839fc-0dfe-411d-ae37-2753a1d7ef09",
      "name": "Update an item1",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -8912,
        320
      ],
      "id": "31465821-f5eb-43ee-b1d6-86c3ce72c216",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "url": "=https://query1.finance.yahoo.com/v8/finance/chart/{{ $json.symbol }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "interval",
              "value": "1d"
            },
            {
              "name": "range",
              "value": "1y"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -8512,
        -32
      ],
      "id": "1bb3d30e-341f-4d34-b42d-620433d0ae7c",
      "name": "HTTP Request6"
    },
    {
      "parameters": {
        "jsCode": "// Wir holen ALLE Items (SAP, Palantir, IBM) auf einmal\nconst items = $input.all();\n\n// Wir gehen jedes Item einzeln durch (.map ist die Schleife)\nreturn items.map(item => {\n  \n  // Zugriff auf die Daten des aktuellen Items\n  // (Achtung: Falls Yahoo mal einen Fehler wirft, fangen wir das ab)\n  const chartDataRaw = item.json.chart && item.json.chart.result ? item.json.chart.result[0] : null;\n\n  // Fallback, falls Yahoo leer war (damit der Workflow nicht crasht)\n  if (!chartDataRaw) {\n    return {\n      json: {\n        ...item.json,\n        history_json_string: null // Kein Chart für dieses Item\n      }\n    };\n  }\n\n  const meta = chartDataRaw.meta;\n  const timestamps = chartDataRaw.timestamp || [];\n  const quotes = chartDataRaw.indicators.quote[0].close || [];\n\n  const labels = [];\n  const dataPoints = [];\n\n  for (let i = 0; i < timestamps.length; i++) {\n    if (quotes[i] !== null && quotes[i] !== undefined) {\n       const date = new Date(timestamps[i] * 1000).toISOString().split('T')[0];\n       labels.push(date);\n       dataPoints.push(quotes[i]);\n    }\n  }\n\n  // Chart.js Format bauen\n  const chartJsData = {\n    labels: labels,\n    datasets: [{\n      label: (meta.symbol || \"Stock\") + ' Price',\n      data: dataPoints,\n      borderColor: '#00D6E8',\n      fill: false,\n      pointRadius: 0 // Optional: Glattere Linie\n    }]\n  };\n\n  // Rückgabe für DIESES Item (mit allen alten Daten + neuem String)\n  return {\n    json: {\n      ...item.json, \n      history_json_string: JSON.stringify(chartJsData)\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8048,
        -64
      ],
      "id": "2881471c-8671-40ff-a940-c1c72adc45b1",
      "name": "Code in JavaScript16"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -7856,
        -256
      ],
      "id": "7ef50a84-0fd0-45fe-b740-57449d973bcc",
      "name": "Merge4"
    },
    {
      "parameters": {
        "jsCode": "// 1. Wir holen ALLE Items (SAP, Palantir, IBM) auf einmal in den Speicher\nconst items = $input.all();\n\n// 2. Wir gehen jedes Item einzeln durch (.map ist die Schleife)\nreturn items.map(item => {\n  \n  // Sicherheits-Check: Hat Yahoo überhaupt Daten geliefert?\n  const result = (item.json.chart && item.json.chart.result) ? item.json.chart.result[0] : null;\n\n  // Wenn keine Daten da sind (Fehler bei Yahoo), geben wir das Item unverändert zurück (ohne Chart)\n  if (!result) {\n    return {\n      json: {\n        ...item.json,\n        history_json_string: null \n      }\n    };\n  }\n\n  // Ab hier ist deine Logik exakt gleich, nur beziehen wir uns auf \"result\"\n  const meta = result.meta;\n  const timestamps = result.timestamp || [];\n  const quotes = result.indicators.quote[0].close || [];\n\n  const labels = [];\n  const dataPoints = [];\n\n  for (let i = 0; i < timestamps.length; i++) {\n    // Filter für Null-Werte\n    if (quotes[i] !== null && quotes[i] !== undefined) {\n       const date = new Date(timestamps[i] * 1000).toISOString().split('T')[0];\n       labels.push(date);\n       dataPoints.push(quotes[i]);\n    }\n  }\n\n  // Chart.js Format bauen\n  const chartData = {\n    labels: labels, // X-Achse\n    datasets: [{\n      label: (meta.symbol || \"Stock\") + ' Price',\n      data: dataPoints, // Y-Achse\n      borderColor: '#00D6E8', // Celonis Blau\n      backgroundColor: 'rgba(0, 214, 232, 0.1)',\n      pointRadius: 0, \n      borderWidth: 2,\n      fill: true \n    }]\n  };\n\n  // 3. Output für DIESES Item: Wir behalten alte Daten (...) und fügen den String hinzu\n  return {\n    json: {\n      ...item.json, // Behält company_id, symbol, etc.\n      history_json_string: JSON.stringify(chartData)\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7648,
        -256
      ],
      "id": "a45b4fbf-d59d-4235-8205-f2dbd755a929",
      "name": "Code in JavaScript17"
    },
    {
      "parameters": {
        "operation": "update",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "692acff6c13ef94c17f67146",
        "itemId": "={{ $json.id }}",
        "live": true,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "history",
              "fieldValue": "={{ $json.history_json_string }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -7136,
        -224
      ],
      "id": "a142c265-0c4a-4c3b-bddc-8de2ebcfa08f",
      "name": "Update an item2",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "fieldsToMatchString": "company",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -7440,
        -256
      ],
      "id": "edf9ecdb-d8cf-4b74-b3da-c02996e708b3",
      "name": "Merge5"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://google.serper.dev/search",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "PLACEHOLDER"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ $json.search_query }}"
            },
            {
              "name": "type",
              "value": "search"
            },
            {
              "name": "engine",
              "value": "google"
            },
            {
              "name": "num",
              "value": "100"
            },
            {
              "name": "tbs",
              "value": "qdr:y"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -8256,
        3856
      ],
      "id": "75a2495e-af88-4d23-9f58-0f12319a92db",
      "name": "HTTP Request7"
    },
    {
      "parameters": {
        "content": "News (Blog)\n",
        "height": 1507,
        "width": 2945,
        "color": 5
      },
      "id": "5b8c7295-c20f-45e7-a24f-ea7769a87d40",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -9008,
        5872
      ]
    },
    {
      "parameters": {
        "content": "Share of Voice",
        "height": 1491,
        "width": 2945,
        "color": 5
      },
      "id": "a6f0d195-f9d6-417a-85c6-30ecceb20921",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -8976,
        3696
      ]
    },
    {
      "parameters": {
        "jsCode": "// 1. Liste der Unternehmen\nconst companies = [\n  { company: \"Celonis\", id: \"693c600af42b3b79a1581896\" },\n  { company: \"ServiceNow\", id: \"693c0c224145ffa273ea5559\" },\n  { company: \"Appian\", id: \"693c0c06c667a1a8cbd8d424\" },\n  { company: \"Pega Systems\", id: \"693c0ba9a31b3711de08673e\" },\n  { company: \"Microsoft\", id: \"693c0b8649d1c552e280730d\" },\n  { company: \"UiPath\", id: \"693c0b1d27b0da9ed40e6349\" },\n  { company: \"Palantir\", id: \"692ca0e3867eb3e81c91461c\" },\n  { company: \"IBM\", id: \"692ca0e4056c5f1564819dfb\" },\n  { company: \"SAP\", id: \"692ca0e20ac6251eea542a27\" }\n];\n\n// 2. Deine Keywords\nconst keywords = [\n  \"digital banking transformation\",\n  \"object centric process mining\",\n  \"ocpm process mining\",\n  \"process mining\",\n  \"process mining simulation\",\n  \"process intelligence platform\"\n];\n\n// 3. String bauen (OHNE Anführungszeichen)\n// Wir verbinden sie nur mit OR. Die Klammern behalten wir, die sind wichtig für die Logik.\nconst keywordBlock = keywords.join(\" OR \");\n\n// 4. Output\nreturn companies.map(c => ({\n  json: {\n    company: c.company,\n    id: c.id,\n    // Ergebnis: Celonis (digital banking transformation OR process mining ...)\n    // Das ist sicher, sauber und wird von Serper akzeptiert.\n    search_query: `${c.company} (${keywordBlock})` \n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8512,
        3856
      ],
      "id": "613a1146-39cd-4a9b-a97d-7f43c67a1a2a",
      "name": "Code in JavaScript18"
    },
    {
      "parameters": {
        "content": "Youtube Workflow",
        "height": 1507,
        "width": 3345,
        "color": 5
      },
      "id": "fba2a9be-586e-4f49-b0d8-1e944bc9313b",
      "name": "Sticky Note22",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -9008,
        8016
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -8928,
        8160
      ],
      "id": "7d731259-aec1-49c0-927c-074d6b32d17e",
      "name": "Schedule Trigger2"
    },
    {
      "parameters": {
        "jsCode": "return [\n  // 1. CELONIS (Basis-Kanal)\n  // Größe: ~10k Subs. Trend-Alarm ab: 30 Views/Stunde.\n  {\n    json: {\n      company: \"Celonis\",\n      channel_id: \"UC5m7KqSu6qcalyQeDJ57q7A\",\n      uploads_playlist_id: \"UU5m7KqSu6qcalyQeDJ57q7A\", \n      threshold_vph: 30 \n    }\n  },\n\n  // 2. PALANTIR (Sehr aktiv, hohe \"Fan\"-Basis)\n  // Größe: ~140k Subs. Trend-Alarm ab: 150 Views/Stunde.\n  {\n    json: {\n      company: \"Palantir\",\n      channel_id: \"UCwed6_f0WcDIioXvMQfcP2Q\", \n      uploads_playlist_id: \"UUwed6_f0WcDIioXvMQfcP2Q\",\n      threshold_vph: 150\n    }\n  },\n\n  // 3. UIPATH (Marktführer RPA)\n  // Größe: ~70k Subs. Trend-Alarm ab: 80 Views/Stunde.\n  {\n    json: {\n      company: \"UiPath\",\n      channel_id: \"UCaCVGueKcvxnMjV1waiu5cA\",\n      uploads_playlist_id: \"UUaCVGueKcvxnMjV1waiu5cA\",\n      threshold_vph: 80\n    }\n  },\n\n  // 4. IBM (Main Brand Channel)\n  // Größe: ~115k Subs. Trend-Alarm ab: 100 Views/Stunde.\n  {\n    json: {\n      company: \"IBM\",\n      channel_id: \"UC8cc4pVKVHG7A9fbNsRNrLQ\",\n      uploads_playlist_id: \"UU8cc4pVKVHG7A9fbNsRNrLQ\",\n      threshold_vph: 100\n    }\n  },\n  \n   // 5. SAP TECHNOLOGY (Fokus auf Tech/Innovation)\n  // Größe: ~80k Subs. Trend-Alarm ab: 90 Views/Stunde.\n  {\n    json: {\n      company: \"SAP Technology\",\n      channel_id: \"UCVnIv2xF2wyMMCSKv1qF3pA\",\n      uploads_playlist_id: \"UUVnIv2xF2wyMMCSKv1qF3pA\",\n      threshold_vph: 90\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8720,
        8160
      ],
      "id": "d1f77650-2061-4d7f-ab8e-c5525e057b1b",
      "name": "Code in JavaScript31"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -8512,
        8160
      ],
      "id": "8b0624e1-4aba-404f-a613-e913e3bd283a",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {
        "resource": "playlistItem",
        "operation": "getAll",
        "playlistId": "={{ $json.uploads_playlist_id }}",
        "limit": 5,
        "options": {}
      },
      "type": "n8n-nodes-base.youTube",
      "typeVersion": 1,
      "position": [
        -8272,
        8192
      ],
      "id": "d0f95b38-5825-4e05-b2a3-d5338f4dc5c3",
      "name": "Get a playlist item",
      "credentials": {
        "youTubeOAuth2Api": {
          "id": "jDrRDAzck1rSBEyq",
          "name": "YouTube account"
        }
      }
    },
    {
      "parameters": {
        "resource": "video",
        "operation": "get",
        "videoId": "={{ $('Code in JavaScript35').item.json.video_id }}",
        "part": [
          "statistics"
        ],
        "options": {}
      },
      "type": "n8n-nodes-base.youTube",
      "typeVersion": 1,
      "position": [
        -7600,
        8208
      ],
      "id": "28a5b2d0-1bf0-471c-8c63-2c2de884ea41",
      "name": "Get a video",
      "credentials": {
        "youTubeOAuth2Api": {
          "id": "jDrRDAzck1rSBEyq",
          "name": "YouTube account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. DATEN SAMMELN\n// Wir holen die Stats vom aktuellen Input (YouTube Stats Node)\nconst stats = $json.statistics;\nconst videoId = $json.id;\n\n// Wir holen die Metadaten (Titel, Datum) vom Node DAVOR (PlaylistItems)\n// WICHTIG: Ersetze \"YouTube PlaylistItems\" mit dem exakten Namen deines Nodes!\nconst metaNode = $(\"Get a playlist item\").first(); \nconst meta = metaNode.json.snippet;\nconst config = $(\"Loop Over Items2\").first().json; // Deine Config (Thresholds)\n\n// 2. ZAHLEN AUFBEREITEN\nconst viewCount = parseInt(stats.viewCount || 0);\nconst likeCount = parseInt(stats.likeCount || 0);\nconst commentCount = parseInt(stats.commentCount || 0);\n\n// 3. ALTER BERECHNEN (in Stunden)\nconst now = new Date();\nconst publishedAt = new Date(meta.publishedAt);\nconst diffMs = now - publishedAt;\n// Mindestens 0.1 Stunden, um Division durch Null zu verhindern\nconst hoursOld = Math.max(diffMs / (1000 * 60 * 60), 0.1); \n\n// 4. TREND LOGIK (Die \"Intelligence\")\n// Metric A: Velocity (Views pro Stunde)\nconst viewsPerHour = viewCount / hoursOld;\n\n// Metric B: Engagement Rate (Likes im Verhältnis zu Views in %)\n// (Nur relevant, wenn es mehr als 50 Views gibt, sonst verfälscht ein Like alles)\nlet engagementRate = 0;\nif (viewCount > 50) {\n  engagementRate = (likeCount / viewCount) * 100;\n}\n\n// 5. ENTSCHEIDUNG: IST ES EIN TREND?\n// Szenario 1: Das Video geht viral (Hohe Views/Stunde)\nconst isViral = viewsPerHour > config.threshold_vph;\n\n// Szenario 2: Hohe Qualität (Moderater Speed, aber viele Likes)\n// Wenn es halb so schnell wächst wie nötig, aber 4% der Leute liken (sehr hoch für B2B), dann auch Trend.\nconst isQualityHit = (viewsPerHour > (config.threshold_vph / 2)) && (engagementRate > 3.0);\n\nconst isTrend = isViral || isQualityHit;\n\n// 6. FINALER OUTPUT FÜR WEBFLOW / AI\nreturn {\n  json: {\n    // Info für Webflow\n    title: meta.title,\n    video_id: videoId,\n    video_url: `https://www.youtube.com/watch?v=${videoId}`,\n    published_at: meta.publishedAt,\n    thumbnail: meta.thumbnails?.high?.url || meta.thumbnails?.default?.url,\n    \n    // Stats für Anzeige\n    views: viewCount,\n    likes: likeCount,\n    \n    // Intelligence für Logik\n    views_per_hour: Math.round(viewsPerHour),\n    engagement_rate_percent: parseFloat(engagementRate.toFixed(2)),\n    is_trend: isTrend, // <--- Das steuert deinen Webflow Toggle!\n    trend_reason: isViral ? \"High Velocity\" : (isQualityHit ? \"High Engagement\" : \"Normal\"),\n    \n    // Kontext für AI Summary\n    company: config.company\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7392,
        8208
      ],
      "id": "351f85b7-81ee-4448-87f2-e4ec019b0117",
      "name": "Code in JavaScript32"
    },
    {
      "parameters": {
        "operation": "Run actor and get dataset",
        "actorId": {
          "__rl": true,
          "value": "faVsWy9VTSNVIhWpR",
          "mode": "list",
          "cachedResultName": "Youtube Transcript Scraper (pintostudio/youtube-transcript-scraper)",
          "cachedResultUrl": "https://console.apify.com/actors/faVsWy9VTSNVIhWpR/input"
        },
        "customBody": "={\n  \"videoUrl\": \"{{ $json.video_url }}\",\n  \"language\": \"en\"\n} "
      },
      "type": "@apify/n8n-nodes-apify.apify",
      "typeVersion": 1,
      "position": [
        -7184,
        8208
      ],
      "id": "bf604d18-e0f8-4679-a9fe-2348d0fc31b6",
      "name": "Run an Actor and get dataset",
      "credentials": {
        "apifyApi": {
          "id": "Hv46zjLtIot94K0v",
          "name": "Apify account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Wir nehmen den Input vom Apify Node\nconst item = $json;\n\n// Wir prüfen, ob das Feld \"data\" existiert und eine Liste ist\nif (item.data && Array.isArray(item.data)) {\n  \n  // MAGIE: Wir nehmen nur den \"text\" Teil von jedem Schnipsel \n  // und kleben sie mit einem Leerzeichen zusammen.\n  // .map() holt den Text, .join(\" \") klebt es zusammen.\n  const fullText = item.data.map(snippet => snippet.text).join(\" \");\n  \n  // Wir geben den sauberen Text zurück + die URL, falls wir sie noch brauchen\n  return {\n    json: {\n      full_transcript: fullText,\n      // Falls die URL im Node davor im json war, schleifen wir sie durch:\n      video_url: $(\"Get a playlist item\").first().json.video_url \n      // (Pass den Namen in der Klammer oben an deinen YouTube Node an!)\n    }\n  };\n} else {\n  return {\n    json: {\n      error: \"Keine Daten im 'data' Feld gefunden.\"\n    }\n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6976,
        8208
      ],
      "id": "38fc77d8-ebe9-4f0a-beb6-1f9af104b9fa",
      "name": "Code in JavaScript33"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "role": "system",
              "content": "=You are an expert Tech Strategy Analyst.\nYour task is to analyze a video transcript and create a concise summary.\n\nOUTPUT RULES:\n1. Respond with a valid JSON object containing exactly one field: \"summary\".\n2. The content of \"summary\" must be PURE PLAIN TEXT.\n3. Do NOT use HTML tags, Markdown formatting, bolding, or bullet points (use dashes \"-\" for lists if necessary).\n4. Keep it objective and strategic.\n\nExample output:\n{\n  \"summary\": \"The CEO announced three new features regarding AI automation. The strategy focuses on enterprise clients...\"\n}"
            },
            {
              "content": "=Analyze this video:\n\nCONTEXT:\nCompany: {{ $('Code in JavaScript32').item.json.company }}\nTitle: {{ $('Code in JavaScript32').item.json.title }}\n\nTRANSCRIPT:\n{{ $json.full_transcript }}\n\nCreate the strategic summary."
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -6768,
        8208
      ],
      "id": "57ea0db1-d9a2-448c-9aba-8de74f863d0a",
      "name": "Message a model3",
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "create",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "6958f7ad002ef62cdcc849b4",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "summary",
              "fieldValue": "={{ $json.summary }}"
            },
            {
              "fieldId": "heading",
              "fieldValue": "={{ $json.title }}"
            },
            {
              "fieldId": "date",
              "fieldValue": "={{ $json.published_at }}"
            },
            {
              "fieldId": "trend",
              "fieldValue": "={{ $json.is_trend }}"
            },
            {
              "fieldId": "link",
              "fieldValue": "={{ $json.video_url }}"
            },
            {
              "fieldId": "name",
              "fieldValue": "={{ $json.title }}"
            },
            {
              "fieldId": "slug",
              "fieldValue": "={{ $json.title.toString().toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -6208,
        8208
      ],
      "id": "be1fea0c-a617-4f3f-a89f-f2532d741ff4",
      "name": "Create an item3",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ==========================================\n// TEIL 1: SUMMARY PARSEN (Dein Code)\n// ==========================================\nlet summaryText = \"\";\n\ntry {\n  // Wir holen den Text aus der tiefen Verschachtelung (AI Output)\n  // Das ist exakt die Logik, die du mir gegeben hast:\n  const rawContent = $json.output[0].content[0].text;\n  \n  // Wir versuchen, das JSON zu parsen\n  const parsed = JSON.parse(rawContent);\n  summaryText = parsed.summary;\n\n} catch (e) {\n  // FALLBACK: Falls der Node davor doch schon geparst hat oder Fehler auftreten\n  // Prüfen, ob \"summary\" vielleicht schon direkt da ist\n  if ($json.summary) {\n    summaryText = $json.summary;\n  } else {\n    // Wenn alles schiefgeht, nehmen wir den rohen Text oder eine Fehlermeldung\n    summaryText = \"Fehler beim Laden der Summary\";\n  }\n}\n\n// ==========================================\n// TEIL 2: DATEN ZUSAMMENTRAGEN\n// ==========================================\n\n// A) Die Stats vom \"Get a video\" Node holen\n// Wir nutzen .first(), da im Loop immer nur 1 Item liegt.\nconst videoNode = $(\"Get a video\").first(); \nconst stats = videoNode.json.statistics || {};\nconst videoId = videoNode.json.id;\n\n// B) Die Metadaten vom Loop holen (\"Loop Over Items3\")\nconst loopItem = $(\"Loop Over Items3\").item.json; \n\n\n// ==========================================\n// TEIL 3: TREND BERECHNUNG\n// ==========================================\n\nconst viewCount = parseInt(stats.viewCount || 0);\nconst likeCount = parseInt(stats.likeCount || 0);\nconst threshold = loopItem.threshold_vph || 100;\n\n// Alter berechnen\nconst now = new Date();\nconst publishedAt = new Date(loopItem.published_at);\nconst diffMs = now - publishedAt;\nconst hoursOld = Math.max(diffMs / (1000 * 60 * 60), 0.1); \n\n// Metriken\nconst viewsPerHour = viewCount / hoursOld;\nlet engagementRate = 0;\nif (viewCount > 50) {\n  engagementRate = (likeCount / viewCount) * 100;\n}\n\n// Entscheidung\nconst isViral = viewsPerHour > threshold;\nconst isQualityHit = (viewsPerHour > (threshold / 2)) && (engagementRate > 3.0);\nconst isTrend = isViral || isQualityHit;\n\n\n// ==========================================\n// TEIL 4: FINALER OUTPUT FÜR WEBFLOW\n// ==========================================\nreturn {\n  json: {\n    // 1. Summary (frisch geparst)\n    summary: summaryText,\n    \n    // 2. Metadaten (aus dem Loop)\n    title: loopItem.title,\n    company: loopItem.company,\n    video_url: loopItem.video_url,\n    published_at: loopItem.published_at,\n    thumbnail: loopItem.thumbnail,\n    \n    // 3. Stats & Trend (gerade berechnet)\n    views: viewCount,\n    likes: likeCount,\n    is_trend: isTrend,\n    views_per_hour: Math.round(viewsPerHour),\n    engagement_rate: parseFloat(engagementRate.toFixed(2))\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6416,
        8208
      ],
      "id": "bfa9568d-2656-4995-b18c-e47ba7b61f27",
      "name": "Code in JavaScript34"
    },
    {
      "parameters": {
        "jsCode": "// 1. Wir holen uns die EINE Firma, die gerade im äußeren Loop dran ist\n// WICHTIG: Ersetze 'SplitInBatches Channels' mit dem exakten Namen deines Firmen-Loops!\nconst companyData = $(\"Loop Over Items2\").first().json;\n\n// 2. Wir holen uns ALLE Videos, die der YouTube Node gerade gefunden hat\nconst videos = $input.all();\n\n// 3. Wir \"mappen\" (verschmelzen) die Daten\nreturn videos.map(item => {\n  const video = item.json; // Das rohe YouTube JSON\n  \n  // Hier bauen wir das saubere, flache Objekt für den weiteren Verlauf\n  return {\n    json: {\n      // --- DATEN VOM VIDEO ---\n      video_id: video.contentDetails?.videoId || video.resourceId?.videoId,\n      title: video.snippet.title,\n      published_at: video.snippet.publishedAt,\n      description: video.snippet.description,\n      thumbnail: video.snippet.thumbnails?.high?.url || video.snippet.thumbnails?.default?.url,\n      \n      // --- DATEN VON DER FIRMA (Dran geklebt!) ---\n      company: companyData.company, // z.B. \"Celonis\" oder \"SAP\"\n      threshold_vph: companyData.threshold_vph || 100, // Fallback falls leer\n      \n      // --- NÜTZLICHE EXTRAS ---\n      video_url: `https://www.youtube.com/watch?v=${video.contentDetails?.videoId || video.resourceId?.videoId}`,\n      is_processed: false // Nur als Platzhalter\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8080,
        8192
      ],
      "id": "83210e62-d761-488d-959c-a7da0a19c847",
      "name": "Code in JavaScript35"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -7840,
        8192
      ],
      "id": "9f5ddf09-757b-4638-96d2-d05235683856",
      "name": "Loop Over Items3"
    },
    {
      "parameters": {
        "content": "Youtube Workflow",
        "height": 1507,
        "width": 3345,
        "color": 5
      },
      "id": "466cb2f8-8a3f-49a8-a9da-87aec35eae7b",
      "name": "Sticky Note25",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -8992,
        9904
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -8912,
        10048
      ],
      "id": "8763673f-d70e-4c53-ad51-89c7d200cdae",
      "name": "Schedule Trigger3"
    },
    {
      "parameters": {
        "jsCode": "return [\n  // 1. CELONIS (Basis-Kanal)\n  // Größe: ~10k Subs. Trend-Alarm ab: 30 Views/Stunde.\n  {\n    json: {\n      company: \"Celonis\",\n      channel_id: \"UC5m7KqSu6qcalyQeDJ57q7A\",\n      uploads_playlist_id: \"UU5m7KqSu6qcalyQeDJ57q7A\", \n      threshold_vph: 30 \n    }\n  },\n\n  // 2. PALANTIR (Sehr aktiv, hohe \"Fan\"-Basis)\n  // Größe: ~140k Subs. Trend-Alarm ab: 150 Views/Stunde.\n  {\n    json: {\n      company: \"Palantir\",\n      channel_id: \"UCwed6_f0WcDIioXvMQfcP2Q\", \n      uploads_playlist_id: \"UUwed6_f0WcDIioXvMQfcP2Q\",\n      threshold_vph: 150\n    }\n  },\n\n  // 3. UIPATH (Marktführer RPA)\n  // Größe: ~70k Subs. Trend-Alarm ab: 80 Views/Stunde.\n  {\n    json: {\n      company: \"UiPath\",\n      channel_id: \"UCaCVGueKcvxnMjV1waiu5cA\",\n      uploads_playlist_id: \"UUaCVGueKcvxnMjV1waiu5cA\",\n      threshold_vph: 80\n    }\n  },\n\n  // 4. IBM (Main Brand Channel)\n  // Größe: ~115k Subs. Trend-Alarm ab: 100 Views/Stunde.\n  {\n    json: {\n      company: \"IBM\",\n      channel_id: \"UC8cc4pVKVHG7A9fbNsRNrLQ\",\n      uploads_playlist_id: \"UU8cc4pVKVHG7A9fbNsRNrLQ\",\n      threshold_vph: 100\n    }\n  },\n  \n   // 5. SAP TECHNOLOGY (Fokus auf Tech/Innovation)\n  // Größe: ~80k Subs. Trend-Alarm ab: 90 Views/Stunde.\n  {\n    json: {\n      company: \"SAP Technology\",\n      channel_id: \"UCVnIv2xF2wyMMCSKv1qF3pA\",\n      uploads_playlist_id: \"UUVnIv2xF2wyMMCSKv1qF3pA\",\n      threshold_vph: 90\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8704,
        10048
      ],
      "id": "d4325204-c66b-4b3c-84ad-a77d8807b8f5",
      "name": "Code in JavaScript36"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -8496,
        10048
      ],
      "id": "656c4602-da48-4d2b-a986-6991843581f0",
      "name": "Loop Over Items4"
    },
    {
      "parameters": {
        "resource": "playlistItem",
        "operation": "getAll",
        "playlistId": "={{ $json.uploads_playlist_id }}",
        "limit": 2,
        "options": {}
      },
      "type": "n8n-nodes-base.youTube",
      "typeVersion": 1,
      "position": [
        -8256,
        10080
      ],
      "id": "27a0560c-55e9-4a6c-82dd-7d370f546196",
      "name": "Get a playlist item2",
      "credentials": {
        "youTubeOAuth2Api": {
          "id": "jDrRDAzck1rSBEyq",
          "name": "YouTube account"
        }
      }
    },
    {
      "parameters": {
        "resource": "video",
        "operation": "get",
        "videoId": "={{ $('Code in JavaScript66').item.json.video_id }}",
        "part": [
          "statistics"
        ],
        "options": {}
      },
      "type": "n8n-nodes-base.youTube",
      "typeVersion": 1,
      "position": [
        -7280,
        10096
      ],
      "id": "7e84a767-0ba2-4cdf-ad98-227cb8da320f",
      "name": "Get a video1",
      "credentials": {
        "youTubeOAuth2Api": {
          "id": "jDrRDAzck1rSBEyq",
          "name": "YouTube account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. DATEN SAMMELN\n// Wir holen die Stats vom aktuellen Input (YouTube Stats Node)\nconst stats = $json.statistics;\nconst videoId = $json.id;\n\n// Wir holen die Metadaten (Titel, Datum) vom Node DAVOR (PlaylistItems)\n// WICHTIG: Ersetze \"YouTube PlaylistItems\" mit dem exakten Namen deines Nodes!\nconst metaNode = $(\"Get a playlist item2\").first(); \nconst meta = metaNode.json.snippet;\nconst config = $(\"Loop Over Items4\").first().json; // Deine Config (Thresholds)\n\n// 2. ZAHLEN AUFBEREITEN\nconst viewCount = parseInt(stats.viewCount || 0);\nconst likeCount = parseInt(stats.likeCount || 0);\nconst commentCount = parseInt(stats.commentCount || 0);\n\n// 3. ALTER BERECHNEN (in Stunden)\nconst now = new Date();\nconst publishedAt = new Date(meta.publishedAt);\nconst diffMs = now - publishedAt;\n// Mindestens 0.1 Stunden, um Division durch Null zu verhindern\nconst hoursOld = Math.max(diffMs / (1000 * 60 * 60), 0.1); \n\n// 4. TREND LOGIK (Die \"Intelligence\")\n// Metric A: Velocity (Views pro Stunde)\nconst viewsPerHour = viewCount / hoursOld;\n\n// Metric B: Engagement Rate (Likes im Verhältnis zu Views in %)\n// (Nur relevant, wenn es mehr als 50 Views gibt, sonst verfälscht ein Like alles)\nlet engagementRate = 0;\nif (viewCount > 50) {\n  engagementRate = (likeCount / viewCount) * 100;\n}\n\n// 5. ENTSCHEIDUNG: IST ES EIN TREND?\n// Szenario 1: Das Video geht viral (Hohe Views/Stunde)\nconst isViral = viewsPerHour > config.threshold_vph;\n\n// Szenario 2: Hohe Qualität (Moderater Speed, aber viele Likes)\n// Wenn es halb so schnell wächst wie nötig, aber 4% der Leute liken (sehr hoch für B2B), dann auch Trend.\nconst isQualityHit = (viewsPerHour > (config.threshold_vph / 2)) && (engagementRate > 3.0);\n\nconst isTrend = isViral || isQualityHit;\n\n// 6. FINALER OUTPUT FÜR WEBFLOW / AI\nreturn {\n  json: {\n    // Info für Webflow\n    title: meta.title,\n    video_id: videoId,\n    video_url: `https://www.youtube.com/watch?v=${videoId}`,\n    published_at: meta.publishedAt,\n    thumbnail: meta.thumbnails?.high?.url || meta.thumbnails?.default?.url,\n    \n    // Stats für Anzeige\n    views: viewCount,\n    likes: likeCount,\n    \n    // Intelligence für Logik\n    views_per_hour: Math.round(viewsPerHour),\n    engagement_rate_percent: parseFloat(engagementRate.toFixed(2)),\n    is_trend: isTrend, // <--- Das steuert deinen Webflow Toggle!\n    trend_reason: isViral ? \"High Velocity\" : (isQualityHit ? \"High Engagement\" : \"Normal\"),\n    \n    // Kontext für AI Summary\n    company: config.company\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7072,
        10096
      ],
      "id": "20d1840d-fa07-4834-8bd6-6573c348d845",
      "name": "Code in JavaScript37"
    },
    {
      "parameters": {
        "operation": "Run actor and get dataset",
        "actorId": {
          "__rl": true,
          "value": "faVsWy9VTSNVIhWpR",
          "mode": "list",
          "cachedResultName": "Youtube Transcript Scraper (pintostudio/youtube-transcript-scraper)",
          "cachedResultUrl": "https://console.apify.com/actors/faVsWy9VTSNVIhWpR/input"
        },
        "customBody": "={\n  \"videoUrl\": \"{{ $json.video_url }}\",\n  \"language\": \"en\"\n}"
      },
      "type": "@apify/n8n-nodes-apify.apify",
      "typeVersion": 1,
      "position": [
        -6832,
        10080
      ],
      "id": "ad4c372c-9b75-4db8-91d5-d350e7579179",
      "name": "Run an Actor and get dataset1",
      "alwaysOutputData": false,
      "credentials": {
        "apifyApi": {
          "id": "Hv46zjLtIot94K0v",
          "name": "Apify account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Wir nehmen den Input vom Apify Node\nconst item = $json;\n\n// Wir prüfen, ob das Feld \"data\" existiert und eine Liste ist\nif (item.data && Array.isArray(item.data)) {\n  \n  // MAGIE: Wir nehmen nur den \"text\" Teil von jedem Schnipsel \n  // und kleben sie mit einem Leerzeichen zusammen.\n  // .map() holt den Text, .join(\" \") klebt es zusammen.\n  const fullText = item.data.map(snippet => snippet.text).join(\" \");\n  \n  // Wir geben den sauberen Text zurück + die URL, falls wir sie noch brauchen\n  return {\n    json: {\n      full_transcript: fullText,\n      // Falls die URL im Node davor im json war, schleifen wir sie durch:\n      video_url: $(\"Get a playlist item2\").first().json.video_url \n      // (Pass den Namen in der Klammer oben an deinen YouTube Node an!)\n    }\n  };\n} else {\n  return {\n    json: {\n      error: \"Keine Daten im 'data' Feld gefunden.\"\n    }\n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6480,
        10096
      ],
      "id": "c520fd33-5c51-43cf-915f-b4336f6e9154",
      "name": "Code in JavaScript38"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "role": "system",
              "content": "=You are an expert Tech Strategy Analyst.\nYour task is to analyze a video transcript and create a concise summary.\n\nOUTPUT RULES:\n1. Respond with a valid JSON object containing exactly one field: \"summary\".\n2. The content of \"summary\" must be PURE PLAIN TEXT.\n3. Do NOT use HTML tags, Markdown formatting, bolding, or bullet points.\n4. Keep it objective and strategic.\n5. STRICT LENGTH LIMIT: Maximum 250 characters (including spaces).\n\nExample output:\n{\n  \"summary\": \"UiPath emphasizes strict governance for AI agents to mitigate risks. The strategy involves robust protocols and ethical frameworks to ensure AI aligns with human values.\"\n}"
            },
            {
              "content": "=Analyze this video:\n\nCONTEXT:\nCompany: {{ $('Code in JavaScript37').item.json.company }}\nTitle: {{ $('Code in JavaScript37').item.json.title }}\n\nTRANSCRIPT:\n{{ $json.full_transcript }}\n\nCreate the strategic summary."
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -6320,
        10096
      ],
      "id": "a2703092-bfbd-4260-8301-b25614f5b3c2",
      "name": "Message a model4",
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "create",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "6958f7ad002ef62cdcc849b4",
        "live": true,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "summary",
              "fieldValue": "={{ $json.summary }}"
            },
            {
              "fieldId": "heading",
              "fieldValue": "={{ $json.title }}"
            },
            {
              "fieldId": "date",
              "fieldValue": "={{ $json.published_at }}"
            },
            {
              "fieldId": "trend",
              "fieldValue": "={{ $json.is_trend }}"
            },
            {
              "fieldId": "link",
              "fieldValue": "={{ $json.video_url }}"
            },
            {
              "fieldId": "name",
              "fieldValue": "={{ $json.title }}"
            },
            {
              "fieldId": "slug",
              "fieldValue": "={{ $json.title.toString().toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '') }}"
            },
            {
              "fieldId": "company",
              "fieldValue": "={{ $json.company }}"
            },
            {
              "fieldId": "views-3",
              "fieldValue": "={{ $json.views }}"
            },
            {
              "fieldId": "likes-3",
              "fieldValue": "={{ $json.likes }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -5632,
        10112
      ],
      "id": "2cbd2eea-081e-4606-803d-a23442f7161c",
      "name": "Create an item4",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ==========================================\n// TEIL 1: SUMMARY PARSEN (Dein Code)\n// ==========================================\nlet summaryText = \"\";\n\ntry {\n  // Wir holen den Text aus der tiefen Verschachtelung (AI Output)\n  // Das ist exakt die Logik, die du mir gegeben hast:\n  const rawContent = $json.output[0].content[0].text;\n  \n  // Wir versuchen, das JSON zu parsen\n  const parsed = JSON.parse(rawContent);\n  summaryText = parsed.summary;\n\n} catch (e) {\n  // FALLBACK: Falls der Node davor doch schon geparst hat oder Fehler auftreten\n  // Prüfen, ob \"summary\" vielleicht schon direkt da ist\n  if ($json.summary) {\n    summaryText = $json.summary;\n  } else {\n    // Wenn alles schiefgeht, nehmen wir den rohen Text oder eine Fehlermeldung\n    summaryText = \"Fehler beim Laden der Summary\";\n  }\n}\n\n// ==========================================\n// TEIL 2: DATEN ZUSAMMENTRAGEN\n// ==========================================\n\n// A) Die Stats vom \"Get a video\" Node holen\n// Wir nutzen .first(), da im Loop immer nur 1 Item liegt.\nconst videoNode = $(\"Get a video1\").first(); \nconst stats = videoNode.json.statistics || {};\nconst videoId = videoNode.json.id;\n\n// B) Die Metadaten vom Loop holen (\"Loop Over Items3\")\nconst loopItem = $(\"Loop Over Items5\").item.json; \n\n\n// ==========================================\n// TEIL 3: TREND BERECHNUNG\n// ==========================================\n\nconst viewCount = parseInt(stats.viewCount || 0);\nconst likeCount = parseInt(stats.likeCount || 0);\nconst threshold = loopItem.threshold_vph || 100;\n\n// Alter berechnen\nconst now = new Date();\nconst publishedAt = new Date(loopItem.published_at);\nconst diffMs = now - publishedAt;\nconst hoursOld = Math.max(diffMs / (1000 * 60 * 60), 0.1); \n\n// Metriken\nconst viewsPerHour = viewCount / hoursOld;\nlet engagementRate = 0;\nif (viewCount > 50) {\n  engagementRate = (likeCount / viewCount) * 100;\n}\n\n// Entscheidung\nconst isViral = viewsPerHour > threshold;\nconst isQualityHit = (viewsPerHour > (threshold / 2)) && (engagementRate > 3.0);\nconst isTrend = isViral || isQualityHit;\n\n\n// ==========================================\n// TEIL 4: FINALER OUTPUT FÜR WEBFLOW\n// ==========================================\nreturn {\n  json: {\n    // 1. Summary (frisch geparst)\n    summary: summaryText,\n    \n    // 2. Metadaten (aus dem Loop)\n    title: loopItem.title,\n    company: loopItem.company,\n    video_url: loopItem.video_url,\n    published_at: loopItem.published_at,\n    thumbnail: loopItem.thumbnail,\n    \n    // 3. Stats & Trend (gerade berechnet)\n    views: viewCount,\n    likes: likeCount,\n    is_trend: isTrend,\n    views_per_hour: Math.round(viewsPerHour),\n    engagement_rate: parseFloat(engagementRate.toFixed(2))\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5968,
        10096
      ],
      "id": "57969205-2569-4041-a021-95f0e66128d4",
      "name": "Code in JavaScript39"
    },
    {
      "parameters": {
        "jsCode": "// 1. Wir holen uns die EINE Firma, die gerade im äußeren Loop dran ist\n// WICHTIG: Ersetze 'SplitInBatches Channels' mit dem exakten Namen deines Firmen-Loops!\nconst companyData = $(\"Loop Over Items4\").first().json;\n\n// 2. Wir holen uns ALLE Videos, die der YouTube Node gerade gefunden hat\nconst videos = $input.all();\n\n// 3. Wir \"mappen\" (verschmelzen) die Daten\nreturn videos.map(item => {\n  const video = item.json; // Das rohe YouTube JSON\n  \n  // Hier bauen wir das saubere, flache Objekt für den weiteren Verlauf\n  return {\n    json: {\n      // --- DATEN VOM VIDEO ---\n      video_id: video.contentDetails?.videoId || video.resourceId?.videoId,\n      title: video.snippet.title,\n      published_at: video.snippet.publishedAt,\n      description: video.snippet.description,\n      thumbnail: video.snippet.thumbnails?.high?.url || video.snippet.thumbnails?.default?.url,\n      \n      // --- DATEN VON DER FIRMA (Dran geklebt!) ---\n      company: companyData.company, // z.B. \"Celonis\" oder \"SAP\"\n      threshold_vph: companyData.threshold_vph || 100, // Fallback falls leer\n      \n      // --- NÜTZLICHE EXTRAS ---\n      video_url: `https://www.youtube.com/watch?v=${video.contentDetails?.videoId || video.resourceId?.videoId}`,\n      is_processed: false // Nur als Platzhalter\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8064,
        10080
      ],
      "id": "84b264c1-d143-4442-918b-be0fc6310a27",
      "name": "Code in JavaScript40"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -7440,
        10080
      ],
      "id": "2acddf60-9447-48e9-bba4-544a8999b803",
      "name": "Loop Over Items5"
    },
    {
      "parameters": {
        "content": "GEO VS SEO  QUADRANT\n",
        "height": 1507,
        "width": 3345,
        "color": 5
      },
      "id": "c5f88393-260e-4e20-9844-975c156bb0dc",
      "name": "Sticky Note28",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -8992,
        11808
      ]
    },
    {
      "parameters": {
        "jsCode": "// 1. Deine Liste der Punkte im CMS (Hardcoded IDs)\n// Annahme: Diese IDs sind die Items in deiner \"Matrix\" Collection, die wir updaten wollen.\nconst companies = [\n  { company: \"Celonis\", domain: \"celonis.com\", id: \"693c600af42b3b79a1581896\" },\n  { company: \"ServiceNow\", domain: \"servicenow.com\", id: \"693c0c224145ffa273ea5559\" },\n  { company: \"Appian\", domain: \"appian.com\", id: \"693c0c06c667a1a8cbd8d424\" },\n  { company: \"Pega Systems\", domain: \"pega.com\", id: \"693c0ba9a31b3711de08673e\" },\n  { company: \"Microsoft\", domain: \"microsoft.com\", id: \"693c0b8649d1c552e280730d\" },\n  { company: \"UiPath\", domain: \"uipath.com\", id: \"693c0b1d27b0da9ed40e6349\" },\n  { company: \"Palantir\", domain: \"palantir.com\", id: \"692ca0e3867eb3e81c91461c\" },\n  { company: \"IBM\", domain: \"ibm.com\", id: \"692ca0e4056c5f1564819dfb\" },\n  { company: \"SAP\", domain: \"sap.com\", id: \"692ca0e20ac6251eea542a27\" }\n];\n\n// 2. DAS EINE KEYWORD (Der Fokus)\nconst targetKeyword = \"Process Mining\";\n\n// 3. TASK LISTE ERSTELLEN\n// Wir erstellen exakt 9 Aufgaben. Keine Cross-Joins, kein Chaos.\nreturn companies.map(comp => ({\n  json: {\n    // Die ID zum Updaten (Direct Target)\n    target_item_id: comp.id, \n    \n    // Daten für die Analyse\n    company: comp.company,\n    domain: comp.domain,\n    keyword: targetKeyword,\n    \n    // Queries\n    z_query: `\"${comp.company}\" \"${targetKeyword}\"`, // Bubble Size Query\n    seo_query: targetKeyword // Ranking Query\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8720,
        11904
      ],
      "id": "bd329cc3-68f0-4b58-914e-065df31561fa",
      "name": "Code in JavaScript41"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://google.serper.dev/search",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "Placeholder"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"q\": \"{{ $json.company }} {{ $json.keyword }}\",\n  \"type\": \"search\",\n  \"engine\": \"google\",\n  \"num\": 1,\n  \"tbs\": \"qdr:y\" \n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -8032,
        12256
      ],
      "id": "bc03ebc4-69ca-4f86-8861-862d12996cff",
      "name": "HTTP Request14"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -8528,
        12112
      ],
      "id": "dc9ea492-e77e-4e51-98c1-aef84f4495c7",
      "name": "Loop Over Items6"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -8288,
        12256
      ],
      "id": "2c8fd663-4fce-4f94-86eb-bc378c62689a",
      "name": "Wait",
      "webhookId": "fc54060f-a57e-44c9-a6d9-c55a590a9098"
    },
    {
      "parameters": {
        "jsCode": "// Wir holen ALLE Suchergebnisse, nicht nur das erste\nconst allItems = $input.all();\n\n// Wir gehen jedes Ergebnis einzeln durch\nreturn allItems.map((item, index) => {\n    const serperData = item.json;\n    \n    // Versuch, die ursprünglichen Daten (Company Name etc.) zu finden.\n    // In n8n v1 sind die oft im \"pairedItem\" oder direkt im json, je nach Node-Einstellung.\n    // Wir nehmen hier an, dass du die Daten aus dem Loop davor brauchst.\n    // ACHTUNG: Das hier ist der Trick, um die Daten sauber zu matchen:\n    // Wir greifen auf das entsprechende Item im Input zu.\n    \n    // Falls deine Serper-Node die alten Daten überschrieben hat, müssen wir tricksen.\n    // Aber meistens behält n8n die Reihenfolge bei.\n    \n    // --- BERECHNUNG START ---\n    \n    let totalResults = 0;\n\n    // 1. SICHERHEITS-CHECK: Hat Google eine Gesamtanzahl geliefert?\n    if (serperData.searchInformation && serperData.searchInformation.totalResults) {\n        // String \"2,500\" -> Zahl 2500\n        totalResults = parseInt(serperData.searchInformation.totalResults.toString().replace(/,/g, ''), 10);\n    } else {\n        // Fallback-Logik\n        if (serperData.organic && serperData.organic.length > 0) {\n            totalResults = 50; \n        } else {\n            totalResults = 0;\n        }\n    }\n\n    // 2. BUBBLE SIZE BERECHNUNG\n    let bubbleSize = 10; // Minimum Startgröße\n\n    if (totalResults > 0) {\n        // Logarithmische Skalierung\n        const logVal = Math.log10(totalResults); \n        // Formel anpassen: Basis 10 + (Log * 10)\n        // Beispiel: 100 Treffer -> Log 2 -> 30px\n        // Beispiel: 1 Mio Treffer -> Log 6 -> 70px\n        bubbleSize = Math.round(10 + (logVal * 10));\n    }\n\n    // Deckeln (Cap) bei 60px, damit der Chart nicht platzt\n    bubbleSize = Math.min(bubbleSize, 60);\n    \n    // --- BERECHNUNG ENDE ---\n\n    // Wir geben das saubere Objekt zurück\n    return {\n        json: {\n            // HIER IST DAS PROBLEM: Woher kommen Name & ID?\n            // Wenn Serper die Daten überschrieben hat, versuchen wir sie aus dem Kontext zu retten.\n            // Option A: Deine Query enthielt den Namen, vielleicht steht er in 'searchParameters.q'?\n            // Option B (Besser): Wir hoffen, dass n8n die Daten gemerged hat oder wir nutzen pairedItem.\n            \n            // Ich nutze hier eine sichere Fallback-Strategie:\n            // Wir nehmen an, dass die \"taskData\" aus deiner Loop-Variable oben nicht funktioniert, \n            // weil die nur EIN Item hat.\n            // Wenn du 'Search' Node auf \"Merge Input\" gestellt hast, sind die Daten hier drin:\n            company: serperData.company || \"Unknown\", \n            keyword: serperData.keyword || \"Process Mining\",\n            \n            // Falls das nicht geht, müssen wir die Query parsen:\n            // Query war: \"Company\" \"Keyword\" -> wir könnten es daraus extrahieren.\n            \n            z_raw: totalResults,\n            z_bubble_size: bubbleSize,\n            \n            // Debugging Info (damit du siehst, ob es geklappt hat)\n            query_used: serperData.searchParameters ? serperData.searchParameters.q : \"n/a\"\n        },\n        // WICHTIG: Damit n8n weiß, welches Item zu wem gehört\n        pairedItem: item.pairedItem\n    };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7808,
        12256
      ],
      "id": "7c699b08-4d24-4079-b4b5-ce0db25625fa",
      "name": "Code in JavaScript42"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -8288,
        11856
      ],
      "id": "8a2c3fd7-ab1e-4115-a701-127d60ae3e13",
      "name": "Wait1",
      "webhookId": "6d1e324f-1666-428a-aea7-b6a689fb624e"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://google.serper.dev/search",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "PLACEHOLDER"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"q\": \"{{ $json.seo_query }}\",\n  \"type\": \"search\",\n  \"engine\": \"google\",\n  \"num\": 20,\n  \"gl\": \"us\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -8048,
        11856
      ],
      "id": "f34c1dcd-6956-4de9-9731-224e0da4252c",
      "name": "HTTP Request15"
    },
    {
      "parameters": {
        "jsCode": "// Input vom Serper Request\nconst serperResults = $input.first().json.organic || [];\n\n// Input vom Loop (Die aktuelle Firma)\n// Wir holen uns das Item sicherheitshalber über den Index, falls verfügbar, \n// oder verlassen uns auf n8n's Paired Item Matching.\n// Fallback: Wir nehmen an, die Domain kommt rein.\nconst taskData = $(\"Loop Over Items6\").item.json; \nconst targetDomain = (taskData.domain || \"\").toLowerCase().trim(); // z.B. \"celonis.com\"\n\n// Falls keine Domain da ist -> 0 Punkte\nif (!targetDomain) {\n  return { json: { x_rank: 101, x_score: 0, debug: \"No Domain\" } };\n}\n\n// Helper: Domain sauber extrahieren (verhindert, dass \"sap-fake.com\" als \"sap.com\" zählt)\nfunction getHostname(urlStr) {\n    try {\n        // Fügt https hinzu falls fehlt, damit URL Parser nicht meckert\n        if (!urlStr.startsWith('http')) urlStr = 'https://' + urlStr;\n        return new URL(urlStr).hostname.replace('www.', '');\n    } catch (e) { return \"\"; }\n}\n\nlet bestRank = 101; // Startwert: Außerhalb Top 100\n\n// Wir loopen durch die Google Ergebnisse\nfor (let i = 0; i < serperResults.length; i++) {\n  const result = serperResults[i];\n  const resultUrl = (result.link || \"\").toLowerCase();\n  const resultHost = getHostname(resultUrl);\n  \n  // CHECK: Ist es wirklich die richtige Domain?\n  // Wir prüfen, ob der Hostname der Domain entspricht oder damit endet\n  // (z.B. \"community.celonis.com\" matches \"celonis.com\")\n  if (resultHost === targetDomain || resultHost.endsWith('.' + targetDomain)) {\n      \n      // Serper gibt manchmal \"position\" zurück, sonst nehmen wir den Loop-Index + 1\n      const currentRank = result.position || (i + 1);\n      \n      if (currentRank < bestRank) {\n          bestRank = currentRank;\n      }\n  }\n}\n\n// SCORE BERECHNUNG (Fairere Kurve)\n// Wir nutzen eine lineare Abnahme, das ist weniger \"stufig\" und fairer.\nlet seoScore = 0;\n\nif (bestRank <= 3) {\n    // Top 3: Absolute Kings (100 - 90 Punkte)\n    seoScore = 100 - ((bestRank - 1) * 5); \n} else if (bestRank <= 10) {\n    // Page 1: Strong (85 - 50 Punkte)\n    // Formel: Start bei 85, minus 5 pro Platz ab Rang 4\n    seoScore = 85 - ((bestRank - 4) * 5);\n} else if (bestRank <= 20) {\n    // Page 2: Visible (45 - 25 Punkte)\n    seoScore = 45 - ((bestRank - 11) * 2);\n} else if (bestRank <= 50) {\n    // Irgendwo ferner liefen (15 Punkte fix)\n    seoScore = 15;\n} else if (bestRank <= 100) {\n    // Zumindest indexiert (5 Punkte)\n    seoScore = 5;\n} else {\n    // Nicht gefunden\n    seoScore = 0;\n}\n\nreturn {\n  json: {\n    x_rank: bestRank === 101 ? \">100\" : bestRank,\n    x_score: Math.round(seoScore),\n    checked_domain: targetDomain\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7840,
        11856
      ],
      "id": "b3dd9e5a-80b0-4d3e-a304-1e28361bf97d",
      "name": "Code in JavaScript43"
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "You are a critical software market analyst.\nYour task is to assign a \"GEO Visibility Score\" (0-100) to a specific company for a specific topic.\n0 = Irrelevant / Unknown to AI.\n100 = The absolute standard answer / Market Leader.\n\nCRITICAL: Return ONLY a raw JSON object. No Markdown.\nSchema: { \"score\": 85, \"reason\": \"Short reason\" }",
              "role": "system"
            },
            {
              "content": "=Topic: \"{{ $json.keyword }}\"\nCompany: \"{{ $json.company }}\"\n\nRate the visibility and recommendation probability of this company for this topic.\nConsider: Is it consistently recommended by LLMs? Is it a niche player or a market leader?\nGive a precise integer score (e.g. 73, not 70)."
            }
          ]
        },
        "simplify": true,
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexity",
      "typeVersion": 1,
      "position": [
        -8016,
        12512
      ],
      "id": "2baab023-023a-48d0-9bb2-6a3d3e3b74be",
      "name": "Message a model5",
      "credentials": {
        "perplexityApi": {
          "id": "QJeUDhO3ml6mBqtk",
          "name": "Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ============================================================\n// Y-ACHSE: AI SCORE PARSER (ORGANISCH)\n// ============================================================\n\n// 1. Input holen\nconst inputJson = $input.first().json;\nconst rawContent = inputJson.message || inputJson.content || \"\";\n\n// Loop Daten retten\nlet taskData = {};\ntry { taskData = $(\"Loop Over Items6\").item.json; } \ncatch(e) { taskData = {}; }\n\n// 2. JSON Extrahieren (Robust)\nlet aiResult = { score: 0, reason: \"Analysis failed\" };\n\ntry {\n  // Sucht nach JSON Pattern {...}\n  const jsonMatch = rawContent.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    aiResult = JSON.parse(jsonMatch[0]);\n  }\n} catch (e) {\n  // Fallback: Wenn AI spinnt, suchen wir nach einer Zahl\n  const numberMatch = rawContent.match(/\\d+/);\n  if (numberMatch) {\n     aiResult.score = parseInt(numberMatch[0]);\n  }\n}\n\n// 3. Plausibilitäts-Check (Damit nichts verrutscht)\nlet finalScore = parseInt(aiResult.score || 0);\nif (finalScore > 100) finalScore = 100;\nif (finalScore < 0) finalScore = 0;\n\nreturn {\n  json: {\n    ...taskData,\n    y_score: finalScore, // Jetzt organisch! (z.B. 43, 87, 12)\n    y_reason: aiResult.reason\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7808,
        12512
      ],
      "id": "c19339cf-d74d-4dcb-850a-b769eec0704c",
      "name": "Code in JavaScript44"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -8272,
        12576
      ],
      "id": "66eed8f4-fed4-4346-ab5d-086882e47551",
      "name": "Wait2",
      "webhookId": "b017a1d2-d535-46b1-b5c6-53563c2b38b6"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -7488,
        12048
      ],
      "id": "23329dd0-2164-4501-9553-adbccec9b7c1",
      "name": "Merge9"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -7296,
        12368
      ],
      "id": "13c0b11b-2e02-4d20-b984-24dddef67c5e",
      "name": "Merge10"
    },
    {
      "parameters": {
        "operation": "update",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "692acff6c13ef94c17f67146",
        "itemId": "={{ $('Code in JavaScript44').item.json.target_item_id }}",
        "live": true,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "x-achse-2",
              "fieldValue": "={{ $json.x_score }}"
            },
            {
              "fieldId": "y-achse-2",
              "fieldValue": "={{ $json.y_score }}"
            },
            {
              "fieldId": "bubble-size-2",
              "fieldValue": "={{ $json.z_bubble_size }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -6960,
        12368
      ],
      "id": "9571a959-31c3-427c-8b04-3b9870a054ea",
      "name": "Update an item6",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -8928,
        12080
      ],
      "id": "0dc1903f-4c8e-4801-be83-eaf5395cdcbe",
      "name": "Schedule Trigger4"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -8800,
        3856
      ],
      "id": "92e4c576-e0b3-4d28-bd67-ad02fb73f0d4",
      "name": "Schedule Trigger5"
    },
    {
      "parameters": {
        "content": "Share of Voice",
        "height": 1491,
        "width": 2945,
        "color": 5
      },
      "id": "1e639418-e9f1-4c12-8ce7-53df13d5d611",
      "name": "Sticky Note31",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -13808,
        3760
      ]
    },
    {
      "parameters": {
        "jsCode": "// ============================================================\n// KONFIGURATION: Name deines Seed-Nodes (Start-Node)\n// ============================================================\nconst seedNodeName = 'Code in JavaScript18'; // <--- PRÜFEN: Heißt der erste Node noch so?\n\n// 1. Inputs holen\nconst serperItems = $input.all(); // Daten von Google Serper\nlet seedItems = [];\n\n// 2. Versuch, die Original-IDs vom Start-Node zu holen\ntry { \n    seedItems = $(seedNodeName).all(); \n} catch (e) {\n    // Falls der Node-Name falsch ist, nicht abstürzen, aber warnen\n    console.log(\"Fehler: Seed Node nicht gefunden!\");\n}\n\n// 3. Mapping: Serper Ergebnisse mit Original-ID verheiraten\nreturn serperItems.map((item, index) => {\n    const json = item.json;\n    const organic = json.organic || [];\n    \n    // Daten Mapping aus Seed-Node (basierend auf Index i)\n    // Wir gehen davon aus, dass Serper die Reihenfolge (0 bis 8) nicht ändert.\n    const seedItem = seedItems[index] ? seedItems[index].json : {};\n    \n    // HIER RETTEN WIR DIE ID UND DEN NAMEN:\n    const id = seedItem.id || \"MISSING_ID\"; \n    const companyName = seedItem.company || \"Unknown\";\n\n    // Nur Titel extrahieren für die AI (Token sparen)\n    const topTitles = organic.slice(0, 10).map(r => r.title).join(\" | \");\n    \n    return {\n        json: {\n            // WICHTIG: Die ID muss hier drin stehen, damit sie durch OpenAI durchgeschleift wird!\n            id: id, \n            company: companyName,\n            \n            // Das Futter für OpenAI\n            titles_for_analysis: topTitles,\n            \n            // Optional: Debugging Info, falls du sehen willst, ob das Mapping klappt\n            debug_match: `${companyName} matched with Index ${index}`\n        }\n    };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8032,
        4000
      ],
      "id": "8ddbde28-8ff6-420d-9e91-8061ffd638db",
      "name": "Code in JavaScript49"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "content": "=Analyze the headlines for the company: \"{{ $json.company }}\"\n\nHeadlines:\n{{ $json.titles_for_analysis }}\n\nYour Tasks:\n1. FILTER: Strictly ignore headlines where \"{{ $json.company }}\" is only a side note or the news is actually about a competitor (e.g., Celonis, SAP, IBM).\n   Example: If the company is \"Microsoft\" but the title says \"Celonis announces new AI...\", this is IRRELEVANT for Microsoft (Sentiment 0.5).\n   \n2. SCORING: Rate the Sentiment Factor (Hype) based ONLY on the company's OWN news:\n   - Own Launch / Major Award / Huge Success = 1.2 to 1.5\n   - Mention in a \"Top 10\" List / General Industry News = 1.0\n   - Negative News / Minor Partner Mention / Irrelevant = 0.5 to 0.8\n\n3. SELECTION: Select the 3 most relevant titles for a summary.\n\nResponse Format (Strict JSON):\n{\n  \"sentiment_factor\": 1.0,\n  \"rag_titles\": \"Title 1 | Title 2 | Title 3\",\n  \"reasoning_short\": \"Explanation in max 5 words\"\n}"
            },
            {
              "role": "system",
              "content": "You are a strict B2B Market Analyst. You analyze news headlines to determine a hype score. Your output must be valid JSON only, without any markdown formatting or explanations."
            }
          ]
        },
        "builtInTools": {},
        "options": {
          "textFormat": {
            "textOptions": {
              "type": "json_schema",
              "schema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"sentiment_factor\": {\n      \"type\": \"number\",\n      \"description\": \"A decimal score between 0.5 and 1.5 indicating the hype level based on own news.\"\n    },\n    \"rag_titles\": {\n      \"type\": \"string\",\n      \"description\": \"The 3 most relevant headlines separated by a pipe symbol (|).\"\n    },\n    \"reasoning_short\": {\n      \"type\": \"string\",\n      \"description\": \"A very short explanation of the score in max 5 words.\"\n    }\n  },\n  \"required\": [\n    \"sentiment_factor\",\n    \"rag_titles\",\n    \"reasoning_short\"\n  ],\n  \"additionalProperties\": false\n}",
              "strict": true
            }
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -7824,
        4000
      ],
      "id": "6989899e-8371-41e6-a77a-f0a43417b5a5",
      "name": "Message a model6",
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -7296,
        3792
      ],
      "id": "8b567b87-dac2-4b22-a39d-3043badaaf57",
      "name": "Merge11"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================\n// FINALER ALGO - NACH CLEANUP\n// ============================================================\n\nconst items = $input.all();\n\nlet totalMarketScore = 0;\nconst analyzedData = [];\n\n// ------------------------------------------------------------\n// HELPER: Aktualitäts-Booster\n// ------------------------------------------------------------\nfunction getFreshnessMultiplier(dateString) {\n  if (!dateString) return 1.0;\n  const s = dateString.toLowerCase();\n  \n  if (s.includes('min') || s.includes('sec')) return 3.0; // Breaking News\n  if (s.includes('hour')) return 2.5; \n  if (s.includes('day')) return 2.0;   \n  if (s.includes('week')) return 1.5;  \n  if (s.includes('month')) return 1.2; \n  return 1.0; \n}\n\n// ------------------------------------------------------------\n// HAUPTSCHLEIFE\n// ------------------------------------------------------------\nfor (let i = 0; i < items.length; i++) {\n  const data = items[i].json;\n\n  // 1. DATEN ABGREIFEN (Jetzt ganz einfach direkt vom Root)\n  const sentiment = data.sentiment_factor || 1.0;\n  const ragReason = data.ai_reason || \"No analysis\";\n  const ragTitles = data.rag_titles || \"\";\n  \n  const companyName = data.company || \"Unknown\";\n  const id = data.id || \"MISSING_ID\";\n  \n  const organicResults = data.organic || [];\n  // Falls searchInformation fehlt (manchmal bei Merge), nutzen wir Fallback\n  const searchStats = data.searchInformation || {}; \n\n  let companyScore = 0;\n\n  // 2. BASIS-SCORE (Ranking der Suchergebnisse)\n  organicResults.forEach((result, index) => {\n     let points = 100 - index; \n     const freshness = getFreshnessMultiplier(result.date);\n     \n     // Kleiner Ego-Check im Code (Titel vs. Snippet)\n     // Auch wenn die AI schon gefiltert hat, hilft das für die Gewichtung der einzelnen Treffer\n     const title = (result.title || \"\").toLowerCase();\n     const cName = companyName.toLowerCase();\n     let relevance = 0.5; // Standard: Nur Snippet-Treffer\n     \n     if (title.includes(cName)) {\n         relevance = 1.0; // Volle Power wenn im Titel\n     }\n     \n     if (points > 0) {\n        companyScore += (points * freshness * relevance);\n     }\n  });\n\n  // 3. VOLUME BONUS (Marktgröße)\n  // Wir versuchen 'totalResults' zu lesen. Wenn es fehlt, nehmen wir die Anzahl der Treffer * 10\n  let resultCount = 0;\n  if (searchStats.totalResults) {\n     resultCount = parseInt(searchStats.totalResults.toString().replace(/[^0-9]/g, ''), 10);\n  }\n  \n  if (resultCount > 0) {\n     // Wurzel-Funktion glättet gigantische Zahlen (damit Microsoft nicht alles erdrückt)\n     companyScore += (Math.sqrt(resultCount) / 2);\n  } else {\n     // Fallback, falls Serper keine totalResults liefert\n     companyScore += (organicResults.length * 5);\n  }\n\n  // 4. DER AI-FAKTOR (Das Herzstück)\n  // Hier wird SAP halbiert (x 0.5) und Celonis gepusht (x 1.2)\n  companyScore = companyScore * sentiment;\n\n  // Aufsummieren für Marktanteil-Berechnung\n  totalMarketScore += companyScore;\n\n  analyzedData.push({\n    id: id,\n    company: companyName,\n    absolute_score: Math.round(companyScore),\n    ai_summary_text: `${ragReason} | Relevant Topics: ${ragTitles}`\n  });\n}\n\n// ------------------------------------------------------------\n// OUTPUT FORMATIEREN (Prozentanteile)\n// ------------------------------------------------------------\nreturn analyzedData.map(entry => {\n  let share = 0;\n  if (totalMarketScore > 0) {\n    // Berechnung des \"Share of Voice\" in Prozent\n    share = Math.round((entry.absolute_score / totalMarketScore) * 100);\n  }\n\n  return {\n    json: {\n      id: entry.id, \n      company: entry.company,\n      hype_index: share,            // Das kommt in die Bubble-Größe / Chart\n      buzz_count: entry.absolute_score, // Das ist der Rohwert (optional)\n      ai_summary: entry.ai_summary_text // Das kommt in dein Textfeld für den Chatbot\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7104,
        3792
      ],
      "id": "bee90175-bae9-4e00-a7e7-08bb5f8631a7",
      "name": "Code in JavaScript50"
    },
    {
      "parameters": {
        "jsCode": "// 1. Input vom OpenAI Node holen\nconst aiItems = $input.all();\n\n// 2. Input vom Node VOR OpenAI holen (um IDs zu retten)\n// !!! ACHTUNG: Hier muss EXAKT der Name deines Nodes vor OpenAI stehen !!!\n// Beispiel: \"Code: Prepare AI\" oder wie auch immer du ihn genannt hast.\nconst originalItems = $(\"Code in JavaScript49\").all(); \n\nreturn aiItems.map((item, index) => {\n  const json = item.json;\n  \n  // --- A: ID & COMPANY RETTEN (Index-Methode) ---\n  // Wir nehmen einfach das Item an der gleichen Position (0 zu 0, 1 zu 1)\n  const originalData = originalItems[index] ? originalItems[index].json : {};\n  const id = originalData.id || \"MISSING_ID_RECOVERED\";\n  const company = originalData.company || \"Unknown Company\";\n\n  // --- B: DATEN AUS DEM KOMPLEXEN OPENAI JSON HOLEN ---\n  // Deine Struktur ist: output[0] -> content[0] -> text -> { sentiment... }\n  let aiData = {};\n\n  try {\n      if (json.output && json.output[0] && \n          json.output[0].content && json.output[0].content[0] && \n          json.output[0].content[0].text) {\n          \n          aiData = json.output[0].content[0].text;\n      } \n      // Fallback, falls n8n die Struktur mal ändert\n      else if (json.output && !Array.isArray(json.output)) {\n          aiData = json.output;\n      }\n  } catch (e) {\n      console.log(\"Fehler beim Parsen von Item \" + index);\n  }\n\n  // --- C: SAUBERES ERGEBNIS ---\n  return {\n    json: {\n      id: id,\n      company: company,\n      sentiment_factor: aiData.sentiment_factor || 1.0,\n      rag_titles: aiData.rag_titles || \"No titles found\",\n      ai_reason: aiData.reasoning_short || \"No reasoning found\"\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7472,
        4000
      ],
      "id": "806547ce-b19a-44ed-b10a-25d47cbfa4af",
      "name": "Code in JavaScript51"
    },
    {
      "parameters": {
        "operation": "update",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "692acff6c13ef94c17f67146",
        "itemId": "={{ $json.id }}",
        "live": true,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "hype-percentage",
              "fieldValue": "={{ $json.hype_index }}"
            },
            {
              "fieldId": "signal-count",
              "fieldValue": "={{ $json.buzz_count }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -6880,
        3680
      ],
      "id": "1e2aab76-dbf4-42c8-b585-afd755f28e2f",
      "name": "Update an item8",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "31784416-e7b6-4d62-a439-1944eb51e15d",
      "name": "Embeddings OpenAI10",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        -6576,
        4080
      ],
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": "content",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        -6512,
        3856
      ],
      "id": "65b7c8f0-7c1f-4bba-a97b-d8903231314b",
      "name": "Postgres PGVector Store10",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.pageContent }}",
        "textSplittingMode": "custom",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "brand",
                "value": "={{ $json.metadata.company }}"
              },
              {
                "name": "category",
                "value": "=Market Signals"
              },
              {
                "name": "url",
                "value": "=linkedin_search_aggregation"
              },
              {
                "name": "title",
                "value": "=Daily Digest {{ $json.metadata.date }}"
              },
              {
                "name": "date",
                "value": "={{ $json.metadata.date }}"
              },
              {
                "name": "type",
                "value": "=news"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        -6448,
        4048
      ],
      "id": "437fd20b-c4d2-4ca8-9187-30ce79971766",
      "name": "Default Data Loader5"
    },
    {
      "parameters": {
        "chunkSize": 20000
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        -6368,
        4224
      ],
      "id": "0d6f2c6b-6a45-4866-91a7-8f8207c3ebd6",
      "name": "Character Text Splitter4"
    },
    {
      "parameters": {
        "jsCode": "// Input: Die fertigen Daten aus \"Final Calculation\"\nconst items = $input.all();\n\n// Datum generieren (YYYY-MM-DD) für Metadaten\nconst today = new Date().toISOString().split('T')[0];\n\nreturn items.map(item => {\n  const data = item.json;\n\n  // 1. Page Content: Das ist das \"Futter\" für den Chatbot.\n  // Wir schreiben hier einen gut lesbaren Text, damit die AI ihn später versteht.\n  const contentText = `\nMarket Analysis for ${data.company} on ${today}:\n- Share of Voice (Hype Index): ${data.hype_index}%\n- Raw Buzz Score: ${data.buzz_count}\n\nAI Analysis & Reasoning:\n${data.ai_summary}\n\nMethodology Note:\nThe Hype Index reflects the company's visibility in organic search and news, weighted by recency and AI-verified relevance.\n  `.trim();\n\n  // 2. Metadata: Für Filterung im RAG (z.B. \"Gib mir nur Infos zu SAP\")\n  return {\n    json: {\n      metadata: {\n        source: \"hype_index_algorithm\", // Damit du weißt, woher die Daten kommen\n        blobType: \"text/plain\",\n        brand: data.company,            // WICHTIG für Filter!\n        category: \"Share of Voice\",\n        url: \"dashboard_hype_index\",    // Optional: Link zum Dashboard\n        title: `Share of Voice Analysis: ${data.company} (${today})`,\n        date: today,\n        type: \"Metric Analysis\"\n      },\n      pageContent: contentText\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6864,
        3872
      ],
      "id": "98e2e6f7-62a3-4ff8-a4e7-b7fb19e65be9",
      "name": "Code in JavaScript52"
    },
    {
      "parameters": {
        "content": "GEO VS SEO  QUADRANT\n",
        "height": 1507,
        "width": 3345,
        "color": 5
      },
      "id": "56743944-8270-4c80-92c1-6f096cda6d0d",
      "name": "Sticky Note32",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -13952,
        11888
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "6958f7ad002ef62cdcc849b4",
        "limit": 10
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -8256,
        9920
      ],
      "id": "00b042ea-e13c-49d8-a40f-659f17d306e9",
      "name": "Get many items4",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. Input holen\nconst items = $input.all();\n\n// 2. Sortieren nach Datum (Neuestes zuerst)\nitems.sort((a, b) => {\n    const dateA = new Date(a.json.fieldData?.date || a.json.createdOn || 0);\n    const dateB = new Date(b.json.fieldData?.date || b.json.createdOn || 0);\n    return dateB - dateA; // Absteigend sortieren\n});\n\n// 3. Updates vorbereiten\nconst updates = [];\n\nitems.forEach((item, index) => {\n    const currentId = item.json.id;\n    let newRank;\n\n    // --- DIE LOGIK (1-6, Rest 0) ---\n    \n    // A) Die ersten 6 (Index 0-5) bekommen IDs 1 bis 6\n    if (index < 6) {\n        newRank = index + 1;\n    } \n    // B) Alle anderen (ab Index 6) bekommen HART die 0\n    else {\n        newRank = 0; \n    }\n\n    // Wir pushen JEDES Item in den Output, egal ob es sich geändert hat oder nicht.\n    // So siehst du die komplette Liste im Output.\n    updates.push({\n        json: {\n            id: currentId,            // ID für Webflow\n            \"id-position-2\": newRank  // 1, 2, 3, 4, 5, 6 oder 0\n        }\n    });\n});\n\nreturn updates;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8048,
        9920
      ],
      "id": "5d46d875-b4fd-4b05-a196-f683e5665cde",
      "name": "Code in JavaScript59"
    },
    {
      "parameters": {
        "operation": "update",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "6958f7ad002ef62cdcc849b4",
        "itemId": "={{ $json.id }}",
        "live": true,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "id-position-2",
              "fieldValue": "={{ $json['id-position-2'] }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -7840,
        9920
      ],
      "id": "de878c44-86da-497c-9521-17cf45af0450",
      "name": "Update an item10",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "6958f7ad002ef62cdcc849b4",
        "returnAll": true
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -7872,
        10080
      ],
      "id": "271219c7-0061-411b-9745-5bbab6c45ea9",
      "name": "Get many items6",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- CONFIG ---\nconst sourceNodeName = 'Code in JavaScript40'; \n\n// 1. INPUTS HOLEN\nlet newVideos = [];\ntry {\n    // Wir holen die Original-Daten (Kandidaten)\n    newVideos = $(sourceNodeName).all().map(item => item.json);\n} catch (error) {\n    // Fallback, falls der Node-Name falsch ist oder leer war\n    newVideos = [];\n}\n\n// Wir holen die Blacklist (Webflow Items)\nconst webflowItems = $input.all().map(item => item.json);\nconst existingLinks = new Set();\n\n// Blacklist füllen\nwebflowItems.forEach(item => {\n    if (item.fieldData && item.fieldData.link) {\n        existingLinks.add(item.fieldData.link.trim());\n    }\n});\n\n// 2. FILTERN\nconst uniqueVideos = newVideos.filter(video => {\n    if (!video.video_url) return false;\n    const urlToCheck = video.video_url.trim();\n    return !existingLinks.has(urlToCheck);\n});\n\n// 3. ENTSCHEIDUNG (Der Trick)\nif (uniqueVideos.length === 0) {\n    // Wenn KEINE neuen Videos da sind, geben wir ein \"Dummy-Item\" zurück.\n    // WICHTIG: video_url ist hier 'null', damit der IF-Node gleich \"False\" sagt.\n    return [\n        {\n            json: {\n                video_url: null, \n                status: \"no_new_videos_found_all_duplicates\"\n            }\n        }\n    ];\n}\n\n// Wenn Videos da sind, geben wir sie ganz normal zurück\nreturn uniqueVideos.map(video => {\n    return {\n        json: video\n    };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7712,
        10080
      ],
      "id": "27dc91bf-4316-40e3-ae1e-be40d13ee493",
      "name": "Code in JavaScript66",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0fafe096-e6d1-4d31-9ef7-491cc5ea3f32",
              "leftValue": "={{ $json.video_url }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -7600,
        9936
      ],
      "id": "107498b8-b8e8-46f1-81af-dafd8c5c8245",
      "name": "If1"
    },
    {
      "parameters": {
        "jsCode": "// CONFIGURATION: 9 Competitors + Strategic News Keywords\n// Clean version without Stock/KPI IDs\n\nconst competitors = [\n  { \n    name: \"SAP\", \n    search_query: 'SAP AND (\"Signavio\" OR \"Process Mining\" OR \"Process Intelligence\" OR \"Joule\" OR \"Supply Chain\" OR \"Transformation\")' \n  },\n  { \n    name: \"Palantir\", \n    search_query: 'Palantir AND (\"AIP\" OR \"Foundry\" OR \"Digital Twin\" OR \"Supply Chain\" OR \"Ontology\")' \n  },\n  { \n    name: \"IBM\", \n    search_query: 'IBM AND (\"Process Mining\" OR \"Process Intelligence\" OR \"watsonx\" OR \"Automation\" OR \"Consulting\")' \n  },\n  { \n    name: \"Microsoft\", \n    search_query: '(\"Microsoft\" OR \"Power Automate\") AND (\"Process Mining\" OR \"Process Intelligence\" OR \"Copilot\" OR \"Digital Twin\")' \n  },\n  { \n    name: \"UiPath\", \n    search_query: 'UiPath AND (\"Agentic\" OR \"Autopilot\" OR \"Process Mining\" OR \"Process Intelligence\" OR \"Continuous Discovery\")' \n  },\n  { \n    name: \"ServiceNow\", \n    search_query: 'ServiceNow AND (\"Process Mining\" OR \"Workflow Intelligence\" OR \"Digital Twin\" OR \"Creator Workflows\")' \n  },\n  { \n    name: \"Appian\", \n    search_query: 'Appian AND (\"Process Mining\" OR \"Process Intelligence\" OR \"Data Fabric\" OR \"AI\")' \n  },\n  { \n    name: \"Pega Systems\", \n    search_query: '(\"Pega Systems\" OR \"Pegasystems\") AND (\"Process Mining\" OR \"Process AI\" OR \"Blueprint\" OR \"GenAI\")' \n  },\n  { \n    name: \"Celonis\", \n    search_query: 'Celonis AND (\"Process Mining\" OR \"OCPM\" OR \"Object-Centric\" OR \"Acquisition\" OR \"Process Intelligence\")' \n  }\n];\n\n// ZEITRAUM STEUERUNG\n// '14d' = Backfill für den Test am Montag (holt letzte 2 Wochen)\n// '3d'  = Live-Modus für nächste Woche\nconst timeWindow = '14d'; \n\nreturn competitors.map(comp => {\n  const encodedQuery = encodeURIComponent(comp.search_query);\n\n  return {\n    json: {\n      company: comp.name,\n      // Die Google News RSS URL\n      rss_url: `https://news.google.com/rss/search?q=${encodedQuery}+when:${timeWindow}&hl=en-US&gl=US&ceid=US:en`\n    }\n  }\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8896,
        6736
      ],
      "id": "9d4d0c40-f28e-4e51-8927-f1ec49c18579",
      "name": "Code in JavaScript70"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -8640,
        6400
      ],
      "id": "44ec1aef-879d-41ae-841d-0cff85376a3b",
      "name": "Loop Over Items12"
    },
    {
      "parameters": {
        "url": "={{ $json.rss_url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1.2,
      "position": [
        -8592,
        6832
      ],
      "id": "bd8f30bc-9b2f-48f7-a625-735ba35aa8ba",
      "name": "RSS Read3"
    },
    {
      "parameters": {
        "jsCode": "// CONFIG\nconst maxItemsToReturn = 3; // Wie viele News pro Firma maximal?\nconst similarityThreshold = 0.3; // 30% Wort-Übereinstimmung reicht für \"Duplikat-Verdacht\"\n\n// 1. Firmennamen und News holen\nconst companyName = $('Loop Over Items12').item.json.company || \"Unknown\";\nconst allNews = $input.all();\n\nconst uniqueNews = [];\n\n// Hilfsfunktion: Text in ein Set von Wörtern verwandeln (bereinigt)\nfunction getWordSet(text) {\n    // Entfernt Sonderzeichen, macht alles klein, splittet an Leerzeichen\n    const words = text.toLowerCase()\n        .replace(/[^a-z0-9 ]/g, \"\") \n        .split(/\\s+/)\n        .filter(w => w.length > 2); // Ignoriert Wörter wie \"in\", \"at\", \"to\"\n    return new Set(words);\n}\n\n// Hilfsfunktion: Jaccard Similarity berechnen (0 = Keine Ähnlichkeit, 1 = Identisch)\nfunction calculateSimilarity(setA, setB) {\n    // Schnittmenge berechnen\n    const intersection = new Set([...setA].filter(x => setB.has(x)));\n    // Vereinigungsmenge berechnen\n    const union = new Set([...setA, ...setB]);\n    \n    return intersection.size / union.size;\n}\n\n// 2. Durch die News iterieren\nfor (const item of allNews) {\n    const currentTitle = item.json.title || \"\";\n    const currentWordSet = getWordSet(currentTitle);\n    \n    let isDuplicate = false;\n\n    // Wir vergleichen den aktuellen Titel mit allen, die wir schon behalten haben\n    for (const keptItem of uniqueNews) {\n        const keptTitle = keptItem.json.title || \"\";\n        const keptWordSet = getWordSet(keptTitle);\n\n        const similarity = calculateSimilarity(currentWordSet, keptWordSet);\n\n        // Wenn die Ähnlichkeit zu hoch ist -> Duplikat!\n        if (similarity > similarityThreshold) {\n            isDuplicate = true;\n            break; \n        }\n    }\n\n    // Wenn es kein Duplikat ist, nehmen wir es auf\n    if (!isDuplicate) {\n        uniqueNews.push({\n            json: {\n                ...item.json,\n                company: companyName\n            }\n        });\n    }\n\n    // Stop, wenn wir genug haben\n    if (uniqueNews.length >= maxItemsToReturn) {\n        break;\n    }\n}\n\nreturn uniqueNews;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7968,
        6816
      ],
      "id": "56c49f60-a253-48b8-af21-e7e2b6d51a29",
      "name": "Code in JavaScript71"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -8976,
        6448
      ],
      "id": "115c9909-4d51-4bdf-8283-cc48f3dcb650",
      "name": "Schedule Trigger9"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -8224,
        6352
      ],
      "id": "9a40e8c9-03ae-41d1-85ac-dc21ac61268b",
      "name": "Loop Over Items13"
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "=You are a Senior Tech Intelligence Researcher.\nYour task is to read the provided news link and extract a detailed, factual \"Deep Dive\" analysis.\n\nGUIDELINES:\n1. **Fact-First:** Focus on specific product names, acquisition costs, dates, and strategic goals.\n2. **Quotes:** Extract 1-2 direct, meaningful quotes from executives if available.\n3. **No Fluff:** Remove marketing buzzwords. We need raw strategic intelligence.\n4. **Context:** Briefly explain WHY this matters for the specific company.",
              "role": "system"
            },
            {
              "content": "=Please research and analyze this event:\n\nCompany: {{ $json.company }}\nHeadline: {{ $json.title }}\nLink: {{ $json.link }}\n\nProvide the detailed analysis, key facts, and quotes."
            }
          ]
        },
        "simplify": true,
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexity",
      "typeVersion": 1,
      "position": [
        -7968,
        6384
      ],
      "id": "7fb110ae-2958-45e4-a0e3-c11f30dbaeb4",
      "name": "Message a model10",
      "credentials": {
        "perplexityApi": {
          "id": "QJeUDhO3ml6mBqtk",
          "name": "Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. Das Ergebnis von Perplexity (Dein Output oben)\n// ACHTUNG: Perplexity Node Output Struktur beachten! \n// In deinem JSON ist der Text unter 'message'. \n// Falls der Node 'message' direkt ausgibt:\nconst perplexityText = $input.item.json.message || $input.item.json.choices[0].message.content;\n\n// 2. Die Original-Daten aus dem Loop davor zurückholen\n// Ersetze 'Loop Over Items 2' mit dem Namen deines zweiten Loops!\nconst originalData = $('Loop Over Items12').item.json;\n\n// 3. Das Paket schnüren\nreturn {\n  json: {\n    // Der wertvolle Text\n    enriched_content: perplexityText,\n    \n    // Die Metadaten für RAG und Webflow retten\n    title: originalData.title,\n    link: originalData.link,\n    date: originalData.isoDate, \n    company: originalData.company,\n    item_id: originalData.item_id // Wichtig für Webflow Update\n  }\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7664,
        6560
      ],
      "id": "ca885339-9352-44e6-a203-29b55a4d6ded",
      "name": "Code in JavaScript72"
    },
    {
      "parameters": {
        "jsCode": "// Input: Die angereicherten Daten (Perplexity + Metadaten)\nconst item = $input.item.json;\n\n// Content: Das Futter für den RAG und den Analysten\n// Wir kombinieren Titel, Fakten und den Deep Dive von Perplexity\nconst contentText = `\nStrategic News Analysis for ${item.company}:\nTitle: ${item.title}\nDate: ${item.date}\n\nDeep Dive & Facts:\n${item.enriched_content}\n\nSource Link: ${item.link}\n`.trim();\n\n// Metadaten: Streng nach deiner Vorgabe, aber für News angepasst\nreturn {\n  json: {\n    // 1. Das Format für die Vektor-Datenbank (Pinecone/Supabase)\n    pageContent: contentText,\n\n    metadata: {\n      source: \"competitor_news_feed\", // Damit du News von Hype-Index unterscheiden kannst\n      blobType: \"text/plain\",\n      \n      brand: item.company,          // WICHTIG für Filter (z.B. \"SAP\")\n      category: \"Strategic News\",   // Kategorie\n      \n      url: item.link,               // Der Link zum Original-Artikel\n      title: item.title,            \n      \n      date: item.date,              // WICHTIG: Das Datum der News (nicht heute!), damit die Historie stimmt\n      \n      type: \"Market Intelligence\",\n      item_id: item.item_id || \"no_id\" // Webflow ID (falls vorhanden)\n    },\n\n    // 2. Wir schleifen die Rohdaten trotzdem weiter mit durch (für den Analysten gleich)\n    raw_data: item\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7376,
        6560
      ],
      "id": "bcfbe6ea-5c66-457a-b769-39c560ca9026",
      "name": "Code in JavaScript73"
    },
    {
      "parameters": {
        "mode": "load",
        "tableName": "content",
        "prompt": "={{ $json.pageContent }}",
        "topK": 3,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        -7120,
        6592
      ],
      "id": "19e0c84d-6964-457b-87b4-64d12efbde8d",
      "name": "Postgres PGVector Store13",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -7040,
        6768
      ],
      "id": "945afc25-e5fa-4b72-ba77-049e91525f81",
      "name": "Embeddings OpenAI13",
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "role": "system",
              "content": "You are a Senior Editor and Deduplication Engine.\nYour job is to compare a NEW incoming news item against EXISTING articles from our database.\n\nDECISION RULES:\n1. DUPLICATE: If the core event (e.g., \"SAP acquires WalkMe\" or \"NRF 2026 Strategy\") is already covered in the existing context, mark it as duplicate.\n2. NEW: If the event is not mentioned in the context, it is NEW.\n3. CONTEXT NOISE: Ignore generic \"Company Information\" or \"About SAP\" texts in the context. Focus only on specific NEWS events.\n\nOUTPUT JSON FORMAT:\n{\n  \"status\": \"new\",      // OR \"duplicate\"\n  \"reason\": \"Short explanation why.\"\n}"
            },
            {
              "content": "={{\n\"NEW NEWS ITEM:\\n\" +\n$json.pageContent +  // Oder wo dein News-Text liegt (z.B. raw_data.enriched_content)\n\"\\n\\n\" +\n\n\"EXISTING CONTEXT FROM DB:\\n\" +\n$json.rag_context +  // Hier nutzen wir das Feld aus dem Merger-Node\n\"\\n\\n\" +\n\n\"TASK: Compare. Is the NEW item already covered in the CONTEXT? Return JSON.\"\n}}"
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -6672,
        6592
      ],
      "id": "889c7b4c-7bfe-48d3-95ff-0e7f7d0c23df",
      "name": "Message a model11",
      "executeOnce": true,
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -6256,
        6400
      ],
      "id": "5a6c917f-4a38-4981-872f-67992b043f7f",
      "name": "Limit"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "83340940-b71f-4c46-8b92-66b78791cdb2",
              "leftValue": "={{ $json.decision.status }}",
              "rightValue": "duplicate",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -6064,
        6560
      ],
      "id": "5945b819-76d9-4603-9d7b-9a1f14ad35cc",
      "name": "If2"
    },
    {
      "parameters": {
        "jsCode": "// Wir greifen uns das Item\nconst item = $input.item.json;\nlet aiText = \"\";\n\n// -----------------------------------------------------------\n// 1. PFAD-SUCHE: Wir suchen den Text da, wo er sein könnte\n// -----------------------------------------------------------\n\n// Option A: Deine aktuelle Struktur (laut Log) -> output[0].content[0].text\nif (item.output && item.output[0] && item.output[0].content && item.output[0].content[0] && item.output[0].content[0].text) {\n   aiText = item.output[0].content[0].text;\n}\n// Option B: Fallback (Manchmal ist es direkt text)\nelse if (item.output && item.output.text) {\n   aiText = item.output.text;\n}\n// Option C: Klassische n8n Struktur (message.content)\nelse if (item.message && item.message.content) {\n   // Manchmal ist content ein String, manchmal ein Array\n   if (typeof item.message.content === 'string') {\n       aiText = item.message.content;\n   } else if (Array.isArray(item.message.content) && item.message.content[0].text) {\n       aiText = item.message.content[0].text;\n   }\n}\n// Option D: Rohe API Struktur (choices[0]...)\nelse if (item.choices && item.choices[0] && item.choices[0].message) {\n   aiText = item.choices[0].message.content;\n}\n\n// Wenn wir immer noch nichts haben, geben wir einen Dummy zurück, damit es nicht crasht\nif (!aiText) {\n    aiText = JSON.stringify({ status: \"error\", reason: \"Could not find text in JSON structure\" });\n}\n\n\n// -----------------------------------------------------------\n// 2. REINIGUNG: Markdown und Müll entfernen\n// -----------------------------------------------------------\n\n// Falls aiText ein Objekt ist (sollte String sein), wandeln wir es um\nif (typeof aiText !== 'string') {\n    aiText = JSON.stringify(aiText);\n}\n\n// Entferne ```json, ``` und Leerzeichen\nconst cleanJsonString = aiText.replace(/```json/g, \"\").replace(/```/g, \"\").trim();\n\n\n// -----------------------------------------------------------\n// 3. PARSING: String zu echtem JSON machen\n// -----------------------------------------------------------\n\nlet parsedDecision;\ntry {\n  parsedDecision = JSON.parse(cleanJsonString);\n} catch (e) {\n  parsedDecision = { status: \"error\", reason: \"Parsing failed: \" + e.message };\n}\n\nreturn {\n  json: {\n    decision: parsedDecision\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6400,
        6560
      ],
      "id": "8fac6cf2-18ea-4074-9490-ddf027adbe1e",
      "name": "Code in JavaScript74"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "content": "={{\n\"Analyze the provided context (News). Select the most significant strategic story for today (\" + $now.toFormat('yyyy-MM-dd') + \").\\n\\n\" +\n\n\"PRIMARY SOURCE (New Input):\\n\" +\n$('Code in JavaScript77').first().json.raw_data.enriched_content +\n\"\\n\\n\" +\n\n\"BACKGROUND CONTEXT (From Database):\\n\" +\n$('Postgres PGVector Store13').all().map(i => i.json.document.pageContent).join('\\n---\\n') +\n\"\\n\\n\" +\n\n\"COMPANY: \" + $('Code in JavaScript77').first().json.raw_data.company +\n\"\\n\\n\" +\n\n\"Output STRICT VALID JSON with the following structure:\\n\" +\n\"{\\n\" +\n\"  \\\"headline\\\": \\\"A catchy, short business headline (max 10 words)\\\",\\n\" +\n\"  \\\"teaser\\\": \\\"A 2-sentence summary for the teaser card\\\",\\n\" +\n\"  \\\"company_name\\\": \\\"The name of the main company mentioned (e.g. SAP or Palantir).\\\",\\n\" +\n\"  \\\"part_1_the_event\\\": \\\"First paragraph: Describe clearly WHAT happened (The core news/fact). No HTML.\\\",\\n\" +\n\"  \\\"part_2_context\\\": \\\"Second paragraph: Explain the CONTEXT. Why is this happening? Compare with competitors.\\\",\\n\" +\n\"  \\\"part_3_implication\\\": \\\"Third paragraph: Strategic IMPLICATION. What does this mean for the market?\\\"\\n\" +\n\"}\"\n}}"
            },
            {
              "role": "system",
              "content": "You are a Senior Competitive Intelligence Analyst for Celonis.\nYour task is to analyze the provided context and extract strategic insights strictly based on facts.\n\nSTRICT ANALYTICAL RULES:\n\n1. **Grounding:** ONLY use facts present in the context. Do not invent news. Do NOT hallucinate implications for Celonis if not supported by the text.\n2. **Relevance:** Focus on Product Launches (AI/Agents), M&A, and Strategic Shifts. Ignore noise.\n3. **Structure:** Output STRICT JSON. Do NOT add markdown formatting (like ```json).\n4. **Style:** Write in a clear, professional analyst tone.\n   - Part 1 (Event): Pure facts. What happened?\n   - Part 2 (Context): Connect the dots. Why now? Compare with competitors if mentioned.\n   - Part 3 (Implication): Forward-looking. What does this mean for the MARKET segment? (Only mention Celonis if explicitly relevant/mentioned).\n\n5. **Date Focus:** Prioritize news for today."
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -5856,
        6464
      ],
      "id": "e1a24288-b184-4de0-88c9-833a9428c999",
      "name": "Message a model12",
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. Zugriff auf den AI-Text (Bleibt gleich, kommt vom direkten Input)\n// Prüf hier kurz, ob input.item noch geht, sonst nimm input.first()\nconst rawText = $input.first().json.output[0].content[0].text; \n\nconst cleanJsonString = rawText.replace(/```json/g, \"\").replace(/```/g, \"\").trim();\n\nlet cmsContent;\ntry {\n  cmsContent = JSON.parse(cleanJsonString);\n} catch (e) {\n  cmsContent = { headline: \"Error parsing\", part_1_the_event: rawText };\n}\n\n// 2. DAS IST DEIN FEHLER-BEREICH:\n// Ändere .item zu .first()\nconst originalData = $('Code in JavaScript77').first().json.raw_data;\n\nreturn {\n  json: {\n    cms_content: cmsContent,\n    meta: {\n        // Hier greifen wir auf die Variable von oben zu\n        date: originalData.date || $now.toFormat('yyyy-MM-dd'), \n        source_url: originalData.link || \"https://celonis.com\", \n        company: originalData.company\n    }\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5328,
        6448
      ],
      "id": "dc21e12c-6524-438a-a19b-c1f5b35504a6",
      "name": "Code in JavaScript75"
    },
    {
      "parameters": {
        "operation": "create",
        "siteId": "690b546a42258c14fbb8ff8a",
        "collectionId": "692d82024a6e442781fcac93",
        "live": true,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "headline",
              "fieldValue": "={{ $json.cms_content.headline }}"
            },
            {
              "fieldId": "short-description",
              "fieldValue": "={{ $json.cms_content.teaser }}"
            },
            {
              "fieldId": "text-2",
              "fieldValue": "={{ $json.cms_content.part_1_the_event }}"
            },
            {
              "fieldId": "paragraph-2",
              "fieldValue": "={{ $json.cms_content.part_2_context }}"
            },
            {
              "fieldId": "paragraph-3",
              "fieldValue": "={{ $json.cms_content.part_3_implication }}"
            },
            {
              "fieldId": "source",
              "fieldValue": "={{ $json.meta.source_url }}"
            },
            {
              "fieldId": "company",
              "fieldValue": "={{ $json.cms_content.company_name }}"
            },
            {
              "fieldId": "name",
              "fieldValue": "={{ $json.cms_content.headline }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.webflow",
      "typeVersion": 2,
      "position": [
        -5024,
        6448
      ],
      "id": "374e6ca0-fd4e-417f-b148-0444721084a8",
      "name": "Create an item7",
      "credentials": {
        "webflowOAuth2Api": {
          "id": "i4sYAVOfrsDUJoNW",
          "name": "Webflow account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "4efad1ad-9faf-4647-aa14-0585495ff6db",
      "name": "Embeddings OpenAI14",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        -5664,
        6912
      ],
      "credentials": {
        "openAiApi": {
          "id": "9GeimxY63nRnmaEK",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": "content",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        -5552,
        6688
      ],
      "id": "d0e25f30-a983-459f-8c88-c7862f7b517c",
      "name": "Postgres PGVector Store14",
      "credentials": {
        "postgres": {
          "id": "ZkwcYz330OalTdyS",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.pageContent }}",
        "textSplittingMode": "custom",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "brand",
                "value": "={{ $json.metadata.company }}"
              },
              {
                "name": "category",
                "value": "=Market Signals"
              },
              {
                "name": "url",
                "value": "=linkedin_search_aggregation"
              },
              {
                "name": "title",
                "value": "=Daily Digest {{ $json.metadata.date }}"
              },
              {
                "name": "date",
                "value": "={{ $json.metadata.date }}"
              },
              {
                "name": "type",
                "value": "=news"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        -5488,
        6880
      ],
      "id": "db0bf962-0958-4a69-a0f7-e455b194e9bc",
      "name": "Default Data Loader7"
    },
    {
      "parameters": {
        "chunkSize": 20000
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        -5456,
        7056
      ],
      "id": "3a5cd2c4-3629-4e15-93c7-4c4a7de58d5e",
      "name": "Character Text Splitter6"
    },
    {
      "parameters": {
        "jsCode": "// Wir nutzen .first(), um die automatische Paarung zu umgehen (Fix für den Error)\n// Das funktioniert sicher, solange du nicht mehrere News gleichzeitig parallel im Loop verarbeitest.\nconst sourceData = $('Code in JavaScript77').first().json.raw_data;\n\n// Der Rest bleibt gleich...\nconst safeDate = sourceData.date || new Date().toISOString().split('T')[0];\nconst safeLink = sourceData.link || \"\";\n\nreturn {\n  json: {\n    pageContent: sourceData.enriched_content, // Der volle Text\n    metadata: {\n      title: sourceData.title,\n      url: safeLink,\n      date: safeDate,\n      company: sourceData.company,\n      type: \"market_intelligence_raw\"\n    }\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5776,
        6704
      ],
      "id": "289fbd57-df02-4dfe-92d5-22739a30be9c",
      "name": "Code in JavaScript76"
    },
    {
      "parameters": {
        "jsCode": "// 1. Wir holen ALLE Suchergebnisse vom Postgres Node auf einmal\nconst searchResults = $input.all();\n\n// 2. Wir kleben die Texte aller gefundenen Dokumente zusammen\nconst combinedContext = searchResults\n  .map(item => item.json.document.pageContent)\n  .join('\\n\\n---\\n\\n');\n\n// 3. Wir holen uns die Original-Daten zurück\n// Da alle 3 Suchergebnisse vom selben Input abstammen, nehmen wir einfach das erste\n// und greifen über die \"Paired Item\" Logik auf den Ursprung zu.\nconst originalInputNode = $('Code in JavaScript73'); // Dein News-Source Node\nconst originalData = originalInputNode.item.json; \n\nreturn {\n  json: {\n    // Wir geben alle Original-Daten weiter (damit der Flow nicht unterbrochen wird)\n    ...originalData,\n    \n    // Das ist das WICHTIGE NEUE Feld für die AI:\n    rag_context: combinedContext\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6832,
        6464
      ],
      "id": "5b9b392e-9f97-4475-9956-355c97b0a3cc",
      "name": "Code in JavaScript77"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -8272,
        6912
      ],
      "id": "3e85bf52-5b0f-4931-af3f-508322318a11",
      "name": "Limit1"
    }
  ],
  "pinData": {
    "Merge1": [
      {
        "json": {
          "company_id": "cmp_sap",
          "company": "SAP",
          "symbol": "SAP",
          "key": "sap",
          "price_last": 241.75,
          "price_prev_close": 240.02,
          "change_abs": 1.73,
          "change_pct": 0.7208,
          "quote_time_unix": 1764363600,
          "quote_time_iso": "2025-11-28T21:00:00.000Z",
          "source_quote": "finnhub:quote",
          "updated_at": "2025-11-30T20:03:40.059Z",
          "market_cap_usd_m": 241593.333618,
          "market_cap_b": 241.59,
          "currency": "EUR",
          "exchange": "XETRA",
          "name_official": "SAP SE",
          "ticker_reported": "SAP.DE",
          "country": "DE",
          "ipo_date": "1988-11-04",
          "industry": "Technology",
          "share_outstanding_m": 1228.5,
          "weburl": "https://www.sap.com/",
          "logo": "https://static2.finnhub.io/file/publicdatany/finnhubimage/stock_logo/SAP.DE.png",
          "source_profile": "finnhub:profile2",
          "rec_period": "2025-11-01",
          "rec_strongBuy": 9,
          "rec_buy": 22,
          "rec_hold": 4,
          "rec_sell": 2,
          "rec_strongSell": 1,
          "rec_total": 38,
          "rec_index": 0.474,
          "rec_label": "Buy",
          "rec_index_mom": 0.001,
          "source_reco": "finnhub:recommendation-trends",
          "reco_updated_at": "2025-11-17T08:17:16.547Z"
        },
        "binary": {}
      },
      {
        "json": {
          "company_id": "cmp_pltr",
          "company": "Palantir",
          "symbol": "PLTR",
          "key": "pltr",
          "price_last": 168.45,
          "price_prev_close": 165.77,
          "change_abs": 2.68,
          "change_pct": 1.6167,
          "quote_time_unix": 1764363600,
          "quote_time_iso": "2025-11-28T21:00:00.000Z",
          "source_quote": "finnhub:quote",
          "updated_at": "2025-11-30T20:03:40.065Z",
          "market_cap_usd_m": 401490.13881575584,
          "market_cap_b": 401.49,
          "currency": "USD",
          "exchange": "NASDAQ NMS - GLOBAL MARKET",
          "name_official": "Palantir Technologies Inc",
          "ticker_reported": "PLTR",
          "country": "US",
          "ipo_date": "2020-09-30",
          "industry": "Technology",
          "share_outstanding_m": 2382.43,
          "weburl": "https://www.palantir.com/",
          "logo": "https://static2.finnhub.io/file/publicdatany/finnhubimage/stock_logo/PLTR.png",
          "source_profile": "finnhub:profile2",
          "rec_period": "2025-11-01",
          "rec_strongBuy": 4,
          "rec_buy": 7,
          "rec_hold": 18,
          "rec_sell": 2,
          "rec_strongSell": 1,
          "rec_total": 32,
          "rec_index": 0.172,
          "rec_label": "Buy",
          "rec_index_mom": 0,
          "source_reco": "finnhub:recommendation-trends",
          "reco_updated_at": "2025-11-17T08:17:16.547Z"
        },
        "binary": {}
      },
      {
        "json": {
          "company_id": "cmp_ibm",
          "company": "IBM",
          "symbol": "IBM",
          "key": "ibm",
          "price_last": 308.58,
          "price_prev_close": 303.21,
          "change_abs": 5.37,
          "change_pct": 1.771,
          "quote_time_unix": 1764363600,
          "quote_time_iso": "2025-11-28T21:00:00.000Z",
          "source_quote": "finnhub:quote",
          "updated_at": "2025-11-30T20:03:40.071Z",
          "market_cap_usd_m": 288440.570154163,
          "market_cap_b": 288.44,
          "currency": "USD",
          "exchange": "NEW YORK STOCK EXCHANGE, INC.",
          "name_official": "International Business Machines Corp",
          "ticker_reported": "IBM",
          "country": "US",
          "ipo_date": "1915-11-11",
          "industry": "Technology",
          "share_outstanding_m": 934.74,
          "weburl": "https://www.ibm.com/",
          "logo": "https://static2.finnhub.io/file/publicdatany/finnhubimage/stock_logo/IBM.png",
          "source_profile": "finnhub:profile2",
          "rec_period": "2025-11-01",
          "rec_strongBuy": 5,
          "rec_buy": 7,
          "rec_hold": 12,
          "rec_sell": 3,
          "rec_strongSell": 0,
          "rec_total": 27,
          "rec_index": 0.259,
          "rec_label": "Buy",
          "rec_index_mom": 0.018,
          "source_reco": "finnhub:recommendation-trends",
          "reco_updated_at": "2025-11-17T08:17:16.547Z"
        },
        "binary": {}
      }
    ],
    "Sort": [
      {
        "json": {
          "id": "692ca0e20ac6251eea542a27",
          "company": "SAP"
        }
      },
      {
        "json": {
          "id": "692ca0e3867eb3e81c91461c",
          "company": "Palantir"
        }
      },
      {
        "json": {
          "id": "692ca0e4056c5f1564819dfb",
          "company": "IBM"
        }
      }
    ],
    "HTTP Request7": [
      {
        "json": {
          "searchParameters": {
            "q": "Celonis (digital banking transformation OR object centric process mining OR ocpm process mining OR process mining OR process mining simulation OR process intelligence platform)",
            "type": "search",
            "num": 100,
            "tbs": "qdr:y",
            "engine": "google"
          },
          "organic": [
            {
              "title": "How process mining drives digital transformation in banking",
              "link": "https://www.celonis.com/blog/process-mining-in-banking",
              "snippet": "Celonis' Process Intelligence Platform layers the data derived from process mining together with a bank's unique business context, wider process knowledge and ...",
              "date": "Sep 18, 2025",
              "position": 1
            },
            {
              "title": "Digital transformation in banking",
              "link": "https://www.celonis.com/insights/topics/digital-transformation-in-banking",
              "snippet": "The Celonis Process Intelligence Platform helps banks with digital transformation by using process data, standardized process knowledge, and AI to create a ...",
              "date": "Sep 18, 2025",
              "position": 2
            },
            {
              "title": "Celonis Unveils Platform Innovations to Power the AI- ...",
              "link": "https://www.celonis.com/news/press/celonis-unveils-platform-innovations-to-power-the-ai-driven-composable-enterprise",
              "snippet": "Celonis, a global leader in Process Intelligence, today at Celosphere 2025 announced major platform innovations that power enterprise AI to reinvent and ...",
              "date": "Nov 4, 2025",
              "position": 3
            },
            {
              "title": "Celonis named a Leader in 2025 Gartner Magic Quadrant ...",
              "link": "https://www.celonis.com/blog/celonis-named-a-leader-in-2025-gartner-magic-quadrant-process-intelligence-platform-fuels-ai-success-and-innovation",
              "snippet": "The Celonis Process Intelligence platform uses process mining and augments it with business context to create a living digital twin of the business ...",
              "date": "Apr 22, 2025",
              "position": 4
            },
            {
              "title": "Celonis announces new platform innovations",
              "link": "https://www.processexcellencenetwork.com/process-mining/news/celonis-announces-new-platform-innovations-to-power-ai-driven-composable-enterprises",
              "snippet": "Process intelligence vendor Celonis has announced new platform innovations to power enterprise artificial intelligence (AI) driven, composable enterprises.",
              "date": "Nov 4, 2025",
              "position": 5
            },
            {
              "title": "What Process Intelligence does that process mining can't",
              "link": "https://www.celonis.com/blog/podcast-trust-the-process-what-process-intelligence-does-that-process-mining-cant",
              "snippet": "In this episode of the 'Trust the Process Podcast', we explore the origins and transformation of process mining through the lens of a grocery store ...",
              "date": "May 22, 2025",
              "position": 6
            },
            {
              "title": "Process Mining",
              "link": "https://www.hiberus.com/en/enterprise-efficiency/process-mining",
              "snippet": "Thanks to Celonis' Process Intelligence Graph technology, we integrate data from multiple systems and processes into a single platform, giving us a unified, ...",
              "date": "Jul 28, 2025",
              "position": 7
            },
            {
              "title": "10 Best Process Mining Solutions to Consider for 2026",
              "link": "https://kyp.ai/process-mining-software-comparison/",
              "snippet": "Core approach: Celonis delivers an extensive process intelligence platform with object-centric process ... object-centric process mining allows analysis of ...",
              "date": "Oct 8, 2025",
              "position": 8
            },
            {
              "title": "Celonis Unveils Platform Innovations to Power the AI ...",
              "link": "https://finance.yahoo.com/news/celonis-unveils-platform-innovations-power-100000964.html",
              "snippet": "The Celonis Process Intelligence Platform extracts raw data from systems, applications and devices within and across enterprises. It enriches this data with ...",
              "date": "Nov 4, 2025",
              "position": 9
            },
            {
              "title": "Celonis Named a Leader in Process Intelligence Software",
              "link": "https://www.celonis.com/news/press/celonis-named-a-leader-in-process-intelligence-software",
              "snippet": "The Celonis Process Intelligence Platform uses industry-leading process mining and AI technology and augments it with business context to give customers a ...",
              "date": "Aug 12, 2025",
              "position": 10
            }
          ],
          "relatedSearches": [
            {
              "query": "Process mining Celonis"
            },
            {
              "query": "Gartner Magic Quadrant process mining"
            },
            {
              "query": "Celonis Databricks"
            },
            {
              "query": "Celonis AI Lab"
            },
            {
              "query": "AI process mining"
            },
            {
              "query": "Celonis asset library"
            },
            {
              "query": "Celonis Automation"
            },
            {
              "query": "Process Intelligence software"
            }
          ],
          "credits": 1
        }
      },
      {
        "json": {
          "searchParameters": {
            "q": "ServiceNow (digital banking transformation OR object centric process mining OR ocpm process mining OR process mining OR process mining simulation OR process intelligence platform)",
            "type": "search",
            "num": 100,
            "tbs": "qdr:y",
            "engine": "google"
          },
          "organic": [
            {
              "title": "Process Mining",
              "link": "https://www.servicenow.com/products/process-mining.html",
              "snippet": "Process Mining improves process workflows. Streamline business process mining, visualize technology, customer service, and HR workflows.",
              "date": "Sep 9, 2025",
              "position": 1
            },
            {
              "title": "2026 process mining trends",
              "link": "https://www.processexcellencenetwork.com/process-mining/articles/6-trends-shaping-process-mining-in-2026",
              "snippet": "Explore the six trends that are transforming process mining into a true business differentiator.",
              "date": "Dec 3, 2025",
              "position": 2
            },
            {
              "title": "Process Mining",
              "link": "https://www.servicenow.com/docs/bundle/zurich-now-intelligence/page/administer/process-mining/concept/process-mining.html",
              "snippet": "Process Mining helps analysts and process owners quickly analyze and optimize their business processes.",
              "date": "Jul 30, 2025",
              "position": 3
            },
            {
              "title": "10 Best Process Mining Solutions to Consider for 2026",
              "link": "https://kyp.ai/process-mining-software-comparison/",
              "snippet": "Core approach: Celonis delivers an extensive process intelligence platform with object-centric process mining (OCPM) and a broad partner ecosystem, offering ...",
              "date": "Oct 8, 2025",
              "position": 4
            },
            {
              "title": "Insights",
              "link": "https://www.celonis.com/insights",
              "snippet": "All the latest insights, research, and ideas about Process Intelligence, process mining, and AI you need to go to the next level.",
              "date": "Nov 6, 2025",
              "position": 5
            },
            {
              "title": "ServiceNow Process Mining Reviews",
              "link": "https://www.gartner.com/reviews/market/process-mining-platforms/vendor/servicenow/product/servicenow-process-mining",
              "snippet": "ServiceNow Process Mining is a software designed to enable organizations to analyze and visualize their business processes using data from their digital ...",
              "date": "Dec 2, 2025",
              "rating": 4.2,
              "ratingCount": 54,
              "position": 6
            },
            {
              "title": "Process Mining release notes",
              "link": "https://www.servicenow.com/docs/bundle/yokohama-release-notes/page/release-notes/now-platform-administration/process-optimization-rn.html",
              "snippet": "The ServiceNow Process Mining application enables analysts and process owners to view their business processes, analyze them, and make decisions that improve ...",
              "date": "Jan 29, 2025",
              "position": 7
            },
            {
              "title": "Real-World Use Cases of Process Mining",
              "link": "https://mindzie.com/process-mining-software/process-mining-use-cases/",
              "snippet": "Process mining is a data-driven technique that analyzes event logs extracted from information systems to visualize and improve business processes.",
              "date": "Jan 23, 2025",
              "position": 8
            },
            {
              "title": "Celonis announces new platform innovations",
              "link": "https://www.processexcellencenetwork.com/process-mining/news/celonis-announces-new-platform-innovations-to-power-ai-driven-composable-enterprises",
              "snippet": "Process intelligence vendor Celonis has announced new platform innovations to power enterprise artificial intelligence (AI) driven, composable enterprises.",
              "date": "Nov 4, 2025",
              "position": 9
            },
            {
              "title": "Using Process Mining",
              "link": "https://www.servicenow.com/docs/bundle/zurich-now-intelligence/page/administer/process-mining/concept/use-process-mining.html",
              "snippet": "Create and mine a project using the Project Builder to analyze and optimize your business processes. Create a template to reuse it when you want to use the same ...",
              "date": "Jul 30, 2025",
              "position": 10
            }
          ],
          "relatedSearches": [
            {
              "query": "ServiceNow Process Mining documentation"
            },
            {
              "query": "ServiceNow Process Mining roles"
            },
            {
              "query": "ServiceNow Process Mining variation analysis"
            },
            {
              "query": "ServiceNow Process Mining demo"
            },
            {
              "query": "ServiceNow process mining improvement opportunities"
            },
            {
              "query": "ServiceNow Process mining process configuration builder"
            },
            {
              "query": "ServiceNow Process Mining Academy"
            },
            {
              "query": "ServiceNow Process Mining Community"
            }
          ],
          "credits": 1
        }
      },
      {
        "json": {
          "searchParameters": {
            "q": "Appian (digital banking transformation OR object centric process mining OR ocpm process mining OR process mining OR process mining simulation OR process intelligence platform)",
            "type": "search",
            "num": 100,
            "tbs": "qdr:y",
            "engine": "google"
          },
          "organic": [
            {
              "title": "Appian Celebrates 2025 Innovation Award Winners",
              "link": "https://appian.com/about/explore/press-releases/2025/appian-celebrates-2025-innovation-award-winners",
              "snippet": "The Innovation Awards celebrate customers for creating transformative applications that drive impact and value on the Appian Platform.",
              "date": "Apr 28, 2025",
              "position": 1
            },
            {
              "title": "Appian Embeds Agentic AI into Business Processes to ...",
              "link": "https://appian.com/about/explore/press-releases/2025/appian-embeds-agentic-ai-into-business-processes-to-deliver-scal",
              "snippet": "Appian (NASDAQ: APPN) today announced agentic AI platform enhancements to help organizations build, deploy, and scale intelligent process applications.",
              "date": "Apr 28, 2025",
              "position": 2
            },
            {
              "title": "Fix Fragmentation with End-to-End Process Orchestration",
              "link": "https://appian.com/blog/acp/process-orchestration/end-to-end-process-orchestration",
              "snippet": "Discover how end-to-end process orchestration unifies systems, people, and AI to become the backbone of enterprise digital transformation.",
              "date": "Sep 15, 2025",
              "position": 3
            },
            {
              "title": "16 process mining vendors",
              "link": "https://www.processexcellencenetwork.com/process-mining/articles/16-process-mining-vendors-gartner-magic-quadrant",
              "snippet": "The 2025 Magic Quadrant for Process Mining Platforms report assesses 16 vendors based on their offerings, strengths and weaknesses.",
              "date": "Apr 24, 2025",
              "position": 4
            },
            {
              "title": "Appian Announces 2025 Partner Award Winners at ...",
              "link": "https://appian.com/about/explore/press-releases/2025/appian-announces-2025-partner-award-winners-at-appian-europe",
              "snippet": "The solution combines AI with Appian's process orchestration and Data Fabric to automate 15 key use cases, with expected outcomes including a 50% reduction in ...",
              "date": "Nov 12, 2025",
              "position": 5
            },
            {
              "title": "25+ Process Intelligence Software and Tools in 2024",
              "link": "https://www.processmaker.com/blog/process-intelligence-software-and-tools/",
              "snippet": "Appian's process mining solution was ... StereoLOGIC offers an integrated process mining and task mining platform focused on digital transformation.",
              "date": "Feb 12, 2025",
              "position": 6
            },
            {
              "title": "Top 9 Celonis Alternatives to Consider in 2026",
              "link": "https://kyp.ai/celonis-alternatives/",
              "snippet": "If you're looking for process intelligence software, chances are you've heard of Celonis. Celonis was one of the original process mining tools and mastered ...",
              "date": "Dec 18, 2025",
              "position": 7
            },
            {
              "title": "From Silos to Synergy: Agentic AI is transforming financial ...",
              "link": "https://www.retailbankerinternational.com/features/from-silos-to-synergy-agentic-ai-is-transforming-financial-services/",
              "snippet": "Appian's agentic AI and process-centric platform are emerging as the key to unlocking maximum value.",
              "date": "May 19, 2025",
              "position": 8
            },
            {
              "title": "Appian CEO: Defining Value From AI In Business Processes",
              "link": "https://www.forbes.com/sites/adrianbridgwater/2025/03/28/appian-ceo-defining-value-from-ai-in-business-processes/",
              "snippet": "Appian CEO Matt Calkins says that if we are going to make AI truly valuable in commercial terms, we need to graft it and inject it into business processes.",
              "date": "Mar 28, 2025",
              "position": 9
            },
            {
              "title": "10 Best Intelligent Automation Platforms You Can Use In ...",
              "link": "https://www.marlabs.com/post/10-best-intelligent-automation-platforms-you-can-use-in-2025",
              "snippet": "With a special focus on low-code design and process automation, Appian is an intelligent automation platform that helps enhance productivity by letting users ...",
              "date": "Jun 9, 2025",
              "position": 10
            }
          ],
          "relatedSearches": [
            {
              "query": "Appian Agent Studio"
            },
            {
              "query": "Appian AI"
            },
            {
              "query": "Appian AI Composer"
            }
          ],
          "credits": 1
        }
      },
      {
        "json": {
          "searchParameters": {
            "q": "Pega Systems (digital banking transformation OR object centric process mining OR ocpm process mining OR process mining OR process mining simulation OR process intelligence platform)",
            "type": "search",
            "num": 100,
            "tbs": "qdr:y",
            "engine": "google"
          },
          "organic": [
            {
              "title": "16 process mining vendors",
              "link": "https://www.processexcellencenetwork.com/process-mining/articles/16-process-mining-vendors-gartner-magic-quadrant",
              "snippet": "Pegasystems is a Leader in this year's Magic Quadrant. Gartner assessed version 24.2, combined with Pega Workforce Intelligence 8.8.4 and Pega Platform 24.2.",
              "date": "Apr 24, 2025",
              "position": 1
            },
            {
              "title": "Pegasystems Investor Presentation Q3 2025",
              "link": "https://www.pega.com/sites/default/files/media/documents/2025-10/102125-q3deck.pdf",
              "snippet": "open, cloud-native platform, with AI embedded everywhere, drives smarter, Process Mining Platforms, Digital Process Automation Software,",
              "date": "Oct 21, 2025",
              "position": 2
            },
            {
              "title": "10 Best Process Mining Solutions to Consider for 2026",
              "link": "https://kyp.ai/process-mining-software-comparison/",
              "snippet": "By combining next-generation process mining features with AI-powered analytics, the platform delivers continuous operational insights and automated process ...",
              "date": "Oct 8, 2025",
              "position": 3
            },
            {
              "title": "25+ Process Intelligence Software and Tools in 2024",
              "link": "https://www.processmaker.com/blog/process-intelligence-software-and-tools/",
              "snippet": "Pegasystems' solutions intelligent automation solutions include a process mining solution developed by Everflow that can help businesses analyze, automate, and ...",
              "date": "Feb 12, 2025",
              "position": 4
            },
            {
              "title": "Pega Named a Leader in Digital Process Automation ...",
              "link": "https://www.businesswire.com/news/home/20250819398285/en/Pega-Named-a-Leader-in-Digital-Process-Automation-Platforms-by-Independent-Research-Firm",
              "snippet": "Pega's AI-powered decisioning and workflow automation solutions recognized for agentic AI capabilities and helping clients achieve transformation goals",
              "date": "Aug 20, 2025",
              "position": 5
            },
            {
              "title": "Best Task Mining Tools Reviews 2026 | Gartner Peer Insights",
              "link": "https://www.gartner.com/reviews/market/task-mining-tools",
              "snippet": "Its Process Intelligence Platform uses process mining and AI technology and augments it with business context to give customers a living digital twin of their ...",
              "date": "May 6, 2025",
              "position": 6
            },
            {
              "title": "Business process management (BPM)",
              "link": "https://www.pega.com/business-process-management",
              "snippet": "BPM is a methodology to manage processes and workflows in an organization. The goal of BPM is to increase efficiency, performance, and agility.",
              "date": "Jun 12, 2025",
              "position": 7
            },
            {
              "title": "Pegasystems",
              "link": "https://en.wikipedia.org/wiki/Pegasystems",
              "snippet": "Pegasystems Inc. (Pega) is a global software company. Software, low-code platform, AI, customer relationship management, business process management, workflow ...",
              "date": "Dec 16, 2025",
              "position": 8
            },
            {
              "title": "Best Hyperautomation Platforms of 2026 [Updated Top 10 ...",
              "link": "https://kissflow.com/workflow/best-hyperautomation-platforms/",
              "snippet": "Pega combines intelligent process automation (IPA), AI-driven decisioning, and case management into its hyperautomation suite. It's particularly strong in ...",
              "date": "Dec 3, 2025",
              "rating": 4.3,
              "ratingCount": 533,
              "position": 9
            },
            {
              "title": "Pega Named a Leader in Digital Process Automation ...",
              "link": "https://finance.yahoo.com/news/pega-named-leader-digital-process-144300474.html",
              "snippet": "Pega's AI-powered decisioning and workflow automation solutions recognized for agentic AI capabilities and helping clients achieve transformation goals.",
              "date": "Aug 20, 2025",
              "position": 10
            }
          ],
          "relatedSearches": [
            {
              "query": "Celonis"
            },
            {
              "query": "IBM Process Mining"
            },
            {
              "query": "Pega business process management"
            },
            {
              "query": "Pega BPM competitors"
            },
            {
              "query": "Pega revenue"
            },
            {
              "query": "Pega Investor relations"
            },
            {
              "query": "PEGA stock earnings"
            },
            {
              "query": "PEGA Q2 results"
            }
          ],
          "credits": 1
        }
      },
      {
        "json": {
          "searchParameters": {
            "q": "Microsoft (digital banking transformation OR object centric process mining OR ocpm process mining OR process mining OR process mining simulation OR process intelligence platform)",
            "type": "search",
            "num": 100,
            "tbs": "qdr:y",
            "engine": "google"
          },
          "organic": [
            {
              "title": "Celonis Provides Process Intelligence to Microsoft Fabric ...",
              "link": "https://www.celonis.com/news/press/celonis-provides-process-intelligence-to-microsoft-fabric-customers-to-enable-effective-ai-acceleration-at-scale",
              "snippet": "The Celonis Process Intelligence Platform uses industry-leading process mining and AI technology and augments it with business context to give customers a ...",
              "date": "Apr 1, 2025",
              "position": 1
            },
            {
              "title": "10 Best Process Mining Solutions to Consider for 2026",
              "link": "https://kyp.ai/process-mining-software-comparison/",
              "snippet": "Core approach: KYP.ai deploys a leading process intelligence suite that blends desktop capture with LLM-driven analysis and a conversational AI layer for fast ...",
              "date": "Oct 8, 2025",
              "position": 2
            },
            {
              "title": "Celonis announces new platform innovations",
              "link": "https://www.processexcellencenetwork.com/process-mining/news/celonis-announces-new-platform-innovations-to-power-ai-driven-composable-enterprises",
              "snippet": "Process intelligence vendor Celonis has announced new platform innovations to power enterprise artificial intelligence (AI) driven, composable enterprises.",
              "date": "Nov 4, 2025",
              "position": 3
            },
            {
              "title": "AI-powered success—with more than 1000 stories of ...",
              "link": "https://www.microsoft.com/en-us/microsoft-cloud/blog/2025/07/24/ai-powered-success-with-1000-stories-of-customer-transformation-and-innovation/",
              "snippet": "Explore more than 1000 real-life examples of how organizations are embracing Microsoft's proven AI capabilities to drive impact.",
              "date": "Jul 24, 2025",
              "position": 4
            },
            {
              "title": "Microsoft vs Process Mining Group 2026",
              "link": "https://www.gartner.com/reviews/market/process-mining-platforms/compare/microsoft-vs-process-mining-group",
              "snippet": "Compare Microsoft vs Process Mining Group based on verified reviews from real users in the Process Mining Platforms (Transitioning to Process Intelligence ...",
              "date": "Sep 11, 2025",
              "position": 5
            },
            {
              "title": "New in Microsoft Marketplace: January 7, 2026",
              "link": "https://techcommunity.microsoft.com/blog/marketplace-blog/new-in-microsoft-marketplace-january-7-2026/4469021",
              "snippet": "ARIS (Offer for the UK): ARIS seamlessly integrates business process analysis, process mining, automation, and risk and compliance functionalities so you can ...",
              "date": "2 days ago",
              "position": 6
            },
            {
              "title": "Celonis Unveils Platform Innovations to Power the AI- ...",
              "link": "https://www.celonis.com/news/press/celonis-unveils-platform-innovations-to-power-the-ai-driven-composable-enterprise",
              "snippet": "Celonis, a global leader in Process Intelligence, today at Celosphere 2025 announced major platform innovations that power enterprise AI to reinvent and ...",
              "date": "Nov 4, 2025",
              "position": 7
            },
            {
              "title": "25+ Process Intelligence Software and Tools in 2024",
              "link": "https://www.processmaker.com/blog/process-intelligence-software-and-tools/",
              "snippet": "StereoLOGIC offers an integrated process mining and task mining platform focused on digital transformation. It is originally based on task capture ...",
              "date": "Feb 12, 2025",
              "position": 8
            },
            {
              "title": "16 process mining vendors",
              "link": "https://www.processexcellencenetwork.com/process-mining/articles/16-process-mining-vendors-gartner-magic-quadrant",
              "snippet": "The 2025 Magic Quadrant for Process Mining Platforms report assesses 16 vendors based on their offerings, strengths and weaknesses.",
              "date": "Apr 24, 2025",
              "position": 9
            },
            {
              "title": "Process Mining in the Age of AI — An Integrative Review ...",
              "link": "https://medium.com/@adnanmasood/process-mining-in-the-age-of-ai-an-integrative-review-of-methods-tools-and-applications-611fb6a698e8",
              "snippet": "Process mining is a data-driven approach to uncovering and improving how business processes actually operate, by analyzing digital footprints in event logs. In ...",
              "position": 10
            }
          ],
          "relatedSearches": [
            {
              "query": "Process mining Celonis"
            },
            {
              "query": "AI process mining"
            },
            {
              "query": "Process Intelligence software"
            },
            {
              "query": "Celonis AI Lab"
            },
            {
              "query": "Celonis asset library"
            },
            {
              "query": "Celonis Databricks"
            },
            {
              "query": "Celonis funding"
            },
            {
              "query": "Celonis wiki"
            }
          ],
          "credits": 1
        }
      },
      {
        "json": {
          "searchParameters": {
            "q": "UiPath (digital banking transformation OR object centric process mining OR ocpm process mining OR process mining OR process mining simulation OR process intelligence platform)",
            "type": "search",
            "num": 100,
            "tbs": "qdr:y",
            "engine": "google"
          },
          "organic": [
            {
              "title": "What is Process Orchestration?",
              "link": "https://www.uipath.com/ai/process-orchestration",
              "snippet": "Process orchestration is a technology that connects, coordinates, and optimizes business processes across people, systems, and AI and automation tools.",
              "date": "Apr 19, 2025",
              "position": 1
            },
            {
              "title": "UiPath Launches the First Enterprise-Grade Platform for ...",
              "link": "https://www.uipath.com/newsroom/uipath-launches-first-enterprise-grade-platform-for-agentic-automation",
              "snippet": "It automates, models, and optimizes complex business processes end to end with built-in process intelligence and KPI monitoring to enable continuous ...",
              "date": "Apr 30, 2025",
              "position": 2
            },
            {
              "title": "16 process mining vendors",
              "link": "https://www.processexcellencenetwork.com/process-mining/articles/16-process-mining-vendors-gartner-magic-quadrant",
              "snippet": "The 2025 Magic Quadrant for Process Mining Platforms report assesses 16 vendors based on their offerings, strengths and weaknesses.",
              "date": "Apr 24, 2025",
              "position": 3
            },
            {
              "title": "10 Best Process Mining Solutions to Consider for 2026",
              "link": "https://kyp.ai/process-mining-software-comparison/",
              "snippet": "Core approach: Celonis delivers an extensive process intelligence platform with object-centric process mining (OCPM) and a broad partner ecosystem, offering ...",
              "date": "Oct 8, 2025",
              "position": 4
            },
            {
              "title": "Biggest product announcements from UiPath FUSION 2025",
              "link": "https://www.uipath.com/blog/product-and-updates/fusion-2025-agentic-ai-biggest-product-announcements",
              "snippet": "I'm excited to share new capabilities we announced at UiPath FUSION to help customers further accelerate the adoption of agentic automation and orchestration.",
              "date": "Sep 30, 2025",
              "position": 5
            },
            {
              "title": "25+ Process Intelligence Software and Tools in 2024",
              "link": "https://www.processmaker.com/blog/process-intelligence-software-and-tools/",
              "snippet": "UiPath Process Mining. UiPath is a major ... StereoLOGIC offers an integrated process mining and task mining platform focused on digital transformation.",
              "date": "Feb 12, 2025",
              "position": 6
            },
            {
              "title": "Process Mining in the Age of AI — An Integrative Review ...",
              "link": "https://medium.com/@adnanmasood/process-mining-in-the-age-of-ai-an-integrative-review-of-methods-tools-and-applications-611fb6a698e8",
              "snippet": "Process mining is a data-driven approach to uncovering and improving how business processes actually operate, by analyzing digital footprints in event logs. In ...",
              "position": 7
            },
            {
              "title": "UiPath Recognized as a Leader in the 2025 Gartner® ...",
              "link": "https://ir.uipath.com/news/detail/400/uipath-recognized-as-a-leader-in-the-2025-gartner-magic-quadrant-for-robotic-process-automation",
              "snippet": "The UiPath Platform™ includes generative AI, NLP, process orchestration, API integration, process and task mining, intelligent document processing, low-code ...",
              "date": "Jul 1, 2025",
              "position": 8
            },
            {
              "title": "10 Best Intelligent Automation Platforms You Can Use In ...",
              "link": "https://www.marlabs.com/post/10-best-intelligent-automation-platforms-you-can-use-in-2025",
              "snippet": "Here's an end-to-end intelligent cloud automation platform that's powered by low-code and AI technologies to help quickly automate intelligent workflow ...",
              "date": "Jun 9, 2025",
              "position": 9
            },
            {
              "title": "Best Task Mining Tools Reviews 2026 | Gartner Peer Insights",
              "link": "https://www.gartner.com/reviews/market/task-mining-tools",
              "snippet": "Its Process Intelligence Platform uses process mining and AI technology and augments it with business context to give customers a living digital twin of their ...",
              "date": "May 6, 2025",
              "position": 10
            }
          ],
          "relatedSearches": [
            {
              "query": "Process orchestration tools"
            },
            {
              "query": "UiPath orchestration"
            },
            {
              "query": "UiPath Labs"
            },
            {
              "query": "UiPath Web"
            },
            {
              "query": "UiPath Cloud"
            },
            {
              "query": "UiPath documentation"
            },
            {
              "query": "UiPath Maestro academy"
            },
            {
              "query": "UiPath Maestro vs Orchestrator"
            }
          ],
          "credits": 1
        }
      },
      {
        "json": {
          "searchParameters": {
            "q": "Palantir (digital banking transformation OR object centric process mining OR ocpm process mining OR process mining OR process mining simulation OR process intelligence platform)",
            "type": "search",
            "num": 100,
            "tbs": "qdr:y",
            "engine": "google"
          },
          "organic": [
            {
              "title": "Insights",
              "link": "https://www.celonis.com/insights",
              "snippet": "All the latest insights, research, and ideas about Process Intelligence, process mining, and AI you need to go to the next level.",
              "date": "Nov 6, 2025",
              "position": 1
            },
            {
              "title": "Palantir Foundry Reviews, Ratings & Features 2026",
              "link": "https://www.gartner.com/reviews/market/data-integration-tools/vendor/palantir-technologies/product/foundry-2024460406",
              "snippet": "Palantir Foundry can collect data from any existing systems without modifying those. It also has all the necessary functions to process and integrate data. The ...",
              "date": "Oct 13, 2025",
              "rating": 4.6,
              "ratingCount": 61,
              "position": 2
            },
            {
              "title": "Palantir's Growth Story: How the Magic of Data Analysis Is ...",
              "link": "https://medium.com/@takafumi.endo/palantirs-growth-story-how-the-magic-of-data-analysis-is-changing-the-world-05fe98f4c2af",
              "snippet": "This article reveals the little-known story of how Palantir grew from a mystical “seeing stone” into a platform transforming the world.",
              "position": 3
            },
            {
              "title": "Uncover the mystery of Palantir",
              "link": "https://www.trs.com.cn/en/ABOUTUS/news/202503/t20250314_10517.html",
              "snippet": "Palantir is known as the most mysterious unicorn in Silicon Valley, and its core business is to integrate some seemingly unrelated information together.",
              "date": "Mar 14, 2025",
              "position": 4
            },
            {
              "title": "2024 FY PLTR 10-K",
              "link": "https://investors.palantir.com/files/2024%20FY%20PLTR%2010-K.pdf",
              "snippet": "Class A Common Stock, par value $0.001 per share. PLTR. The Nasdaq Stock Market LLC. Securities registered pursuant to Section 12(g) of the Act: None.",
              "date": "Feb 18, 2025",
              "position": 5
            },
            {
              "title": "Deloitte & Palantir: Driving Value in Enterprise Operations",
              "link": "https://www.deloitte.com/us/en/Industries/government-public/perspectives/deloitte-palantir-collaboration.html",
              "snippet": "The groundbreaking digital transformation platform for accelerating business transformation, enhancing workflow optimization, and facilitating change ...",
              "date": "Jul 4, 2025",
              "position": 6
            },
            {
              "title": "Celonis' vision for AI deployments with Process Intelligence",
              "link": "https://www.linkedin.com/posts/jonelwyn_alex-rinke-celonis-thecube-nyse-wired-activity-7389302878714372096-_aVg",
              "snippet": "The innovative AI-powered, Tungsten Automation platform has received accolades from analysts and industry experts, including being declared a leader in the new ...",
              "position": 7
            },
            {
              "title": "90+ Cloud Computing Statistics: A 2025 Market Snapshot",
              "link": "https://www.cloudzero.com/blog/cloud-computing-statistics/",
              "snippet": "Palantir Technologies provides Artificial Intelligence and data mining services. ... Data analytics is key to enabling digital transformation (Source: Gartner).",
              "date": "May 12, 2025",
              "position": 8
            },
            {
              "title": "Celonis - martini.ai Research",
              "link": "https://martini.ai/pages/research/Celonis-e5c38d002b02459a763cc751785e65c8",
              "snippet": "Palantir's focus on data analytics and intelligence relates to Celonis's process intelligence platform, although the two companies serve different aspects ...",
              "date": "Dec 1, 2025",
              "position": 9
            },
            {
              "title": "IBM vs Palantir 2026 | Gartner Peer Insights",
              "link": "https://www.gartner.com/reviews/market/data-integration-tools/compare/ibm-vs-palantir-technologies",
              "snippet": "Palantir Foundry can collect data from any existing systems without modifying those. It also has all the necessary functions to process and integrate data.",
              "date": "Jul 1, 2025",
              "position": 10
            }
          ],
          "relatedSearches": [
            {
              "query": "Celonis"
            },
            {
              "query": "Process mining Celonis"
            },
            {
              "query": "Process mining procurement"
            },
            {
              "query": "Process intelligence software"
            },
            {
              "query": "Solonas"
            },
            {
              "query": "Celonis Process Intelligence Day"
            },
            {
              "query": "Celonis Process Mining jobs"
            },
            {
              "query": "Process mining for Dummies"
            }
          ],
          "credits": 1
        }
      },
      {
        "json": {
          "searchParameters": {
            "q": "IBM (digital banking transformation OR object centric process mining OR ocpm process mining OR process mining OR process mining simulation OR process intelligence platform)",
            "type": "search",
            "num": 100,
            "tbs": "qdr:y",
            "engine": "google"
          },
          "organic": [
            {
              "title": "16 process mining vendors",
              "link": "https://www.processexcellencenetwork.com/process-mining/articles/16-process-mining-vendors-gartner-magic-quadrant",
              "snippet": "The 2025 Magic Quadrant for Process Mining Platforms report assesses 16 vendors based on their offerings, strengths and weaknesses.",
              "date": "Apr 24, 2025",
              "position": 1
            },
            {
              "title": "Celonis + IBM watsonx Orchestrate: AI agents and ...",
              "link": "https://www.celonis.com/blog/celonis-ibm-watsonx-orchestrate-ai-agents-and-automation-enabled-by-process-intelligence",
              "snippet": "First, the Celonis Process Intelligence Graph ingests and transforms process data into an Object-Centric Data Model, creating a company's process digital twin.",
              "date": "Jan 16, 2025",
              "position": 2
            },
            {
              "title": "IBM - Announcements",
              "link": "https://newsroom.ibm.com/announcements?keywords=acquisitions&l=100",
              "snippet": "IBM (NYSE:IBM) today announced a definitive agreement to acquire myInvenio, a process mining software company based in Reggio Emilia, Italy. The acquisition ...",
              "date": "Apr 7, 2025",
              "position": 3
            },
            {
              "title": "25+ Process Intelligence Software and Tools in 2024",
              "link": "https://www.processmaker.com/blog/process-intelligence-software-and-tools/",
              "snippet": "IBM Process Mining has advanced process ... StereoLOGIC offers an integrated process mining and task mining platform focused on digital transformation.",
              "date": "Feb 12, 2025",
              "position": 4
            },
            {
              "title": "10 Best Process Mining Solutions to Consider for 2026",
              "link": "https://kyp.ai/process-mining-software-comparison/",
              "snippet": "Core approach: Celonis delivers an extensive process intelligence platform with object-centric process mining (OCPM) and a broad partner ecosystem, offering ...",
              "date": "Oct 8, 2025",
              "position": 5
            },
            {
              "title": "FWF AROBS Group and IBM announce Silver Partnership ...",
              "link": "https://www.linkedin.com/posts/futureworkforce_fwf-ibm-silverpartner-activity-7379831474830802944-L1Ee",
              "snippet": "... process intelligence with the launch of Object-Centric Process Mining (OCPM). Unlike traditional process mining, which focuses on one case type, OCPM allows ...",
              "position": 6
            },
            {
              "title": "Process Mining in the Age of AI — An Integrative Review ...",
              "link": "https://medium.com/@adnanmasood/process-mining-in-the-age-of-ai-an-integrative-review-of-methods-tools-and-applications-611fb6a698e8",
              "snippet": "Process mining is a data-driven approach to uncovering and improving how business processes actually operate, by analyzing digital footprints in event logs. In ...",
              "position": 7
            },
            {
              "title": "Best Task Mining Tools Reviews 2026 | Gartner Peer Insights",
              "link": "https://www.gartner.com/reviews/market/task-mining-tools",
              "snippet": "Its Process Intelligence Platform uses process mining and AI technology and augments it with business context to give customers a living digital twin of their ...",
              "date": "May 6, 2025",
              "position": 8
            },
            {
              "title": "What Is Business Process Automation?",
              "link": "https://www.ibm.com/think/topics/business-process-automation",
              "snippet": "Business process automation is a strategy that automates complex and repetitive business processes to streamline day-to-day operations.",
              "date": "May 26, 2025",
              "position": 9
            },
            {
              "title": "6 Process Mining Trends & 20 Stats to Watch for in 2026",
              "link": "https://research.aimultiple.com/process-mining-trends/",
              "snippet": "Process mining market is projected to grow by 40% to 50% by passing $1 billion. Discover process mining trends to benefit from them.",
              "date": "Dec 8, 2025",
              "position": 10
            }
          ],
          "relatedSearches": [
            {
              "query": "IBM Process Mining"
            },
            {
              "query": "Process mining tools"
            },
            {
              "query": "Celonis"
            },
            {
              "query": "Pm4py"
            },
            {
              "query": "Celonis process mining"
            },
            {
              "query": "IBM acquisitions list"
            },
            {
              "query": "IBM acquisitions 2025"
            }
          ],
          "credits": 1
        }
      },
      {
        "json": {
          "searchParameters": {
            "q": "SAP (digital banking transformation OR object centric process mining OR ocpm process mining OR process mining OR process mining simulation OR process intelligence platform)",
            "type": "search",
            "num": 100,
            "tbs": "qdr:y",
            "engine": "google"
          },
          "organic": [
            {
              "title": "Celonis Unveils Platform Innovations to Power the AI- ...",
              "link": "https://www.celonis.com/news/press/celonis-unveils-platform-innovations-to-power-the-ai-driven-composable-enterprise",
              "snippet": "Celonis, a global leader in Process Intelligence, today at Celosphere 2025 announced major platform innovations that power enterprise AI to reinvent and ...",
              "date": "Nov 4, 2025",
              "position": 1
            },
            {
              "title": "11 top process intelligence tools for business transformation",
              "link": "https://www.processexcellencenetwork.com/process-mining/articles/11-top-process-intelligence-tools-for-business-transformation",
              "snippet": "Key capabilities include process mining for data-driven insights, collaborative process design with an AI-enabled repository and simulation for testing changes ...",
              "date": "Sep 5, 2025",
              "position": 2
            },
            {
              "title": "Process Mining – Definition, Benefits, & Use Cases",
              "link": "https://www.signavio.com/wiki/process-discovery/process-mining/",
              "snippet": "Process mining works by turning raw system data into meaningful process insights. Many enterprise systems—such as ERP, CRM, or IT service platforms—record ...",
              "date": "Oct 1, 2025",
              "position": 3
            },
            {
              "title": "10 Best Process Mining Solutions to Consider for 2026",
              "link": "https://kyp.ai/process-mining-software-comparison/",
              "snippet": "Core approach: SAP Signavio provides a cloud-native process transformation suite focused on SAP ecosystems, emphasizing enterprise observability and digital ...",
              "date": "Oct 8, 2025",
              "position": 4
            },
            {
              "title": "Konekti Development B.V.",
              "link": "https://www.sap.com/greece/products/business-transformation-management/partners/konekti-development-bv-konekti.html",
              "snippet": "Accelerate process mining with reliable and high-quality data transformation. Power your process intelligence initiative with high-quality and trusted data ...",
              "date": "Jul 3, 2025",
              "position": 5
            },
            {
              "title": "From shared services to AI strategy - how Merck built its ...",
              "link": "https://diginomica.com/shared-services-ai-strategy-how-merck-built-its-process-intelligence-foundation",
              "snippet": "The Merck experience illustrates how process intelligence platforms can evolve from operational tools to strategic enablers of digital transformation. By ...",
              "date": "Aug 12, 2025",
              "position": 6
            },
            {
              "title": "Best Enterprise Business Process Analysis Tools Reviews ...",
              "link": "https://www.gartner.com/reviews/market/enterprise-business-process-analysis-tools",
              "snippet": "Founded in 1992, ARIS offers a Process Intelligence platform that helps organizations turn their processes into value. By managing the entire process lifecycle ...",
              "date": "May 15, 2025",
              "position": 7
            },
            {
              "title": "Celonis Recognized as a Leader for Third Consecutive ...",
              "link": "https://www.celonis.com/news/press/celonis-recognized-as-a-leader-for-third-consecutive-year-in-2025-gartner-magic-quadrant-for-process-mining-platforms",
              "snippet": "The Celonis Process Intelligence Platform uses industry-leading process mining and AI technology and augments it with business context to give customers a ...",
              "date": "Apr 22, 2025",
              "position": 8
            },
            {
              "title": "2026 process mining trends",
              "link": "https://www.processexcellencenetwork.com/process-mining/articles/6-trends-shaping-process-mining-in-2026",
              "snippet": "Explore the six trends that are transforming process mining into a true business differentiator.",
              "date": "Dec 3, 2025",
              "position": 9
            },
            {
              "title": "Process Mining",
              "link": "https://www.hiberus.com/en/enterprise-efficiency/process-mining",
              "snippet": "Applying process intelligence allows you to understand how operations are actually executed, detect inefficiencies, optimise flows and monitor results on an ...",
              "date": "Jul 28, 2025",
              "position": 10
            }
          ],
          "relatedSearches": [
            {
              "query": "Process mining tools"
            },
            {
              "query": "Process Mining SAP"
            },
            {
              "query": "Process mining Celonis"
            },
            {
              "query": "Signavio Process mining"
            },
            {
              "query": "SAP Process Intelligence"
            },
            {
              "query": "Process Mining ServiceNow"
            },
            {
              "query": "Process Mining UiPath"
            },
            {
              "query": "Process Mining course"
            }
          ],
          "credits": 1
        }
      }
    ]
  },
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          },
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          },
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge4",
            "type": "main",
            "index": 0
          },
          {
            "node": "HTTP Request6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet1": {
      "main": [
        []
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Append or update row in sheet1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download File": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "File Created": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Document Text": {
      "main": [
        [
          {
            "node": "LangChain Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Postgres PGVector Store1",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Set File ID": {
      "main": [
        [
          {
            "node": "Delete Old Data Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "File Updated": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract PDF Text": {
      "main": [
        [
          {
            "node": "LangChain Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize": {
      "main": [
        [
          {
            "node": "Set Schema",
            "type": "main",
            "index": 0
          },
          {
            "node": "Postgres PGVector Store1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RAG AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Extract from Excel",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from CSV",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract PDF Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Document Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Document Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from Excel": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          },
          {
            "node": "Insert Table Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Schema": {
      "main": [
        [
          {
            "node": "Update Schema for Document Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from CSV": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          },
          {
            "node": "Insert Table Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "List Documents": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get File Contents": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Document Rows": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Set File ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Document Metadata": {
      "main": [
        [
          {
            "node": "Download File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere": {
      "ai_reranker": [
        []
      ]
    },
    "Postgres PGVector Store": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres PGVector Store1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Data Rows": {
      "main": [
        [
          {
            "node": "Delete Old Doc Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Doc Rows": {
      "main": [
        [
          {
            "node": "Insert Document Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Trashed Files via API": {
      "main": [
        [
          {
            "node": "Parse Trashed Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Trashed Files": {
      "main": [
        [
          {
            "node": "Has Files to Delete?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Files to Delete?": {
      "main": [
        [
          {
            "node": "Check If Exists in DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check If Exists in DB": {
      "main": [
        [
          {
            "node": "Exists in DB?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Exists in DB?": {
      "main": [
        [
          {
            "node": "Delete Old Data Rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Every 15 Minutes": {
      "main": [
        [
          {
            "node": "Get Trashed Files via API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Data Rows1": {
      "main": [
        [
          {
            "node": "Delete Old Doc Rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Old Doc Rows1": {
      "main": [
        [
          {
            "node": "Delete Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "LangChain Code": {
      "main": [
        [
          {
            "node": "Postgres PGVector Store1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "RAG AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "LangChain Code",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Scrape a url and get its content1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Scrape a url and get its content1": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Postgres PGVector Store2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres PGVector Store2": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader1": {
      "ai_document": [
        [
          {
            "node": "Postgres PGVector Store2",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader1",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Get many items": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge5",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Code in JavaScript10": {
      "main": [
        [
          {
            "node": "Update an item1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get many items",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request6": {
      "main": [
        [
          {
            "node": "Code in JavaScript16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript16": {
      "main": [
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge4": {
      "main": [
        [
          {
            "node": "Code in JavaScript17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript17": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge5": {
      "main": [
        [
          {
            "node": "Update an item2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request7": {
      "main": [
        [
          {
            "node": "Code in JavaScript49",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript18": {
      "main": [
        [
          {
            "node": "HTTP Request7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger2": {
      "main": [
        [
          {
            "node": "Code in JavaScript31",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript31": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [],
        [
          {
            "node": "Get a playlist item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a playlist item": {
      "main": [
        [
          {
            "node": "Code in JavaScript35",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a video": {
      "main": [
        [
          {
            "node": "Code in JavaScript32",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript32": {
      "main": [
        [
          {
            "node": "Run an Actor and get dataset",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Run an Actor and get dataset": {
      "main": [
        [
          {
            "node": "Code in JavaScript33",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript33": {
      "main": [
        [
          {
            "node": "Message a model3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model3": {
      "main": [
        [
          {
            "node": "Code in JavaScript34",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript34": {
      "main": [
        [
          {
            "node": "Create an item3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript35": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get a video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create an item3": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger3": {
      "main": [
        [
          {
            "node": "Code in JavaScript36",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript36": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items4": {
      "main": [
        [],
        [
          {
            "node": "Get a playlist item2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a playlist item2": {
      "main": [
        [
          {
            "node": "Code in JavaScript40",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a video1": {
      "main": [
        [
          {
            "node": "Code in JavaScript37",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript37": {
      "main": [
        [
          {
            "node": "Run an Actor and get dataset1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Run an Actor and get dataset1": {
      "main": [
        [
          {
            "node": "Code in JavaScript38",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript38": {
      "main": [
        [
          {
            "node": "Message a model4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model4": {
      "main": [
        [
          {
            "node": "Code in JavaScript39",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create an item4": {
      "main": [
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript39": {
      "main": [
        [
          {
            "node": "Create an item4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript40": {
      "main": [
        [
          {
            "node": "Get many items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items5": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get a video1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript41": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items6": {
      "main": [
        [],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          },
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request14": {
      "main": [
        [
          {
            "node": "Code in JavaScript42",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "HTTP Request14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "HTTP Request15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request15": {
      "main": [
        [
          {
            "node": "Code in JavaScript43",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript43": {
      "main": [
        [
          {
            "node": "Merge9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model5": {
      "main": [
        [
          {
            "node": "Code in JavaScript44",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Message a model5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript42": {
      "main": [
        [
          {
            "node": "Merge9",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Code in JavaScript44": {
      "main": [
        [
          {
            "node": "Merge10",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge9": {
      "main": [
        [
          {
            "node": "Merge10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge10": {
      "main": [
        [
          {
            "node": "Update an item6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger4": {
      "main": [
        [
          {
            "node": "Code in JavaScript41",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update an item6": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger5": {
      "main": [
        [
          {
            "node": "Code in JavaScript18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript49": {
      "main": [
        [
          {
            "node": "Message a model6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model6": {
      "main": [
        [
          {
            "node": "Code in JavaScript51",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge11": {
      "main": [
        [
          {
            "node": "Code in JavaScript50",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript51": {
      "main": [
        [
          {
            "node": "Merge11",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Code in JavaScript50": {
      "main": [
        [
          {
            "node": "Update an item8",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code in JavaScript52",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI10": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store10",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader5": {
      "ai_document": [
        []
      ]
    },
    "Character Text Splitter4": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader5",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript52": {
      "main": [
        [
          {
            "node": "Postgres PGVector Store10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many items4": {
      "main": [
        [
          {
            "node": "Code in JavaScript59",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript59": {
      "main": [
        [
          {
            "node": "Update an item10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many items6": {
      "main": [
        [
          {
            "node": "Code in JavaScript66",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript66": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript70": {
      "main": [
        [
          {
            "node": "Loop Over Items12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items12": {
      "main": [
        [
          {
            "node": "Loop Over Items13",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "RSS Read3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RSS Read3": {
      "main": [
        [
          {
            "node": "Code in JavaScript71",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript71": {
      "main": [
        [
          {
            "node": "Limit1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger9": {
      "main": [
        [
          {
            "node": "Code in JavaScript70",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items13": {
      "main": [
        [],
        [
          {
            "node": "Message a model10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model10": {
      "main": [
        [
          {
            "node": "Code in JavaScript72",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript72": {
      "main": [
        [
          {
            "node": "Code in JavaScript73",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript73": {
      "main": [
        [
          {
            "node": "Postgres PGVector Store13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI13": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store13",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Postgres PGVector Store13": {
      "main": [
        [
          {
            "node": "Code in JavaScript77",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model11": {
      "main": [
        [
          {
            "node": "Code in JavaScript74",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript74": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Message a model12",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model12": {
      "main": [
        [
          {
            "node": "Code in JavaScript75",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code in JavaScript76",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript75": {
      "main": [
        [
          {
            "node": "Create an item7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI14": {
      "ai_embedding": [
        [
          {
            "node": "Postgres PGVector Store14",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader7": {
      "ai_document": [
        [
          {
            "node": "Postgres PGVector Store14",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Character Text Splitter6": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader7",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Postgres PGVector Store14": {
      "main": [
        []
      ]
    },
    "Code in JavaScript76": {
      "main": [
        [
          {
            "node": "Postgres PGVector Store14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript77": {
      "main": [
        [
          {
            "node": "Message a model11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create an item7": {
      "main": [
        [
          {
            "node": "Loop Over Items13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit1": {
      "main": [
        [
          {
            "node": "Loop Over Items12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "bde32f56-06d2-4501-9dce-343af1487d84",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "db9b1356b30d9dd8e9e53509b8570bf31c1ae7cc733ba4ae6bfe858df15dd616"
  },
  "id": "x6EG9bRz5WGXzdo1",
  "tags": []
}